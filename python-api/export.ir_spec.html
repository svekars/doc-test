
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>torch.export IR Specification &#8212; PyTorch main documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=949a1ff5" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/katex-math.css?v=91adb8b6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/jit.css?v=8de1ea5d" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=3ccf5357" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom2.css?v=3539c01c" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=a8da1a53"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=940804e7"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'python-api/export.ir_spec';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="main (2.6.0 )" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>

          <li class="main-menu-item">
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Learn
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class=dropdown-title>Get Started</span>
                  <p>Run PyTorch locally or get started quickly with one of the supported cloud platforms</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Tutorials</span>
                  <p>Whats new in PyTorch tutorials</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Learn the Basics</span>
                  <p>Familiarize yourself with PyTorch concepts and modules</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch Recipes</span>
                  <p>Bite-size, ready-to-deploy PyTorch code examples</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Intro to PyTorch - YouTube Series</span>
                  <p>Master PyTorch basics with our engaging YouTube tutorial series</p>
                </a>
              </div>
            </div>
          </li>

          <li>
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Ecosystem
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Tools</span>
                  <p>Learn about the tools and frameworks in the PyTorch Ecosystem</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class=dropdown-title>Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="" target="_blank">
                  <span class=dropdown-title>Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class=dropdown-title>Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Contributor Awards - 2024</span>
                  <p>Award winners announced at this year's PyTorch Conference</p>
                </a>
              </div>
            </div>
          </li>

          <li>
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Edge
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">About PyTorch Edge</span>
                  <p>Build innovative and privacy-aware AI experiences for edge devices</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">ExecuTorch</span>
                  <p>End-to-end solution for enabling on-device inference capabilities across mobile and edge devices</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">ExecuTorch Docs</span>
                </a>
              </div>
            </div>  
          </li>

          <li class="main-menu-item">
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch</span>
                  <p>Explore the documentation for comprehensive guidance on how to use PyTorch</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch Domains</span>
                  <p>Read the PyTorch Domains documentation to learn more about domain-specific libraries</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Blogs & News 
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch Blog</span>
                  <p>Catch up on the latest technical news and happenings</p>
                </a>
                 <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Community Blog</span>
                  <p>Stories from the PyTorch ecosystem</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Videos</span>
                  <p>Learn about the latest PyTorch tutorials, new, and more </p>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Community Stories</span>
                  <p>Learn how our community solves real, everyday machine learning problems with PyTorch</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Events</span>
                  <p>Find events, webinars, and podcasts</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Newsletter</span>
                  <p>Stay up-to-date with the latest updates</p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                About
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch Foundation</span>
                  <p>Learn more about the PyTorch Foundation</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Governing Board</span>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Cloud Credit Program</span>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Technical Advisory Council</span>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Staff</span>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Contact Us</span>
                </a>
              </div>
            </div>
          </li>

          <li class="main-menu-item">
            <div class="no-dropdown">
              <a href="" data-cta="join">
                Become a Member
              </a>
            </div>
          </li>
          <li>
           <div class="main-menu-item">
             <a href="" class="github-icon">
             </a>
           </div>
          </li>
          <!--- TODO: This block adds the search icon to the nav bar. We will enable it later. 
          <li>
            <div class="main-menu-item">
             <a href="" class="search-icon">
             </a>
            </div>
          </li>
          --->
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Home</p>
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="index.html">
    Python API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../notes/index.html">
    Developer Notes
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../community/index.html">
    Community
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../lang-bindings/index.html">
    Language Bindings
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://x.com/PyTorch" title="X" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-x-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">X</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pytorch/pytorch" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/torch" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="index.html">
    Python API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../notes/index.html">
    Developer Notes
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../community/index.html">
    Community
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../lang-bindings/index.html">
    Language Bindings
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://x.com/PyTorch" title="X" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-x-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">X</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pytorch/pytorch" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/torch" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"></div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">torch.export IR Specification</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="torch-export-ir-specification">
<span id="export-ir-spec"></span><h1>torch.export IR Specification<a class="headerlink" href="#torch-export-ir-specification" title="Link to this heading">#</a></h1>
<p>Export IR is an intermediate representation (IR) for compilers, which bears
similarities to MLIR and TorchScript. It is specifically designed to express the
semantics of PyTorch programs. Export IR primarily represents computation in a
streamlined list of operations, with limited support for dynamism such as
control flows.</p>
<p>To create an Export IR graph, a frontend can be used that soundly captures a
PyTorch program via a trace-specializing mechanism. The resulting Export IR can
then be optimized and executed by a backend. This can be done today through
<a class="reference internal" href="export.html#torch.export.export" title="torch.export.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.export.export()</span></code></a>.</p>
<p>The key concepts that will be covered in this document include:</p>
<ul class="simple">
<li><p>ExportedProgram: the data structure containing the Export IR program</p></li>
<li><p>Graph: which consists of a list of nodes.</p></li>
<li><p>Nodes: which represents operations, control flow, and metadata stored on this node.</p></li>
<li><p>Values are produced and consumed by nodes.</p></li>
<li><p>Types are associated with values and nodes.</p></li>
<li><p>The size and memory layout of values are also defined.</p></li>
</ul>
<section id="assumptions">
<h2>Assumptions<a class="headerlink" href="#assumptions" title="Link to this heading">#</a></h2>
<p>This doc assumes that the audience is sufficiently familiar with PyTorch,
specifically with <a class="reference internal" href="fx.html#module-torch.fx" title="torch.fx"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.fx</span></code></a> and its related toolings. Thus it will stop
describing contents present in <a class="reference internal" href="fx.html#module-torch.fx" title="torch.fx"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.fx</span></code></a> documentation and paper.</p>
</section>
<section id="what-is-export-ir">
<h2>What is Export IR<a class="headerlink" href="#what-is-export-ir" title="Link to this heading">#</a></h2>
<p>Export IR is a graph-based intermediate representation IR of PyTorch programs.
Export IR is realized on top of <a class="reference internal" href="fx.html#torch.fx.Graph" title="torch.fx.Graph"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.fx.Graph</span></code></a>. In other words, <strong>all
Export IR graphs are also valid FX graphs</strong>, and if interpreted using standard
FX semantics, Export IR can be interpreted soundly. One implication is that an
exported graph can be converted to a valid Python program via standard FX
codegen.</p>
<p>This documentation will primarily focus on highlighting areas where Export IR
differs from FX in terms of its strictness, while skipping parts where it shares
similarities with FX.</p>
</section>
<section id="exportedprogram">
<h2>ExportedProgram<a class="headerlink" href="#exportedprogram" title="Link to this heading">#</a></h2>
<p>The top-level Export IR construct is an <a class="reference internal" href="export.html#torch.export.ExportedProgram" title="torch.export.ExportedProgram"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.export.ExportedProgram</span></code></a>
class. It bundles the computational graph of a PyTorch model (which is usually a
<a class="reference internal" href="generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Module</span></code></a>) with the parameters or weights that this model
consumes.</p>
<p>Some notable attributes of the <a class="reference internal" href="export.html#torch.export.ExportedProgram" title="torch.export.ExportedProgram"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.export.ExportedProgram</span></code></a> class are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">graph_module</span></code> (<a class="reference internal" href="fx.html#torch.fx.GraphModule" title="torch.fx.GraphModule"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.fx.GraphModule</span></code></a>): Data structure containing
the flattened computational graph of the PyTorch model. The graph can be
directly accessed through <cite>ExportedProgram.graph</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">graph_signature</span></code> (<a class="reference internal" href="export.html#torch.export.ExportGraphSignature" title="torch.export.ExportGraphSignature"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.export.ExportGraphSignature</span></code></a>): The graph
signature, which specifies the parameters and buffer names used and mutated
within the graph. Instead of storing parameters and buffers as attributes of
the graph, they are lifted as inputs to the graph. The graph_signature is
utilized to keep track of additional information on these parameters and
buffers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">state_dict</span></code> (<code class="docutils literal notranslate"><span class="pre">Dict[str,</span> <span class="pre">Union[torch.Tensor,</span> <span class="pre">torch.nn.Parameter]]</span></code>): Data
structure containing the parameters and buffers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">range_constraints</span></code> (<code class="docutils literal notranslate"><span class="pre">Dict[sympy.Symbol,</span> <span class="pre">RangeConstraint]</span></code>): For programs
that are exported with data dependent behavior, the metadata on each node will
contain symbolic shapes (which look like <code class="docutils literal notranslate"><span class="pre">s0</span></code>, <code class="docutils literal notranslate"><span class="pre">i0</span></code>). This attribute maps
the symbolic shapes to their lower/upper ranges.</p></li>
</ul>
</section>
<section id="graph">
<h2>Graph<a class="headerlink" href="#graph" title="Link to this heading">#</a></h2>
<p>An Export IR Graph is a PyTorch program represented in the form of a DAG
(directed acyclic graph).  Each node in this graph represents a particular
computation or operation, and edges of this graph consist of references between
nodes.</p>
<p>We can view Graph having this schema:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Graph</span><span class="p">:</span>
  <span class="n">nodes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Node</span><span class="p">]</span>
</pre></div>
</div>
<p>In practice, Export IR’s graph is realized as <a class="reference internal" href="fx.html#torch.fx.Graph" title="torch.fx.Graph"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.fx.Graph</span></code></a> Python class.</p>
<p>An Export IR graph contains the following nodes (Nodes will be described in more
details in the next section):</p>
<ul class="simple">
<li><p>0 or more nodes of op type <code class="docutils literal notranslate"><span class="pre">placeholder</span></code></p></li>
<li><p>0 or more nodes of op type <code class="docutils literal notranslate"><span class="pre">call_function</span></code></p></li>
<li><p>exactly 1 node of op type <code class="docutils literal notranslate"><span class="pre">output</span></code></p></li>
</ul>
<p><strong>Collorary:</strong> The smallest valid Graph will be of one node. i.e. nodes is never empty.</p>
<p><strong>Definition:</strong>
The set of <code class="docutils literal notranslate"><span class="pre">placeholder</span></code> nodes of a Graph represents the <strong>inputs</strong> of the
Graph of GraphModule. The <cite>output</cite> node of a Graph represents the <strong>outputs</strong>
of the Graph of GraphModule.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">nn</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyModule</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">example_args</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">mod</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">export</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">MyModule</span><span class="p">(),</span> <span class="n">example_args</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="p">():</span>
  <span class="o">%</span><span class="n">x</span> <span class="p">:</span> <span class="p">[</span><span class="n">num_users</span><span class="o">=</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">placeholder</span><span class="p">[</span><span class="n">target</span><span class="o">=</span><span class="n">x</span><span class="p">]</span>
  <span class="o">%</span><span class="n">y</span> <span class="p">:</span> <span class="p">[</span><span class="n">num_users</span><span class="o">=</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">placeholder</span><span class="p">[</span><span class="n">target</span><span class="o">=</span><span class="n">y</span><span class="p">]</span>
  <span class="o">%</span><span class="n">add</span> <span class="p">:</span> <span class="p">[</span><span class="n">num_users</span><span class="o">=</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">call_function</span><span class="p">[</span><span class="n">target</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">aten</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">Tensor</span><span class="p">](</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="o">%</span><span class="n">x</span><span class="p">,</span> <span class="o">%</span><span class="n">y</span><span class="p">),</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{})</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">add</span><span class="p">,)</span>
</pre></div>
</div>
<p>The above is the textual representation of a Graph, with each line being a node.</p>
</section>
<section id="node">
<h2>Node<a class="headerlink" href="#node" title="Link to this heading">#</a></h2>
<p>A Node represents a particular computation or operation and is represented in
Python using the <a class="reference internal" href="fx.html#torch.fx.Node" title="torch.fx.Node"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.fx.Node</span></code></a> class. Edges between nodes are
represented as direct references to other nodes via the <code class="docutils literal notranslate"><span class="pre">args</span></code> property of the
Node class. Using the same FX machinery, we can represent the following
operations that a computational graph typically needs, such as operator calls,
placeholders (aka inputs), conditionals, and loops.</p>
<p>The Node has the following schema:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Node</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="c1"># name of node</span>
  <span class="n">op_name</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># type of operation</span>

  <span class="c1"># interpretation of the fields below depends on op_name</span>
  <span class="n">target</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="o">|</span><span class="n">Callable</span><span class="p">]</span>
  <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span>
  <span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span>
  <span class="n">meta</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>FX Text Format</strong></p>
<p>As in the example above, notice that each line has this format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>%&lt;name&gt;:[...] = &lt;op_name&gt;[target=&lt;target&gt;](args = (%arg1, %arg2, arg3, arg4, …)), kwargs = {&quot;keyword&quot;: arg5})
</pre></div>
</div>
<p>This format captures everything present in the Node class, with the exception of
<code class="docutils literal notranslate"><span class="pre">meta</span></code>, in a compact format.</p>
<p>Concretely:</p>
<ul class="simple">
<li><p><strong>&lt;name&gt;</strong> is the name of the node as it would appear in <code class="docutils literal notranslate"><span class="pre">node.name</span></code>.</p></li>
<li><p><strong>&lt;op_name&gt;</strong> is the <code class="docutils literal notranslate"><span class="pre">node.op</span></code> field, which must be one of these:
<cite>&lt;call_function&gt;</cite>, <cite>&lt;placeholder&gt;</cite>,
<cite>&lt;get_attr&gt;</cite>, or <cite>&lt;output&gt;</cite>.</p></li>
<li><p><strong>&lt;target&gt;</strong> is the target of the node as <code class="docutils literal notranslate"><span class="pre">node.target</span></code>. The meaning of this
field depends on <code class="docutils literal notranslate"><span class="pre">op_name</span></code>.</p></li>
<li><p><strong>args1, … args 4…</strong> are what is listed in the <code class="docutils literal notranslate"><span class="pre">node.args</span></code> tuple. If a
value in the list is an <a class="reference internal" href="fx.html#torch.fx.Node" title="torch.fx.Node"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.fx.Node</span></code></a>, then it will be especially
indicated with a leading <strong>%.</strong></p></li>
</ul>
<p>For example, a call to the add operator would appear as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">add1</span> <span class="o">=</span> <span class="n">call_function</span><span class="p">[</span><span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">aten</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">Tensor</span><span class="p">](</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="o">%</span><span class="n">x</span><span class="p">,</span> <span class="o">%</span><span class="n">y</span><span class="p">),</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{})</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">%x</span></code>, <code class="docutils literal notranslate"><span class="pre">%y</span></code> are two other Nodes that have names x and y.  Worth noting
that the string <code class="docutils literal notranslate"><span class="pre">torch.op.aten.add.Tensor</span></code> represents the callable object that
is actually stored in the target field, not merely its string name.</p>
<p>The final line of this text format is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="p">[</span><span class="n">add</span><span class="p">]</span>
</pre></div>
</div>
<p>which is a Node with <code class="docutils literal notranslate"><span class="pre">op_name</span> <span class="pre">=</span> <span class="pre">output</span></code>, indicating that we are returning this
one element.</p>
<section id="call-function">
<h3>call_function<a class="headerlink" href="#call-function" title="Link to this heading">#</a></h3>
<p>A <code class="docutils literal notranslate"><span class="pre">call_function</span></code> node represents a call to an operator.</p>
<p><strong>Definitions</strong></p>
<ul class="simple">
<li><p><strong>Functional:</strong> We say a callable is “functional” if it satisfies all the
following requirements:</p>
<ul>
<li><p>Non-mutating: The operator does not mutate the value of its input (for
tensors, this includes both metadata and data).</p></li>
<li><p>No side effects: The operator does not mutate states that are visible
from outside, like changing values of module parameters.</p></li>
</ul>
</li>
<li><p><strong>Operator:</strong> is a functional callable with a predefined schema. Examples of
such operators include functional ATen operators.</p></li>
</ul>
<p><strong>Representation in FX</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>%name = call_function[target = operator](args = (%x, %y, …), kwargs = {})
</pre></div>
</div>
<p><strong>Differences from vanilla FX call_function</strong></p>
<ol class="arabic simple">
<li><p>In FX graph, a call_function can refer to any callable, in Export IR, we
restrict it to only a select subset of ATen operators, custom operators, and
control flow operators.</p></li>
<li><p>In Export IR, constant arguments will be embedded within the graph.</p></li>
<li><p>In FX graph, a get_attr node can represent reading any attribute stored in
the graph module. However, in Export IR this is restricted to reading only
submodules as all parameters/buffers will be passed in as inputs to the graph
module.</p></li>
</ol>
<section id="metadata">
<h4>Metadata<a class="headerlink" href="#metadata" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Node.meta</span></code> is a dict attached to every FX node. However, the FX spec does not
specify what metadata can or will be there. Export IR provides a stronger
contract, specifically all <code class="docutils literal notranslate"><span class="pre">call_function</span></code> nodes will guarantee having and
only having the following metadata fields:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">node.meta[&quot;stack_trace&quot;]</span></code> is a string containing the Python stack trace
referencing the original Python source code. An example stack trace looks
like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">File</span> <span class="s2">&quot;my_module.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">19</span><span class="p">,</span> <span class="ow">in</span> <span class="n">forward</span>
<span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dummy_helper</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">File</span> <span class="s2">&quot;helper_utility.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">89</span><span class="p">,</span> <span class="ow">in</span> <span class="n">dummy_helper</span>
<span class="k">return</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">node.meta[&quot;val&quot;]</span></code> describes the output of running the operation. It can be
of type <cite>&lt;symint&gt;</cite>, <cite>&lt;FakeTensor&gt;</cite>, a
<code class="docutils literal notranslate"><span class="pre">List[Union[FakeTensor,</span> <span class="pre">SymInt]]</span></code>, or <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">node.meta[&quot;nn_module_stack&quot;]</span></code> describes the “stacktrace” of the
<a class="reference internal" href="generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Module</span></code></a> from which the node came, if it was from a
<a class="reference internal" href="generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Module</span></code></a> call. For example, if a node containing the <code class="docutils literal notranslate"><span class="pre">addmm</span></code>
op called from a <a class="reference internal" href="generated/torch.nn.Linear.html#torch.nn.Linear" title="torch.nn.Linear"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Linear</span></code></a> module inside of a
<a class="reference internal" href="generated/torch.nn.Sequential.html#torch.nn.Sequential" title="torch.nn.Sequential"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Sequential</span></code></a> module, the <code class="docutils literal notranslate"><span class="pre">nn_module_stack</span></code> would look
something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>{&#39;self_linear&#39;: (&#39;self.linear&#39;, &lt;class &#39;torch.nn.Linear&#39;&gt;), &#39;self_sequential&#39;: (&#39;self.sequential&#39;, &lt;class &#39;torch.nn.Sequential&#39;&gt;)}
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">node.meta[&quot;source_fn_stack&quot;]</span></code> contains the torch function or the leaf
<a class="reference internal" href="generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Module</span></code></a> class this node was called from before decomposition.
For example, a node containing the <code class="docutils literal notranslate"><span class="pre">addmm</span></code> op from a
<a class="reference internal" href="generated/torch.nn.Linear.html#torch.nn.Linear" title="torch.nn.Linear"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Linear</span></code></a> module call would contain <a class="reference internal" href="generated/torch.nn.Linear.html#torch.nn.Linear" title="torch.nn.Linear"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Linear</span></code></a> in
their <code class="docutils literal notranslate"><span class="pre">source_fn</span></code>, and a node containing the <code class="docutils literal notranslate"><span class="pre">addmm</span></code> op from a
<code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.functional.Linear</span></code> module call would contain
<code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.functional.Linear</span></code> in their <code class="docutils literal notranslate"><span class="pre">source_fn</span></code>.</p></li>
</ul>
</section>
</section>
<section id="placeholder">
<h3>placeholder<a class="headerlink" href="#placeholder" title="Link to this heading">#</a></h3>
<p>Placeholder represents an input to a graph. Its semantics are exactly the same as in FX.
Placeholder nodes must be the first N nodes in the nodes list of a graph. N can be zero.</p>
<p><strong>Representation in FX</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">name</span> <span class="o">=</span> <span class="n">placeholder</span><span class="p">[</span><span class="n">target</span> <span class="o">=</span> <span class="n">name</span><span class="p">](</span><span class="n">args</span> <span class="o">=</span> <span class="p">())</span>
</pre></div>
</div>
<p>The target field is a string which is the name of input.</p>
<p><code class="docutils literal notranslate"><span class="pre">args</span></code>, if non-empty, should be of size 1 representing the default value of this input.</p>
<p><strong>Metadata</strong></p>
<p>Placeholder nodes also have <code class="docutils literal notranslate"><span class="pre">meta[‘val’]</span></code>, like <code class="docutils literal notranslate"><span class="pre">call_function</span></code> nodes. The
<code class="docutils literal notranslate"><span class="pre">val</span></code> field in this case represents the input shape/dtype that the graph is
expected to receive for this input parameter.</p>
</section>
<section id="output">
<h3>output<a class="headerlink" href="#output" title="Link to this heading">#</a></h3>
<p>An output call represents a return statement in a function; it thus terminates the
current graph.  There is one and only one output node, and it will always be the
last node of the graph.</p>
<p><strong>Representation in FX</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>output[](args = (%something, …))
</pre></div>
</div>
<p>This has the exact semantics as in <a class="reference internal" href="fx.html#module-torch.fx" title="torch.fx"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.fx</span></code></a>. <code class="docutils literal notranslate"><span class="pre">args</span></code> represents the node
to be returned.</p>
<p><strong>Metadata</strong></p>
<p>Output node has the same metadata as <code class="docutils literal notranslate"><span class="pre">call_function</span></code> nodes.</p>
</section>
<section id="get-attr">
<h3>get_attr<a class="headerlink" href="#get-attr" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">get_attr</span></code> nodes represent reading a submodule from the encapsulating
<a class="reference internal" href="fx.html#torch.fx.GraphModule" title="torch.fx.GraphModule"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.fx.GraphModule</span></code></a>. Unlike a vanilla FX graph from
<a class="reference internal" href="fx.html#torch.fx.symbolic_trace" title="torch.fx.symbolic_trace"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.fx.symbolic_trace()</span></code></a> in which <code class="docutils literal notranslate"><span class="pre">get_attr</span></code> nodes are used to read
attributes such as parameters and buffers from the top-level
<a class="reference internal" href="fx.html#torch.fx.GraphModule" title="torch.fx.GraphModule"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.fx.GraphModule</span></code></a>, parameters and buffers are passed in as
inputs to the graph module, and stored in the top-level
<a class="reference internal" href="export.html#torch.export.ExportedProgram" title="torch.export.ExportedProgram"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.export.ExportedProgram</span></code></a>.</p>
<p><strong>Representation in FX</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">name</span> <span class="o">=</span> <span class="n">get_attr</span><span class="p">[</span><span class="n">target</span> <span class="o">=</span> <span class="n">name</span><span class="p">](</span><span class="n">args</span> <span class="o">=</span> <span class="p">())</span>
</pre></div>
</div>
<p><strong>Example</strong></p>
<p>Consider the following model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">functorch.experimental.control_flow</span><span class="w"> </span><span class="kn">import</span> <span class="n">cond</span>

<span class="k">def</span><span class="w"> </span><span class="nf">true_fn</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">sin</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">false_fn</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">cos</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">cond</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">true_fn</span><span class="p">,</span> <span class="n">false_fn</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
</pre></div>
</div>
<p>Graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="p">():</span>
    <span class="o">%</span><span class="n">x_1</span> <span class="p">:</span> <span class="p">[</span><span class="n">num_users</span><span class="o">=</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">placeholder</span><span class="p">[</span><span class="n">target</span><span class="o">=</span><span class="n">x_1</span><span class="p">]</span>
    <span class="o">%</span><span class="n">y_1</span> <span class="p">:</span> <span class="p">[</span><span class="n">num_users</span><span class="o">=</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">placeholder</span><span class="p">[</span><span class="n">target</span><span class="o">=</span><span class="n">y_1</span><span class="p">]</span>
    <span class="o">%</span><span class="n">true_graph_0</span> <span class="p">:</span> <span class="p">[</span><span class="n">num_users</span><span class="o">=</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_attr</span><span class="p">[</span><span class="n">target</span><span class="o">=</span><span class="n">true_graph_0</span><span class="p">]</span>
    <span class="o">%</span><span class="n">false_graph_0</span> <span class="p">:</span> <span class="p">[</span><span class="n">num_users</span><span class="o">=</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_attr</span><span class="p">[</span><span class="n">target</span><span class="o">=</span><span class="n">false_graph_0</span><span class="p">]</span>
    <span class="o">%</span><span class="n">conditional</span> <span class="p">:</span> <span class="p">[</span><span class="n">num_users</span><span class="o">=</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">call_function</span><span class="p">[</span><span class="n">target</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">higher_order</span><span class="o">.</span><span class="n">cond</span><span class="p">](</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="o">%</span><span class="n">y_1</span><span class="p">,</span> <span class="o">%</span><span class="n">true_graph_0</span><span class="p">,</span> <span class="o">%</span><span class="n">false_graph_0</span><span class="p">,</span> <span class="p">[</span><span class="o">%</span><span class="n">x_1</span><span class="p">]),</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{})</span>
    <span class="k">return</span> <span class="n">conditional</span>
</pre></div>
</div>
<p>The line, <code class="docutils literal notranslate"><span class="pre">%true_graph_0</span> <span class="pre">:</span> <span class="pre">[num_users=1]</span> <span class="pre">=</span> <span class="pre">get_attr[target=true_graph_0]</span></code>,
reads the submodule <code class="docutils literal notranslate"><span class="pre">true_graph_0</span></code> which contains the <code class="docutils literal notranslate"><span class="pre">sin</span></code> operator.</p>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h2>
<section id="symint">
<h3>SymInt<a class="headerlink" href="#symint" title="Link to this heading">#</a></h3>
<p>A SymInt is an object that can either be a literal integer or a symbol that represents
an Integer (represented in Python by <code class="docutils literal notranslate"><span class="pre">sympy.Symbol</span></code> class). When SymInt is a
symbol, it describes a variable of type integer that is unknown to the graph at
compile time, that is, its value is only known at runtime.</p>
</section>
<section id="faketensor">
<h3>FakeTensor<a class="headerlink" href="#faketensor" title="Link to this heading">#</a></h3>
<p>A FakeTensor is an object that contains the metadata of a tensor. It can be
viewed as having the following metadata.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">FakeTensor</span><span class="p">:</span>
  <span class="n">size</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SymInt</span><span class="p">]</span>
  <span class="n">dtype</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">dtype</span>
  <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span>
  <span class="n">dim_order</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>  <span class="c1"># This doesn&#39;t exist yet</span>
</pre></div>
</div>
<p>The size field of FakeTensor is a list of integers or SymInts. If SymInts are
present, this means this tensor has a dynamic shape. If integers are present, it
is assumed that the tensor will have that exact static shape. The rank of the
TensorMeta is never dynamic. The dtype field represents the dtype of the
output of that node. There are no implicit type promotions in Edge IR. There
are no strides in FakeTensor.</p>
<p>In other words:</p>
<ul class="simple">
<li><p>If the operator in node.target returns a Tensor, then <code class="docutils literal notranslate"><span class="pre">node.meta['val']</span></code> is a
FakeTensor describing that tensor.</p></li>
<li><p>If the operator in node.target returns an n-tuple of Tensors, then
<code class="docutils literal notranslate"><span class="pre">node.meta['val']</span></code> is an n-tuple of FakeTensors describing each tensor.</p></li>
<li><p>If the operator in node.target returns an int/float/scalar that is known at
compile time, then <code class="docutils literal notranslate"><span class="pre">node.meta['val']</span></code> is None.</p></li>
<li><p>If the operator in node.target returns an int/float/scalar that is not known
at compile time, then <code class="docutils literal notranslate"><span class="pre">node.meta['val']</span></code> is of type SymInt.</p></li>
</ul>
<p>For example:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">aten::add</span></code> returns a Tensor; so its spec will be a FakeTensor with dtype
and size of the tensor returned by this operator.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aten::sym_size</span></code> returns an integer; so its val will be a SymInt because its
value is only available at runtime.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_pool2d_with_indexes</span></code> returns a tuple of (Tensor, Tensor); so the spec
will also be a 2-tuple of FakeTensor objects, the first TensorMeta describes
the first element of the return value etc.</p></li>
</ul>
<p>Python code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">add_one</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">aten</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="p">():</span>
  <span class="o">%</span><span class="n">ph_0</span> <span class="p">:</span> <span class="p">[</span><span class="c1">#users=1] = placeholder[target=ph_0]</span>
  <span class="o">%</span><span class="n">add_tensor</span> <span class="p">:</span> <span class="p">[</span><span class="c1">#users=1] = call_function[target=torch.ops.aten.add.Tensor](args = (%ph_0, 1), kwargs = {})</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">add_tensor</span><span class="p">]</span>
</pre></div>
</div>
<p>FakeTensor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FakeTensor</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,],</span> <span class="n">device</span><span class="o">=</span><span class="n">CPU</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="pytree-able-types">
<h3>Pytree-able Types<a class="headerlink" href="#pytree-able-types" title="Link to this heading">#</a></h3>
<p>We define a type “Pytree-able”, if it is either a leaf type or a container type
that contains other Pytree-able types.</p>
<p>Note:</p>
<blockquote>
<div><p>The concept of pytree is the same as the one documented
<a class="reference external" href="https://jax.readthedocs.io/en/latest/pytrees.html">here</a> for JAX:</p>
</div></blockquote>
<p>The following types are defined as <strong>leaf type</strong>:</p>
<div class="pst-scrollable-table-container"><table class="table">
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Tensor</p></td>
<td><p><a class="reference internal" href="tensors.html#torch.Tensor" title="torch.Tensor"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.Tensor</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>Scalar</p></td>
<td><p>Any numerical types from Python, including integral types, floating point types, and zero dimensional tensors.</p></td>
</tr>
<tr class="row-even"><td><p>int</p></td>
<td><p>Python int (bound as int64_t in C++)</p></td>
</tr>
<tr class="row-odd"><td><p>float</p></td>
<td><p>Python float (bound as double in C++)</p></td>
</tr>
<tr class="row-even"><td><p>bool</p></td>
<td><p>Python bool</p></td>
</tr>
<tr class="row-odd"><td><p>str</p></td>
<td><p>Python string</p></td>
</tr>
<tr class="row-even"><td><p>ScalarType</p></td>
<td><p><a class="reference internal" href="tensor_attributes.html#torch.dtype" title="torch.dtype"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.dtype</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>Layout</p></td>
<td><p><a class="reference internal" href="tensor_attributes.html#torch.layout" title="torch.layout"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.layout</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>MemoryFormat</p></td>
<td><p><a class="reference internal" href="tensor_attributes.html#torch.memory_format" title="torch.memory_format"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.memory_format</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>Device</p></td>
<td><p><a class="reference internal" href="tensor_attributes.html#torch.device" title="torch.device"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.device</span></code></a></p></td>
</tr>
</tbody>
</table>
</div>
<p>The following types are defined as <strong>container type</strong>:</p>
<div class="pst-scrollable-table-container"><table class="table">
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Tuple</p></td>
<td><p>Python tuple</p></td>
</tr>
<tr class="row-odd"><td><p>List</p></td>
<td><p>Python list</p></td>
</tr>
<tr class="row-even"><td><p>Dict</p></td>
<td><p>Python dict with Scalar keys</p></td>
</tr>
<tr class="row-odd"><td><p>NamedTuple</p></td>
<td><p>Python namedtuple</p></td>
</tr>
<tr class="row-even"><td><p>Dataclass</p></td>
<td><p>Must be registered through <a class="reference external" href="https://github.com/pytorch/pytorch/blob/901aa85b58e8f490631ce1db44e6555869a31893/torch/export/__init__.py#L693">register_dataclass</a></p></td>
</tr>
<tr class="row-odd"><td><p>Custom class</p></td>
<td><p>Any custom class defined with <a class="reference external" href="https://github.com/pytorch/pytorch/blob/901aa85b58e8f490631ce1db44e6555869a31893/torch/utils/_pytree.py#L72">_register_pytree_node</a></p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions">Assumptions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-export-ir">What is Export IR</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exportedprogram">ExportedProgram</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#graph">Graph</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#node">Node</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#call-function">call_function</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metadata">Metadata</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#placeholder">placeholder</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#output">output</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-attr">get_attr</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#symint">SymInt</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#faketensor">FakeTensor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pytree-able-types">Pytree-able Types</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/pytorch/pytorch/edit/main/docs/source/python-api/export.ir_spec.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">
    <div class="tocsection sourcelink">
      <a href="../_sources/python-api/export.ir_spec.rst.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
      </a>
    </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>


  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright PyTorch Contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>