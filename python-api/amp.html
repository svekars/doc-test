
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Automatic Mixed Precision package - torch.amp &#8212; PyTorch main documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=949a1ff5" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/katex-math.css?v=91adb8b6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/jit.css?v=8de1ea5d" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=3ccf5357" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom2.css?v=189c4a6a" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=53c08c8d"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=940804e7"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'python-api/amp';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="main (2.7.0a0+git74cfb4f )" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>

          <li class="main-menu-item">
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Learn
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class=dropdown-title>Get Started</span>
                  <p>Run PyTorch locally or get started quickly with one of the supported cloud platforms</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Tutorials</span>
                  <p>Whats new in PyTorch tutorials</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Learn the Basics</span>
                  <p>Familiarize yourself with PyTorch concepts and modules</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch Recipes</span>
                  <p>Bite-size, ready-to-deploy PyTorch code examples</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Intro to PyTorch - YouTube Series</span>
                  <p>Master PyTorch basics with our engaging YouTube tutorial series</p>
                </a>
              </div>
            </div>
          </li>

          <li>
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Ecosystem
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Tools</span>
                  <p>Learn about the tools and frameworks in the PyTorch Ecosystem</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class=dropdown-title>Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="" target="_blank">
                  <span class=dropdown-title>Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class=dropdown-title>Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Contributor Awards - 2024</span>
                  <p>Award winners announced at this year's PyTorch Conference</p>
                </a>
              </div>
            </div>
          </li>

          <li>
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Edge
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">About PyTorch Edge</span>
                  <p>Build innovative and privacy-aware AI experiences for edge devices</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">ExecuTorch</span>
                  <p>End-to-end solution for enabling on-device inference capabilities across mobile and edge devices</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">ExecuTorch Docs</span>
                </a>
              </div>
            </div>
          </li>

          <li class="main-menu-item">
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch</span>
                  <p>Explore the documentation for comprehensive guidance on how to use PyTorch</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch Domains</span>
                  <p>Read the PyTorch Domains documentation to learn more about domain-specific libraries</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Blogs & News
              lnhetrlnle</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch Blog</span>
                  <p>Catch up on the latest technical news and happenings</p>
                </a>
                 <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Community Blog</span>
                  <p>Stories from the PyTorch ecosystem</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Videos</span>
                  <p>Learn about the latest PyTorch tutorials, new, and more </p>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Community Stories</span>
                  <p>Learn how our community solves real, everyday machine learning problems with PyTorch</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Events</span>
                  <p>Find events, webinars, and podcasts</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Newsletter</span>
                  <p>Stay up-to-date with the latest updates</p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                About
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch Foundation</span>
                  <p>Learn more about the PyTorch Foundation</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Governing Board</span>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Cloud Credit Program</span>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Technical Advisory Council</span>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Staff</span>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Contact Us</span>
                </a>
              </div>
            </div>
          </li>

          <li class="main-menu-item">
            <div class="no-dropdown">
              <a href="" data-cta="join">
                Become a Member
              </a>
            </div>
          </li>
          <li>
           <div class="main-menu-item">
             <a href="" class="github-icon">
             </a>
           </div>
          </li>
          <!--- TODO: This block adds the search icon to the nav bar. We will enable it later.
          <li>
            <div class="main-menu-item">
             <a href="" class="search-icon">
             </a>
            </div>
          </li>
          --->
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>


  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
    <div class="navbar-header-items__start" style="display: flex; align-items: center; justify-content: flex-start;">
    <div class="navbar-item">
      <a class="nav-link nav-internal" href="/index.html">Home</a></div>
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/pytorch-logo-dark-unstable.png" class="logo__image only-light" alt="PyTorch main documentation - Home"/>
    <img src="../_static/pytorch-logo-dark-unstable.png" class="logo__image only-dark pst-js-only" alt="PyTorch main documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="index.html">
    Python API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../notes/index.html">
    Developer Notes
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../community/index.html">
    Community
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../lang-bindings/index.html">
    Language Bindings
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="index.html">
    Python API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../notes/index.html">
    Developer Notes
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../community/index.html">
    Community
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../lang-bindings/index.html">
    Language Bindings
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Automatic Mixed Precision package - torch.amp</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="automatic-mixed-precision-package-torch-amp">
<h1>Automatic Mixed Precision package - torch.amp<a class="headerlink" href="#automatic-mixed-precision-package-torch-amp" title="Link to this heading">#</a></h1>
<p id="module-torch.amp"><span id="module-torch.cuda.amp"></span><span id="module-torch.cpu.amp"></span><a class="reference internal" href="#module-torch.amp" title="torch.amp"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.amp</span></code></a> provides convenience methods for mixed precision,
where some operations use the <code class="docutils literal notranslate"><span class="pre">torch.float32</span></code> (<code class="docutils literal notranslate"><span class="pre">float</span></code>) datatype and other operations
use lower precision floating point datatype (<code class="docutils literal notranslate"><span class="pre">lower_precision_fp</span></code>): <code class="docutils literal notranslate"><span class="pre">torch.float16</span></code> (<code class="docutils literal notranslate"><span class="pre">half</span></code>) or <code class="docutils literal notranslate"><span class="pre">torch.bfloat16</span></code>. Some ops, like linear layers and convolutions,
are much faster in <code class="docutils literal notranslate"><span class="pre">lower_precision_fp</span></code>. Other ops, like reductions, often require the dynamic
range of <code class="docutils literal notranslate"><span class="pre">float32</span></code>.  Mixed precision tries to match each op to its appropriate datatype.</p>
<p>Ordinarily, “automatic mixed precision training” with datatype of <code class="docutils literal notranslate"><span class="pre">torch.float16</span></code> uses <a class="reference internal" href="#torch.autocast" title="torch.autocast"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.autocast</span></code></a> and
<code class="xref py py-class docutils literal notranslate"><span class="pre">torch.amp.GradScaler</span></code> together, as shown in the <a class="reference internal" href="../notes/amp_examples.html#amp-examples"><span class="std std-ref">Automatic Mixed Precision examples</span></a>
and <a class="reference external" href="https://pytorch.org/tutorials/recipes/recipes/amp_recipe.html">Automatic Mixed Precision recipe</a>.
However, <a class="reference internal" href="#torch.autocast" title="torch.autocast"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.autocast</span></code></a> and <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.GradScaler</span></code> are modular, and may be used separately if desired.
As shown in the CPU example section of <a class="reference internal" href="#torch.autocast" title="torch.autocast"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.autocast</span></code></a>, “automatic mixed precision training/inference” on CPU with
datatype of <code class="docutils literal notranslate"><span class="pre">torch.bfloat16</span></code> only uses <a class="reference internal" href="#torch.autocast" title="torch.autocast"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.autocast</span></code></a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">torch.cuda.amp.autocast(args...)</span></code> and <code class="docutils literal notranslate"><span class="pre">torch.cpu.amp.autocast(args...)</span></code> will be deprecated. Please use <code class="docutils literal notranslate"><span class="pre">torch.autocast(&quot;cuda&quot;,</span> <span class="pre">args...)</span></code> or <code class="docutils literal notranslate"><span class="pre">torch.autocast(&quot;cpu&quot;,</span> <span class="pre">args...)</span></code> instead.
<code class="docutils literal notranslate"><span class="pre">torch.cuda.amp.GradScaler(args...)</span></code> and <code class="docutils literal notranslate"><span class="pre">torch.cpu.amp.GradScaler(args...)</span></code> will be deprecated. Please use <code class="docutils literal notranslate"><span class="pre">torch.GradScaler(&quot;cuda&quot;,</span> <span class="pre">args...)</span></code> or <code class="docutils literal notranslate"><span class="pre">torch.GradScaler(&quot;cpu&quot;,</span> <span class="pre">args...)</span></code> instead.</p>
</div>
<p><a class="reference internal" href="#torch.autocast" title="torch.autocast"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.autocast</span></code></a> and <a class="reference internal" href="#torch.cpu.amp.autocast" title="torch.cpu.amp.autocast"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.cpu.amp.autocast</span></code></a> are new in version <cite>1.10</cite>.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#autocasting" id="id4">Autocasting</a></p></li>
<li><p><a class="reference internal" href="#gradient-scaling" id="id5">Gradient Scaling</a></p></li>
<li><p><a class="reference internal" href="#autocast-op-reference" id="id6">Autocast Op Reference</a></p>
<ul>
<li><p><a class="reference internal" href="#op-eligibility" id="id7">Op Eligibility</a></p></li>
<li><p><a class="reference internal" href="#cuda-op-specific-behavior" id="id8">CUDA Op-Specific Behavior</a></p>
<ul>
<li><p><a class="reference internal" href="#cuda-ops-that-can-autocast-to-float16" id="id9">CUDA Ops that can autocast to <code class="docutils literal notranslate"><span class="pre">float16</span></code></a></p></li>
<li><p><a class="reference internal" href="#cuda-ops-that-can-autocast-to-float32" id="id10">CUDA Ops that can autocast to <code class="docutils literal notranslate"><span class="pre">float32</span></code></a></p></li>
<li><p><a class="reference internal" href="#cuda-ops-that-promote-to-the-widest-input-type" id="id11">CUDA Ops that promote to the widest input type</a></p></li>
<li><p><a class="reference internal" href="#prefer-binary-cross-entropy-with-logits-over-binary-cross-entropy" id="id12">Prefer <code class="docutils literal notranslate"><span class="pre">binary_cross_entropy_with_logits</span></code> over <code class="docutils literal notranslate"><span class="pre">binary_cross_entropy</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#xpu-op-specific-behavior-experimental" id="id13">XPU Op-Specific Behavior (Experimental)</a></p>
<ul>
<li><p><a class="reference internal" href="#xpu-ops-that-can-autocast-to-float16" id="id14">XPU Ops that can autocast to <code class="docutils literal notranslate"><span class="pre">float16</span></code></a></p></li>
<li><p><a class="reference internal" href="#xpu-ops-that-can-autocast-to-float32" id="id15">XPU Ops that can autocast to <code class="docutils literal notranslate"><span class="pre">float32</span></code></a></p></li>
<li><p><a class="reference internal" href="#xpu-ops-that-promote-to-the-widest-input-type" id="id16">XPU Ops that promote to the widest input type</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#cpu-op-specific-behavior" id="id17">CPU Op-Specific Behavior</a></p>
<ul>
<li><p><a class="reference internal" href="#cpu-ops-that-can-autocast-to-bfloat16" id="id18">CPU Ops that can autocast to <code class="docutils literal notranslate"><span class="pre">bfloat16</span></code></a></p></li>
<li><p><a class="reference internal" href="#cpu-ops-that-can-autocast-to-float32" id="id19">CPU Ops that can autocast to <code class="docutils literal notranslate"><span class="pre">float32</span></code></a></p></li>
<li><p><a class="reference internal" href="#cpu-ops-that-promote-to-the-widest-input-type" id="id20">CPU Ops that promote to the widest input type</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="autocasting">
<span id="id1"></span><h2><a class="toc-backref" href="#id4" role="doc-backlink">Autocasting</a><a class="headerlink" href="#autocasting" title="Link to this heading">#</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="torch.amp.autocast_mode.is_autocast_available">
<span class="sig-prename descclassname"><span class="pre">torch.amp.autocast_mode.</span></span><span class="sig-name descname"><span class="pre">is_autocast_available</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device_type</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/torch/amp/autocast_mode.html#is_autocast_available"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="reference external" href="https://github.com/pytorch/pytorch/blob/74cfb4f3647c4eb38a5c887225fc6adc0a8b16d6/torch/amp/autocast_mode.py#L28"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.amp.autocast_mode.is_autocast_available" title="Link to this definition">#</a></dt>
<dd><p>Return a bool indicating if autocast is available on <code class="xref py py-attr docutils literal notranslate"><span class="pre">device_type</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>device_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – Device type to use. Possible values are: ‘cuda’, ‘cpu’, ‘xpu’ and so on.
The type is the same as the <cite>type</cite> attribute of a <a class="reference internal" href="tensor_attributes.html#torch.device" title="torch.device"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.device</span></code></a>.
Thus, you may obtain the device type of a tensor using <cite>Tensor.device.type</cite>.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)">bool</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="torch.autocast">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">torch.</span></span><span class="sig-name descname"><span class="pre">autocast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enabled</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache_enabled</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/torch/amp/autocast_mode.html#autocast"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="reference external" href="https://github.com/pytorch/pytorch/blob/74cfb4f3647c4eb38a5c887225fc6adc0a8b16d6/torch/amp/autocast_mode.py#L50"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.autocast" title="Link to this definition">#</a></dt>
<dd><p>Instances of <a class="reference internal" href="#torch.autocast" title="torch.autocast"><code class="xref py py-class docutils literal notranslate"><span class="pre">autocast</span></code></a> serve as context managers or decorators that
allow regions of your script to run in mixed precision.</p>
<p>In these regions, ops run in an op-specific dtype chosen by autocast
to improve performance while maintaining accuracy.
See the <a class="reference internal" href="#autocast-op-reference"><span class="std std-ref">Autocast Op Reference</span></a> for details.</p>
<p>When entering an autocast-enabled region, Tensors may be any type.
You should not call <code class="docutils literal notranslate"><span class="pre">half()</span></code> or <code class="docutils literal notranslate"><span class="pre">bfloat16()</span></code> on your model(s) or inputs when using autocasting.</p>
<p><a class="reference internal" href="#torch.autocast" title="torch.autocast"><code class="xref py py-class docutils literal notranslate"><span class="pre">autocast</span></code></a> should wrap only the forward pass(es) of your network, including the loss
computation(s).  Backward passes under autocast are not recommended.
Backward ops run in the same type that autocast used for corresponding forward ops.</p>
<p>Example for CUDA Devices:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creates model and optimizer in default precision</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="o">...</span><span class="p">)</span>

<span class="k">for</span> <span class="nb">input</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>

    <span class="c1"># Enables autocasting for the forward pass (model + loss)</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">autocast</span><span class="p">(</span><span class="n">device_type</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

    <span class="c1"># Exits the context manager before backward()</span>
    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</pre></div>
</div>
<p>See the <a class="reference internal" href="../notes/amp_examples.html#amp-examples"><span class="std std-ref">Automatic Mixed Precision examples</span></a> for usage (along with gradient scaling)
in more complex scenarios (e.g., gradient penalty, multiple models/losses, custom autograd functions).</p>
<p><a class="reference internal" href="#torch.autocast" title="torch.autocast"><code class="xref py py-class docutils literal notranslate"><span class="pre">autocast</span></code></a> can also be used as a decorator, e.g., on the <code class="docutils literal notranslate"><span class="pre">forward</span></code> method of your model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">AutocastModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="nd">@torch</span><span class="o">.</span><span class="n">autocast</span><span class="p">(</span><span class="n">device_type</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>Floating-point Tensors produced in an autocast-enabled region may be <code class="docutils literal notranslate"><span class="pre">float16</span></code>.
After returning to an autocast-disabled region, using them with floating-point
Tensors of different dtypes may cause type mismatch errors.  If so, cast the Tensor(s)
produced in the autocast region back to <code class="docutils literal notranslate"><span class="pre">float32</span></code> (or other dtype if desired).
If a Tensor from the autocast region is already <code class="docutils literal notranslate"><span class="pre">float32</span></code>, the cast is a no-op,
and incurs no additional overhead.
CUDA Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creates some tensors in default dtype (here assumed to be float32)</span>
<span class="n">a_float32</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>
<span class="n">b_float32</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>
<span class="n">c_float32</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>
<span class="n">d_float32</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">autocast</span><span class="p">(</span><span class="n">device_type</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">):</span>
    <span class="c1"># torch.mm is on autocast&#39;s list of ops that should run in float16.</span>
    <span class="c1"># Inputs are float32, but the op runs in float16 and produces float16 output.</span>
    <span class="c1"># No manual casts are required.</span>
    <span class="n">e_float16</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">a_float32</span><span class="p">,</span> <span class="n">b_float32</span><span class="p">)</span>
    <span class="c1"># Also handles mixed input types</span>
    <span class="n">f_float16</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">d_float32</span><span class="p">,</span> <span class="n">e_float16</span><span class="p">)</span>

<span class="c1"># After exiting autocast, calls f_float16.float() to use with d_float32</span>
<span class="n">g_float32</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">d_float32</span><span class="p">,</span> <span class="n">f_float16</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>
</pre></div>
</div>
<p>CPU Training Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creates model and optimizer in default precision</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="o">...</span><span class="p">)</span>

<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">epochs</span><span class="p">:</span>
    <span class="k">for</span> <span class="nb">input</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>

        <span class="c1"># Runs the forward pass with autocasting.</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">autocast</span><span class="p">(</span><span class="n">device_type</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bfloat16</span><span class="p">):</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</pre></div>
</div>
<p>CPU Inference Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creates model in default precision</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">autocast</span><span class="p">(</span><span class="n">device_type</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bfloat16</span><span class="p">):</span>
    <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="c1"># Runs the forward pass with autocasting.</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</pre></div>
</div>
<p>CPU Inference Example with Jit Trace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TestModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">input_size</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">num_classes</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TestModel</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">)</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

<span class="c1"># For now, we suggest to disable the Jit Autocast Pass,</span>
<span class="c1"># As the issue: https://github.com/pytorch/pytorch/issues/75956</span>
<span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_jit_set_autocast_mode</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">amp</span><span class="o">.</span><span class="n">autocast</span><span class="p">(</span><span class="n">cache_enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">input_size</span><span class="p">))</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">freeze</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="c1"># Models Run</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">model</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">input_size</span><span class="p">))</span>
</pre></div>
</div>
<p>Type mismatch errors <em>in</em> an autocast-enabled region are a bug; if this is what you observe,
please file an issue.</p>
<p><code class="docutils literal notranslate"><span class="pre">autocast(enabled=False)</span></code> subregions can be nested in autocast-enabled regions.
Locally disabling autocast can be useful, for example, if you want to force a subregion
to run in a particular <code class="docutils literal notranslate"><span class="pre">dtype</span></code>.  Disabling autocast gives you explicit control over
the execution type.  In the subregion, inputs from the surrounding region
should be cast to <code class="docutils literal notranslate"><span class="pre">dtype</span></code> before use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creates some tensors in default dtype (here assumed to be float32)</span>
<span class="n">a_float32</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>
<span class="n">b_float32</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>
<span class="n">c_float32</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>
<span class="n">d_float32</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">autocast</span><span class="p">(</span><span class="n">device_type</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">):</span>
    <span class="n">e_float16</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">a_float32</span><span class="p">,</span> <span class="n">b_float32</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">autocast</span><span class="p">(</span><span class="n">device_type</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># Calls e_float16.float() to ensure float32 execution</span>
        <span class="c1"># (necessary because e_float16 was created in an autocasted region)</span>
        <span class="n">f_float32</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">c_float32</span><span class="p">,</span> <span class="n">e_float16</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>

    <span class="c1"># No manual casts are required when re-entering the autocast-enabled region.</span>
    <span class="c1"># torch.mm again runs in float16 and produces float16 output, regardless of input types.</span>
    <span class="n">g_float16</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">d_float32</span><span class="p">,</span> <span class="n">f_float32</span><span class="p">)</span>
</pre></div>
</div>
<p>The autocast state is thread-local.  If you want it enabled in a new thread, the context manager or decorator
must be invoked in that thread.  This affects <a class="reference internal" href="generated/torch.nn.DataParallel.html#torch.nn.DataParallel" title="torch.nn.DataParallel"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.DataParallel</span></code></a> and
<a class="reference internal" href="generated/torch.nn.parallel.DistributedDataParallel.html#torch.nn.parallel.DistributedDataParallel" title="torch.nn.parallel.DistributedDataParallel"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.parallel.DistributedDataParallel</span></code></a> when used with more than one GPU per process
(see <a class="reference internal" href="../notes/amp_examples.html#amp-multigpu"><span class="std std-ref">Working with Multiple GPUs</span></a>).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>device_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>, </em><em>required</em>) – Device type to use. Possible values are: ‘cuda’, ‘cpu’, ‘xpu’ and ‘hpu’.
The type is the same as the <cite>type</cite> attribute of a <a class="reference internal" href="tensor_attributes.html#torch.device" title="torch.device"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.device</span></code></a>.
Thus, you may obtain the device type of a tensor using <cite>Tensor.device.type</cite>.</p></li>
<li><p><strong>enabled</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a><em>, </em><em>optional</em>) – Whether autocasting should be enabled in the region.
Default: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p><strong>dtype</strong> (<em>torch_dtype</em><em>, </em><em>optional</em>) – Data type for ops run in autocast. It uses the default value
(<code class="docutils literal notranslate"><span class="pre">torch.float16</span></code> for CUDA and <code class="docutils literal notranslate"><span class="pre">torch.bfloat16</span></code> for CPU), given by
<code class="xref py py-func docutils literal notranslate"><span class="pre">get_autocast_dtype()</span></code>, if <a class="reference internal" href="tensor_attributes.html#torch.dtype" title="torch.dtype"><code class="xref py py-attr docutils literal notranslate"><span class="pre">dtype</span></code></a> is <code class="docutils literal notranslate"><span class="pre">None</span></code>.
Default: <code class="docutils literal notranslate"><span class="pre">None</span></code></p></li>
<li><p><strong>cache_enabled</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a><em>, </em><em>optional</em>) – Whether the weight cache inside autocast should be enabled.
Default: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="torch.amp.custom_fwd">
<span class="sig-prename descclassname"><span class="pre">torch.amp.</span></span><span class="sig-name descname"><span class="pre">custom_fwd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fwd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cast_inputs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/torch/amp/autocast_mode.html#custom_fwd"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="reference external" href="https://github.com/pytorch/pytorch/blob/74cfb4f3647c4eb38a5c887225fc6adc0a8b16d6/torch/amp/autocast_mode.py#L463"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.amp.custom_fwd" title="Link to this definition">#</a></dt>
<dd><p>Create a helper decorator for <code class="docutils literal notranslate"><span class="pre">forward</span></code> methods of custom autograd functions.</p>
<p>Autograd functions are subclasses of <a class="reference internal" href="autograd.html#torch.autograd.Function" title="torch.autograd.Function"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.autograd.Function</span></code></a>.
See the <a class="reference internal" href="../notes/amp_examples.html#amp-custom-examples"><span class="std std-ref">example page</span></a> for more detail.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>device_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – Device type to use. ‘cuda’, ‘cpu’, ‘xpu’ and so on.
The type is the same as the <cite>type</cite> attribute of a <a class="reference internal" href="tensor_attributes.html#torch.device" title="torch.device"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.device</span></code></a>.
Thus, you may obtain the device type of a tensor using <cite>Tensor.device.type</cite>.</p></li>
<li><p><strong>cast_inputs</strong> (<a class="reference internal" href="tensor_attributes.html#torch.dtype" title="torch.dtype"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.dtype</span></code></a> or None, optional, default=None) – If not <code class="docutils literal notranslate"><span class="pre">None</span></code>,
when <code class="docutils literal notranslate"><span class="pre">forward</span></code> runs in an autocast-enabled region, casts incoming
floating-point Tensors to the target dtype (non-floating-point Tensors are not affected),
then executes <code class="docutils literal notranslate"><span class="pre">forward</span></code> with autocast disabled.
If <code class="docutils literal notranslate"><span class="pre">None</span></code>, <code class="docutils literal notranslate"><span class="pre">forward</span></code>’s internal ops execute with the current autocast state.</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the decorated <code class="docutils literal notranslate"><span class="pre">forward</span></code> is called outside an autocast-enabled region,
<a class="reference internal" href="#torch.amp.custom_fwd" title="torch.amp.custom_fwd"><code class="xref py py-func docutils literal notranslate"><span class="pre">custom_fwd</span></code></a> is a no-op and <code class="docutils literal notranslate"><span class="pre">cast_inputs</span></code> has no effect.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="torch.amp.custom_bwd">
<span class="sig-prename descclassname"><span class="pre">torch.amp.</span></span><span class="sig-name descname"><span class="pre">custom_bwd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bwd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device_type</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/torch/amp/autocast_mode.html#custom_bwd"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="reference external" href="https://github.com/pytorch/pytorch/blob/74cfb4f3647c4eb38a5c887225fc6adc0a8b16d6/torch/amp/autocast_mode.py#L522"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.amp.custom_bwd" title="Link to this definition">#</a></dt>
<dd><p>Create a helper decorator for backward methods of custom autograd functions.</p>
<p>Autograd functions are subclasses of <a class="reference internal" href="autograd.html#torch.autograd.Function" title="torch.autograd.Function"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.autograd.Function</span></code></a>.
Ensures that <code class="docutils literal notranslate"><span class="pre">backward</span></code> executes with the same autocast state as <code class="docutils literal notranslate"><span class="pre">forward</span></code>.
See the <a class="reference internal" href="../notes/amp_examples.html#amp-custom-examples"><span class="std std-ref">example page</span></a> for more detail.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>device_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – Device type to use. ‘cuda’, ‘cpu’, ‘xpu’ and so on.
The type is the same as the <cite>type</cite> attribute of a <a class="reference internal" href="tensor_attributes.html#torch.device" title="torch.device"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.device</span></code></a>.
Thus, you may obtain the device type of a tensor using <cite>Tensor.device.type</cite>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="torch.cuda.amp.autocast">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">torch.cuda.amp.</span></span><span class="sig-name descname"><span class="pre">autocast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">enabled</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">torch.float16</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache_enabled</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/torch/cuda/amp/autocast_mode.html#autocast"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="reference external" href="https://github.com/pytorch/pytorch/blob/74cfb4f3647c4eb38a5c887225fc6adc0a8b16d6/torch/cuda/amp/autocast_mode.py#L12"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.cuda.amp.autocast" title="Link to this definition">#</a></dt>
<dd><p>See <a class="reference internal" href="#torch.autocast" title="torch.autocast"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.autocast</span></code></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">torch.cuda.amp.autocast(args...)</span></code> is deprecated. Please use <code class="docutils literal notranslate"><span class="pre">torch.amp.autocast(&quot;cuda&quot;,</span> <span class="pre">args...)</span></code> instead.</p>
<dl class="field-list simple">
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="torch.cuda.amp.custom_fwd">
<span class="sig-prename descclassname"><span class="pre">torch.cuda.amp.</span></span><span class="sig-name descname"><span class="pre">custom_fwd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fwd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cast_inputs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/torch/cuda/amp/autocast_mode.html#custom_fwd"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="reference external" href="https://github.com/pytorch/pytorch/blob/74cfb4f3647c4eb38a5c887225fc6adc0a8b16d6/torch/cuda/amp/autocast_mode.py#L65"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.cuda.amp.custom_fwd" title="Link to this definition">#</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">torch.cuda.amp.custom_fwd(args...)</span></code> is deprecated. Please use
<code class="docutils literal notranslate"><span class="pre">torch.amp.custom_fwd(args...,</span> <span class="pre">device_type='cuda')</span></code> instead.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="torch.cuda.amp.custom_bwd">
<span class="sig-prename descclassname"><span class="pre">torch.cuda.amp.</span></span><span class="sig-name descname"><span class="pre">custom_bwd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bwd</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/torch/cuda/amp/autocast_mode.html#custom_bwd"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="reference external" href="https://github.com/pytorch/pytorch/blob/74cfb4f3647c4eb38a5c887225fc6adc0a8b16d6/torch/cuda/amp/autocast_mode.py#L80"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.cuda.amp.custom_bwd" title="Link to this definition">#</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">torch.cuda.amp.custom_bwd(args...)</span></code> is deprecated. Please use
<code class="docutils literal notranslate"><span class="pre">torch.amp.custom_bwd(args...,</span> <span class="pre">device_type='cuda')</span></code> instead.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="torch.cpu.amp.autocast">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">torch.cpu.amp.</span></span><span class="sig-name descname"><span class="pre">autocast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">enabled</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">torch.bfloat16</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache_enabled</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/torch/cpu/amp/autocast_mode.html#autocast"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="reference external" href="https://github.com/pytorch/pytorch/blob/74cfb4f3647c4eb38a5c887225fc6adc0a8b16d6/torch/cpu/amp/autocast_mode.py#L11"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.cpu.amp.autocast" title="Link to this definition">#</a></dt>
<dd><p>See <a class="reference internal" href="#torch.autocast" title="torch.autocast"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.autocast</span></code></a>.
<code class="docutils literal notranslate"><span class="pre">torch.cpu.amp.autocast(args...)</span></code> is deprecated. Please use <code class="docutils literal notranslate"><span class="pre">torch.amp.autocast(&quot;cpu&quot;,</span> <span class="pre">args...)</span></code> instead.</p>
<dl class="field-list simple">
</dl>
</dd></dl>

</section>
<section id="gradient-scaling">
<span id="id2"></span><h2><a class="toc-backref" href="#id5" role="doc-backlink">Gradient Scaling</a><a class="headerlink" href="#gradient-scaling" title="Link to this heading">#</a></h2>
<p>If the forward pass for a particular op has <code class="docutils literal notranslate"><span class="pre">float16</span></code> inputs, the backward pass for
that op will produce <code class="docutils literal notranslate"><span class="pre">float16</span></code> gradients.
Gradient values with small magnitudes may not be representable in <code class="docutils literal notranslate"><span class="pre">float16</span></code>.
These values will flush to zero (“underflow”), so the update for the corresponding parameters will be lost.</p>
<p>To prevent underflow, “gradient scaling” multiplies the network’s loss(es) by a scale factor and
invokes a backward pass on the scaled loss(es).  Gradients flowing backward through the network are
then scaled by the same factor.  In other words, gradient values have a larger magnitude,
so they don’t flush to zero.</p>
<p>Each parameter’s gradient (<code class="docutils literal notranslate"><span class="pre">.grad</span></code> attribute) should be unscaled before the optimizer
updates the parameters, so the scale factor does not interfere with the learning rate.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>AMP/fp16 may not work for every model! For example, most bf16-pretrained models cannot operate in
the fp16 numerical range of max 65504 and will cause gradients to overflow instead of underflow. In
this case, the scale factor may decrease under 1 as an attempt to bring gradients to a number
representable in the fp16 dynamic range. While one may expect the scale to always be above 1, our
GradScaler does NOT make this guarantee to maintain performance. If you encounter NaNs in your loss
or gradients when running with AMP/fp16, verify your model is compatible.</p>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="torch.cuda.amp.GradScaler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">torch.cuda.amp.</span></span><span class="sig-name descname"><span class="pre">GradScaler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">init_scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">65536.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">growth_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backoff_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">growth_interval</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enabled</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/torch/cuda/amp/grad_scaler.html#GradScaler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="reference external" href="https://github.com/pytorch/pytorch/blob/74cfb4f3647c4eb38a5c887225fc6adc0a8b16d6/torch/cuda/amp/grad_scaler.py#L12"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.cuda.amp.GradScaler" title="Link to this definition">#</a></dt>
<dd><p>See <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.amp.GradScaler</span></code>.
<code class="docutils literal notranslate"><span class="pre">torch.cuda.amp.GradScaler(args...)</span></code> is deprecated. Please use <code class="docutils literal notranslate"><span class="pre">torch.amp.GradScaler(&quot;cuda&quot;,</span> <span class="pre">args...)</span></code> instead.</p>
<dl class="field-list simple">
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="torch.cpu.amp.GradScaler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">torch.cpu.amp.</span></span><span class="sig-name descname"><span class="pre">GradScaler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">init_scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">65536.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">growth_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backoff_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">growth_interval</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enabled</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/torch/cpu/amp/grad_scaler.html#GradScaler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="reference external" href="https://github.com/pytorch/pytorch/blob/74cfb4f3647c4eb38a5c887225fc6adc0a8b16d6/torch/cpu/amp/grad_scaler.py#L9"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.cpu.amp.GradScaler" title="Link to this definition">#</a></dt>
<dd><p>See <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.amp.GradScaler</span></code>.
<code class="docutils literal notranslate"><span class="pre">torch.cpu.amp.GradScaler(args...)</span></code> is deprecated. Please use <code class="docutils literal notranslate"><span class="pre">torch.amp.GradScaler(&quot;cpu&quot;,</span> <span class="pre">args...)</span></code> instead.</p>
<dl class="field-list simple">
</dl>
</dd></dl>

</section>
<section id="autocast-op-reference">
<span id="id3"></span><h2><a class="toc-backref" href="#id6" role="doc-backlink">Autocast Op Reference</a><a class="headerlink" href="#autocast-op-reference" title="Link to this heading">#</a></h2>
<section id="op-eligibility">
<span id="autocast-eligibility"></span><h3><a class="toc-backref" href="#id7" role="doc-backlink">Op Eligibility</a><a class="headerlink" href="#op-eligibility" title="Link to this heading">#</a></h3>
<p>Ops that run in <code class="docutils literal notranslate"><span class="pre">float64</span></code> or non-floating-point dtypes are not eligible, and will
run in these types whether or not autocast is enabled.</p>
<p>Only out-of-place ops and Tensor methods are eligible.
In-place variants and calls that explicitly supply an <code class="docutils literal notranslate"><span class="pre">out=...</span></code> Tensor
are allowed in autocast-enabled regions, but won’t go through autocasting.
For example, in an autocast-enabled region <code class="docutils literal notranslate"><span class="pre">a.addmm(b,</span> <span class="pre">c)</span></code> can autocast,
but <code class="docutils literal notranslate"><span class="pre">a.addmm_(b,</span> <span class="pre">c)</span></code> and <code class="docutils literal notranslate"><span class="pre">a.addmm(b,</span> <span class="pre">c,</span> <span class="pre">out=d)</span></code> cannot.
For best performance and stability, prefer out-of-place ops in autocast-enabled
regions.</p>
<p>Ops called with an explicit <code class="docutils literal notranslate"><span class="pre">dtype=...</span></code> argument are not eligible,
and will produce output that respects the <code class="docutils literal notranslate"><span class="pre">dtype</span></code> argument.</p>
</section>
<section id="cuda-op-specific-behavior">
<span id="autocast-cuda-op-reference"></span><h3><a class="toc-backref" href="#id8" role="doc-backlink">CUDA Op-Specific Behavior</a><a class="headerlink" href="#cuda-op-specific-behavior" title="Link to this heading">#</a></h3>
<p>The following lists describe the behavior of eligible ops in autocast-enabled regions.
These ops always go through autocasting whether they are invoked as part of a <a class="reference internal" href="generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Module</span></code></a>,
as a function, or as a <a class="reference internal" href="tensors.html#torch.Tensor" title="torch.Tensor"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.Tensor</span></code></a> method. If functions are exposed in multiple namespaces,
they go through autocasting regardless of the namespace.</p>
<p>Ops not listed below do not go through autocasting.  They run in the type
defined by their inputs.  However, autocasting may still change the type
in which unlisted ops run if they’re downstream from autocasted ops.</p>
<p>If an op is unlisted, we assume it’s numerically stable in <code class="docutils literal notranslate"><span class="pre">float16</span></code>.
If you believe an unlisted op is numerically unstable in <code class="docutils literal notranslate"><span class="pre">float16</span></code>,
please file an issue.</p>
<section id="cuda-ops-that-can-autocast-to-float16">
<h4><a class="toc-backref" href="#id9" role="doc-backlink">CUDA Ops that can autocast to <code class="docutils literal notranslate"><span class="pre">float16</span></code></a><a class="headerlink" href="#cuda-ops-that-can-autocast-to-float16" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">__matmul__</span></code>,
<code class="docutils literal notranslate"><span class="pre">addbmm</span></code>,
<code class="docutils literal notranslate"><span class="pre">addmm</span></code>,
<code class="docutils literal notranslate"><span class="pre">addmv</span></code>,
<code class="docutils literal notranslate"><span class="pre">addr</span></code>,
<code class="docutils literal notranslate"><span class="pre">baddbmm</span></code>,
<code class="docutils literal notranslate"><span class="pre">bmm</span></code>,
<code class="docutils literal notranslate"><span class="pre">chain_matmul</span></code>,
<code class="docutils literal notranslate"><span class="pre">multi_dot</span></code>,
<code class="docutils literal notranslate"><span class="pre">conv1d</span></code>,
<code class="docutils literal notranslate"><span class="pre">conv2d</span></code>,
<code class="docutils literal notranslate"><span class="pre">conv3d</span></code>,
<code class="docutils literal notranslate"><span class="pre">conv_transpose1d</span></code>,
<code class="docutils literal notranslate"><span class="pre">conv_transpose2d</span></code>,
<code class="docutils literal notranslate"><span class="pre">conv_transpose3d</span></code>,
<code class="docutils literal notranslate"><span class="pre">GRUCell</span></code>,
<code class="docutils literal notranslate"><span class="pre">linear</span></code>,
<code class="docutils literal notranslate"><span class="pre">LSTMCell</span></code>,
<code class="docutils literal notranslate"><span class="pre">matmul</span></code>,
<code class="docutils literal notranslate"><span class="pre">mm</span></code>,
<code class="docutils literal notranslate"><span class="pre">mv</span></code>,
<code class="docutils literal notranslate"><span class="pre">prelu</span></code>,
<code class="docutils literal notranslate"><span class="pre">RNNCell</span></code></p>
</section>
<section id="cuda-ops-that-can-autocast-to-float32">
<h4><a class="toc-backref" href="#id10" role="doc-backlink">CUDA Ops that can autocast to <code class="docutils literal notranslate"><span class="pre">float32</span></code></a><a class="headerlink" href="#cuda-ops-that-can-autocast-to-float32" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">__pow__</span></code>,
<code class="docutils literal notranslate"><span class="pre">__rdiv__</span></code>,
<code class="docutils literal notranslate"><span class="pre">__rpow__</span></code>,
<code class="docutils literal notranslate"><span class="pre">__rtruediv__</span></code>,
<code class="docutils literal notranslate"><span class="pre">acos</span></code>,
<code class="docutils literal notranslate"><span class="pre">asin</span></code>,
<code class="docutils literal notranslate"><span class="pre">binary_cross_entropy_with_logits</span></code>,
<code class="docutils literal notranslate"><span class="pre">cosh</span></code>,
<code class="docutils literal notranslate"><span class="pre">cosine_embedding_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">cdist</span></code>,
<code class="docutils literal notranslate"><span class="pre">cosine_similarity</span></code>,
<code class="docutils literal notranslate"><span class="pre">cross_entropy</span></code>,
<code class="docutils literal notranslate"><span class="pre">cumprod</span></code>,
<code class="docutils literal notranslate"><span class="pre">cumsum</span></code>,
<code class="docutils literal notranslate"><span class="pre">dist</span></code>,
<code class="docutils literal notranslate"><span class="pre">erfinv</span></code>,
<code class="docutils literal notranslate"><span class="pre">exp</span></code>,
<code class="docutils literal notranslate"><span class="pre">expm1</span></code>,
<code class="docutils literal notranslate"><span class="pre">group_norm</span></code>,
<code class="docutils literal notranslate"><span class="pre">hinge_embedding_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">kl_div</span></code>,
<code class="docutils literal notranslate"><span class="pre">l1_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">layer_norm</span></code>,
<code class="docutils literal notranslate"><span class="pre">log</span></code>,
<code class="docutils literal notranslate"><span class="pre">log_softmax</span></code>,
<code class="docutils literal notranslate"><span class="pre">log10</span></code>,
<code class="docutils literal notranslate"><span class="pre">log1p</span></code>,
<code class="docutils literal notranslate"><span class="pre">log2</span></code>,
<code class="docutils literal notranslate"><span class="pre">margin_ranking_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">mse_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">multilabel_margin_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">multi_margin_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">nll_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">norm</span></code>,
<code class="docutils literal notranslate"><span class="pre">normalize</span></code>,
<code class="docutils literal notranslate"><span class="pre">pdist</span></code>,
<code class="docutils literal notranslate"><span class="pre">poisson_nll_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">pow</span></code>,
<code class="docutils literal notranslate"><span class="pre">prod</span></code>,
<code class="docutils literal notranslate"><span class="pre">reciprocal</span></code>,
<code class="docutils literal notranslate"><span class="pre">rsqrt</span></code>,
<code class="docutils literal notranslate"><span class="pre">sinh</span></code>,
<code class="docutils literal notranslate"><span class="pre">smooth_l1_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">soft_margin_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">softmax</span></code>,
<code class="docutils literal notranslate"><span class="pre">softmin</span></code>,
<code class="docutils literal notranslate"><span class="pre">softplus</span></code>,
<code class="docutils literal notranslate"><span class="pre">sum</span></code>,
<code class="docutils literal notranslate"><span class="pre">renorm</span></code>,
<code class="docutils literal notranslate"><span class="pre">tan</span></code>,
<code class="docutils literal notranslate"><span class="pre">triplet_margin_loss</span></code></p>
</section>
<section id="cuda-ops-that-promote-to-the-widest-input-type">
<h4><a class="toc-backref" href="#id11" role="doc-backlink">CUDA Ops that promote to the widest input type</a><a class="headerlink" href="#cuda-ops-that-promote-to-the-widest-input-type" title="Link to this heading">#</a></h4>
<p>These ops don’t require a particular dtype for stability, but take multiple inputs
and require that the inputs’ dtypes match.  If all of the inputs are
<code class="docutils literal notranslate"><span class="pre">float16</span></code>, the op runs in <code class="docutils literal notranslate"><span class="pre">float16</span></code>.  If any of the inputs is <code class="docutils literal notranslate"><span class="pre">float32</span></code>,
autocast casts all inputs to <code class="docutils literal notranslate"><span class="pre">float32</span></code> and runs the op in <code class="docutils literal notranslate"><span class="pre">float32</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">addcdiv</span></code>,
<code class="docutils literal notranslate"><span class="pre">addcmul</span></code>,
<code class="docutils literal notranslate"><span class="pre">atan2</span></code>,
<code class="docutils literal notranslate"><span class="pre">bilinear</span></code>,
<code class="docutils literal notranslate"><span class="pre">cross</span></code>,
<code class="docutils literal notranslate"><span class="pre">dot</span></code>,
<code class="docutils literal notranslate"><span class="pre">grid_sample</span></code>,
<code class="docutils literal notranslate"><span class="pre">index_put</span></code>,
<code class="docutils literal notranslate"><span class="pre">scatter_add</span></code>,
<code class="docutils literal notranslate"><span class="pre">tensordot</span></code></p>
<p>Some ops not listed here (e.g., binary ops like <code class="docutils literal notranslate"><span class="pre">add</span></code>) natively promote
inputs without autocasting’s intervention.  If inputs are a mixture of <code class="docutils literal notranslate"><span class="pre">float16</span></code>
and <code class="docutils literal notranslate"><span class="pre">float32</span></code>, these ops run in <code class="docutils literal notranslate"><span class="pre">float32</span></code> and produce <code class="docutils literal notranslate"><span class="pre">float32</span></code> output,
regardless of whether autocast is enabled.</p>
</section>
<section id="prefer-binary-cross-entropy-with-logits-over-binary-cross-entropy">
<h4><a class="toc-backref" href="#id12" role="doc-backlink">Prefer <code class="docutils literal notranslate"><span class="pre">binary_cross_entropy_with_logits</span></code> over <code class="docutils literal notranslate"><span class="pre">binary_cross_entropy</span></code></a><a class="headerlink" href="#prefer-binary-cross-entropy-with-logits-over-binary-cross-entropy" title="Link to this heading">#</a></h4>
<p>The backward passes of <a class="reference internal" href="generated/torch.nn.functional.binary_cross_entropy.html#torch.nn.functional.binary_cross_entropy" title="torch.nn.functional.binary_cross_entropy"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.nn.functional.binary_cross_entropy()</span></code></a> (and <a class="reference internal" href="generated/torch.nn.BCELoss.html#torch.nn.BCELoss" title="torch.nn.BCELoss"><code class="xref py py-mod docutils literal notranslate"><span class="pre">torch.nn.BCELoss</span></code></a>, which wraps it)
can produce gradients that aren’t representable in <code class="docutils literal notranslate"><span class="pre">float16</span></code>.  In autocast-enabled regions, the forward input
may be <code class="docutils literal notranslate"><span class="pre">float16</span></code>, which means the backward gradient must be representable in <code class="docutils literal notranslate"><span class="pre">float16</span></code> (autocasting <code class="docutils literal notranslate"><span class="pre">float16</span></code>
forward inputs to <code class="docutils literal notranslate"><span class="pre">float32</span></code> doesn’t help, because that cast must be reversed in backward).
Therefore, <code class="docutils literal notranslate"><span class="pre">binary_cross_entropy</span></code> and <code class="docutils literal notranslate"><span class="pre">BCELoss</span></code> raise an error in autocast-enabled regions.</p>
<p>Many models use a sigmoid layer right before the binary cross entropy layer.
In this case, combine the two layers using <a class="reference internal" href="generated/torch.nn.functional.binary_cross_entropy_with_logits.html#torch.nn.functional.binary_cross_entropy_with_logits" title="torch.nn.functional.binary_cross_entropy_with_logits"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.nn.functional.binary_cross_entropy_with_logits()</span></code></a>
or <a class="reference internal" href="generated/torch.nn.BCEWithLogitsLoss.html#torch.nn.BCEWithLogitsLoss" title="torch.nn.BCEWithLogitsLoss"><code class="xref py py-mod docutils literal notranslate"><span class="pre">torch.nn.BCEWithLogitsLoss</span></code></a>.  <code class="docutils literal notranslate"><span class="pre">binary_cross_entropy_with_logits</span></code> and <code class="docutils literal notranslate"><span class="pre">BCEWithLogits</span></code>
are safe to autocast.</p>
</section>
</section>
<section id="xpu-op-specific-behavior-experimental">
<span id="autocast-xpu-op-reference"></span><h3><a class="toc-backref" href="#id13" role="doc-backlink">XPU Op-Specific Behavior (Experimental)</a><a class="headerlink" href="#xpu-op-specific-behavior-experimental" title="Link to this heading">#</a></h3>
<p>The following lists describe the behavior of eligible ops in autocast-enabled regions.
These ops always go through autocasting whether they are invoked as part of a <a class="reference internal" href="generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Module</span></code></a>,
as a function, or as a <a class="reference internal" href="tensors.html#torch.Tensor" title="torch.Tensor"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.Tensor</span></code></a> method. If functions are exposed in multiple namespaces,
they go through autocasting regardless of the namespace.</p>
<p>Ops not listed below do not go through autocasting.  They run in the type
defined by their inputs.  However, autocasting may still change the type
in which unlisted ops run if they’re downstream from autocasted ops.</p>
<p>If an op is unlisted, we assume it’s numerically stable in <code class="docutils literal notranslate"><span class="pre">float16</span></code>.
If you believe an unlisted op is numerically unstable in <code class="docutils literal notranslate"><span class="pre">float16</span></code>,
please file an issue.</p>
<section id="xpu-ops-that-can-autocast-to-float16">
<h4><a class="toc-backref" href="#id14" role="doc-backlink">XPU Ops that can autocast to <code class="docutils literal notranslate"><span class="pre">float16</span></code></a><a class="headerlink" href="#xpu-ops-that-can-autocast-to-float16" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">addbmm</span></code>,
<code class="docutils literal notranslate"><span class="pre">addmm</span></code>,
<code class="docutils literal notranslate"><span class="pre">addmv</span></code>,
<code class="docutils literal notranslate"><span class="pre">addr</span></code>,
<code class="docutils literal notranslate"><span class="pre">baddbmm</span></code>,
<code class="docutils literal notranslate"><span class="pre">bmm</span></code>,
<code class="docutils literal notranslate"><span class="pre">chain_matmul</span></code>,
<code class="docutils literal notranslate"><span class="pre">multi_dot</span></code>,
<code class="docutils literal notranslate"><span class="pre">conv1d</span></code>,
<code class="docutils literal notranslate"><span class="pre">conv2d</span></code>,
<code class="docutils literal notranslate"><span class="pre">conv3d</span></code>,
<code class="docutils literal notranslate"><span class="pre">conv_transpose1d</span></code>,
<code class="docutils literal notranslate"><span class="pre">conv_transpose2d</span></code>,
<code class="docutils literal notranslate"><span class="pre">conv_transpose3d</span></code>,
<code class="docutils literal notranslate"><span class="pre">GRUCell</span></code>,
<code class="docutils literal notranslate"><span class="pre">linear</span></code>,
<code class="docutils literal notranslate"><span class="pre">LSTMCell</span></code>,
<code class="docutils literal notranslate"><span class="pre">matmul</span></code>,
<code class="docutils literal notranslate"><span class="pre">mm</span></code>,
<code class="docutils literal notranslate"><span class="pre">mv</span></code>,
<code class="docutils literal notranslate"><span class="pre">RNNCell</span></code></p>
</section>
<section id="xpu-ops-that-can-autocast-to-float32">
<h4><a class="toc-backref" href="#id15" role="doc-backlink">XPU Ops that can autocast to <code class="docutils literal notranslate"><span class="pre">float32</span></code></a><a class="headerlink" href="#xpu-ops-that-can-autocast-to-float32" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">__pow__</span></code>,
<code class="docutils literal notranslate"><span class="pre">__rdiv__</span></code>,
<code class="docutils literal notranslate"><span class="pre">__rpow__</span></code>,
<code class="docutils literal notranslate"><span class="pre">__rtruediv__</span></code>,
<code class="docutils literal notranslate"><span class="pre">binary_cross_entropy_with_logits</span></code>,
<code class="docutils literal notranslate"><span class="pre">cosine_embedding_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">cosine_similarity</span></code>,
<code class="docutils literal notranslate"><span class="pre">cumsum</span></code>,
<code class="docutils literal notranslate"><span class="pre">dist</span></code>,
<code class="docutils literal notranslate"><span class="pre">exp</span></code>,
<code class="docutils literal notranslate"><span class="pre">group_norm</span></code>,
<code class="docutils literal notranslate"><span class="pre">hinge_embedding_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">kl_div</span></code>,
<code class="docutils literal notranslate"><span class="pre">l1_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">layer_norm</span></code>,
<code class="docutils literal notranslate"><span class="pre">log</span></code>,
<code class="docutils literal notranslate"><span class="pre">log_softmax</span></code>,
<code class="docutils literal notranslate"><span class="pre">margin_ranking_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">nll_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">normalize</span></code>,
<code class="docutils literal notranslate"><span class="pre">poisson_nll_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">pow</span></code>,
<code class="docutils literal notranslate"><span class="pre">reciprocal</span></code>,
<code class="docutils literal notranslate"><span class="pre">rsqrt</span></code>,
<code class="docutils literal notranslate"><span class="pre">soft_margin_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">softmax</span></code>,
<code class="docutils literal notranslate"><span class="pre">softmin</span></code>,
<code class="docutils literal notranslate"><span class="pre">sum</span></code>,
<code class="docutils literal notranslate"><span class="pre">triplet_margin_loss</span></code></p>
</section>
<section id="xpu-ops-that-promote-to-the-widest-input-type">
<h4><a class="toc-backref" href="#id16" role="doc-backlink">XPU Ops that promote to the widest input type</a><a class="headerlink" href="#xpu-ops-that-promote-to-the-widest-input-type" title="Link to this heading">#</a></h4>
<p>These ops don’t require a particular dtype for stability, but take multiple inputs
and require that the inputs’ dtypes match.  If all of the inputs are
<code class="docutils literal notranslate"><span class="pre">float16</span></code>, the op runs in <code class="docutils literal notranslate"><span class="pre">float16</span></code>.  If any of the inputs is <code class="docutils literal notranslate"><span class="pre">float32</span></code>,
autocast casts all inputs to <code class="docutils literal notranslate"><span class="pre">float32</span></code> and runs the op in <code class="docutils literal notranslate"><span class="pre">float32</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">bilinear</span></code>,
<code class="docutils literal notranslate"><span class="pre">cross</span></code>,
<code class="docutils literal notranslate"><span class="pre">grid_sample</span></code>,
<code class="docutils literal notranslate"><span class="pre">index_put</span></code>,
<code class="docutils literal notranslate"><span class="pre">scatter_add</span></code>,
<code class="docutils literal notranslate"><span class="pre">tensordot</span></code></p>
<p>Some ops not listed here (e.g., binary ops like <code class="docutils literal notranslate"><span class="pre">add</span></code>) natively promote
inputs without autocasting’s intervention.  If inputs are a mixture of <code class="docutils literal notranslate"><span class="pre">float16</span></code>
and <code class="docutils literal notranslate"><span class="pre">float32</span></code>, these ops run in <code class="docutils literal notranslate"><span class="pre">float32</span></code> and produce <code class="docutils literal notranslate"><span class="pre">float32</span></code> output,
regardless of whether autocast is enabled.</p>
</section>
</section>
<section id="cpu-op-specific-behavior">
<span id="autocast-cpu-op-reference"></span><h3><a class="toc-backref" href="#id17" role="doc-backlink">CPU Op-Specific Behavior</a><a class="headerlink" href="#cpu-op-specific-behavior" title="Link to this heading">#</a></h3>
<p>The following lists describe the behavior of eligible ops in autocast-enabled regions.
These ops always go through autocasting whether they are invoked as part of a <a class="reference internal" href="generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Module</span></code></a>,
as a function, or as a <a class="reference internal" href="tensors.html#torch.Tensor" title="torch.Tensor"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.Tensor</span></code></a> method. If functions are exposed in multiple namespaces,
they go through autocasting regardless of the namespace.</p>
<p>Ops not listed below do not go through autocasting.  They run in the type
defined by their inputs.  However, autocasting may still change the type
in which unlisted ops run if they’re downstream from autocasted ops.</p>
<p>If an op is unlisted, we assume it’s numerically stable in <code class="docutils literal notranslate"><span class="pre">bfloat16</span></code>.
If you believe an unlisted op is numerically unstable in <code class="docutils literal notranslate"><span class="pre">bfloat16</span></code>,
please file an issue. <code class="docutils literal notranslate"><span class="pre">float16</span></code> shares the lists of <code class="docutils literal notranslate"><span class="pre">bfloat16</span></code>.</p>
<section id="cpu-ops-that-can-autocast-to-bfloat16">
<h4><a class="toc-backref" href="#id18" role="doc-backlink">CPU Ops that can autocast to <code class="docutils literal notranslate"><span class="pre">bfloat16</span></code></a><a class="headerlink" href="#cpu-ops-that-can-autocast-to-bfloat16" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">conv1d</span></code>,
<code class="docutils literal notranslate"><span class="pre">conv2d</span></code>,
<code class="docutils literal notranslate"><span class="pre">conv3d</span></code>,
<code class="docutils literal notranslate"><span class="pre">bmm</span></code>,
<code class="docutils literal notranslate"><span class="pre">mm</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_vecdot</span></code>,
<code class="docutils literal notranslate"><span class="pre">baddbmm</span></code>,
<code class="docutils literal notranslate"><span class="pre">addmm</span></code>,
<code class="docutils literal notranslate"><span class="pre">addbmm</span></code>,
<code class="docutils literal notranslate"><span class="pre">linear</span></code>,
<code class="docutils literal notranslate"><span class="pre">matmul</span></code>,
<code class="docutils literal notranslate"><span class="pre">_convolution</span></code>,
<code class="docutils literal notranslate"><span class="pre">conv_tbc</span></code>,
<code class="docutils literal notranslate"><span class="pre">mkldnn_rnn_layer</span></code>,
<code class="docutils literal notranslate"><span class="pre">conv_transpose1d</span></code>,
<code class="docutils literal notranslate"><span class="pre">conv_transpose2d</span></code>,
<code class="docutils literal notranslate"><span class="pre">conv_transpose3d</span></code>,
<code class="docutils literal notranslate"><span class="pre">prelu</span></code>,
<code class="docutils literal notranslate"><span class="pre">scaled_dot_product_attention</span></code>,
<code class="docutils literal notranslate"><span class="pre">_native_multi_head_attention</span></code></p>
</section>
<section id="cpu-ops-that-can-autocast-to-float32">
<h4><a class="toc-backref" href="#id19" role="doc-backlink">CPU Ops that can autocast to <code class="docutils literal notranslate"><span class="pre">float32</span></code></a><a class="headerlink" href="#cpu-ops-that-can-autocast-to-float32" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">avg_pool3d</span></code>,
<code class="docutils literal notranslate"><span class="pre">binary_cross_entropy</span></code>,
<code class="docutils literal notranslate"><span class="pre">grid_sampler</span></code>,
<code class="docutils literal notranslate"><span class="pre">grid_sampler_2d</span></code>,
<code class="docutils literal notranslate"><span class="pre">_grid_sampler_2d_cpu_fallback</span></code>,
<code class="docutils literal notranslate"><span class="pre">grid_sampler_3d</span></code>,
<code class="docutils literal notranslate"><span class="pre">polar</span></code>,
<code class="docutils literal notranslate"><span class="pre">prod</span></code>,
<code class="docutils literal notranslate"><span class="pre">quantile</span></code>,
<code class="docutils literal notranslate"><span class="pre">nanquantile</span></code>,
<code class="docutils literal notranslate"><span class="pre">stft</span></code>,
<code class="docutils literal notranslate"><span class="pre">cdist</span></code>,
<code class="docutils literal notranslate"><span class="pre">trace</span></code>,
<code class="docutils literal notranslate"><span class="pre">view_as_complex</span></code>,
<code class="docutils literal notranslate"><span class="pre">cholesky</span></code>,
<code class="docutils literal notranslate"><span class="pre">cholesky_inverse</span></code>,
<code class="docutils literal notranslate"><span class="pre">cholesky_solve</span></code>,
<code class="docutils literal notranslate"><span class="pre">inverse</span></code>,
<code class="docutils literal notranslate"><span class="pre">lu_solve</span></code>,
<code class="docutils literal notranslate"><span class="pre">orgqr</span></code>,
<code class="docutils literal notranslate"><span class="pre">inverse</span></code>,
<code class="docutils literal notranslate"><span class="pre">ormqr</span></code>,
<code class="docutils literal notranslate"><span class="pre">pinverse</span></code>,
<code class="docutils literal notranslate"><span class="pre">max_pool3d</span></code>,
<code class="docutils literal notranslate"><span class="pre">max_unpool2d</span></code>,
<code class="docutils literal notranslate"><span class="pre">max_unpool3d</span></code>,
<code class="docutils literal notranslate"><span class="pre">adaptive_avg_pool3d</span></code>,
<code class="docutils literal notranslate"><span class="pre">reflection_pad1d</span></code>,
<code class="docutils literal notranslate"><span class="pre">reflection_pad2d</span></code>,
<code class="docutils literal notranslate"><span class="pre">replication_pad1d</span></code>,
<code class="docutils literal notranslate"><span class="pre">replication_pad2d</span></code>,
<code class="docutils literal notranslate"><span class="pre">replication_pad3d</span></code>,
<code class="docutils literal notranslate"><span class="pre">mse_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">cosine_embedding_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">nll_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">nll_loss2d</span></code>,
<code class="docutils literal notranslate"><span class="pre">hinge_embedding_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">poisson_nll_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">cross_entropy_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">l1_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">huber_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">margin_ranking_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">soft_margin_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">triplet_margin_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">multi_margin_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">ctc_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">kl_div</span></code>,
<code class="docutils literal notranslate"><span class="pre">multilabel_margin_loss</span></code>,
<code class="docutils literal notranslate"><span class="pre">binary_cross_entropy_with_logits</span></code>,
<code class="docutils literal notranslate"><span class="pre">fft_fft</span></code>,
<code class="docutils literal notranslate"><span class="pre">fft_ifft</span></code>,
<code class="docutils literal notranslate"><span class="pre">fft_fft2</span></code>,
<code class="docutils literal notranslate"><span class="pre">fft_ifft2</span></code>,
<code class="docutils literal notranslate"><span class="pre">fft_fftn</span></code>,
<code class="docutils literal notranslate"><span class="pre">fft_ifftn</span></code>,
<code class="docutils literal notranslate"><span class="pre">fft_rfft</span></code>,
<code class="docutils literal notranslate"><span class="pre">fft_irfft</span></code>,
<code class="docutils literal notranslate"><span class="pre">fft_rfft2</span></code>,
<code class="docutils literal notranslate"><span class="pre">fft_irfft2</span></code>,
<code class="docutils literal notranslate"><span class="pre">fft_rfftn</span></code>,
<code class="docutils literal notranslate"><span class="pre">fft_irfftn</span></code>,
<code class="docutils literal notranslate"><span class="pre">fft_hfft</span></code>,
<code class="docutils literal notranslate"><span class="pre">fft_ihfft</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_cond</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_matrix_rank</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_solve</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_cholesky</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_svdvals</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_eigvals</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_eigvalsh</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_inv</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_householder_product</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_tensorinv</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_tensorsolve</span></code>,
<code class="docutils literal notranslate"><span class="pre">fake_quantize_per_tensor_affine</span></code>,
<code class="docutils literal notranslate"><span class="pre">geqrf</span></code>,
<code class="docutils literal notranslate"><span class="pre">_lu_with_info</span></code>,
<code class="docutils literal notranslate"><span class="pre">qr</span></code>,
<code class="docutils literal notranslate"><span class="pre">svd</span></code>,
<code class="docutils literal notranslate"><span class="pre">triangular_solve</span></code>,
<code class="docutils literal notranslate"><span class="pre">fractional_max_pool2d</span></code>,
<code class="docutils literal notranslate"><span class="pre">fractional_max_pool3d</span></code>,
<code class="docutils literal notranslate"><span class="pre">adaptive_max_pool3d</span></code>,
<code class="docutils literal notranslate"><span class="pre">multilabel_margin_loss_forward</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_qr</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_cholesky_ex</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_svd</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_eig</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_eigh</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_lstsq</span></code>,
<code class="docutils literal notranslate"><span class="pre">linalg_inv_ex</span></code></p>
</section>
<section id="cpu-ops-that-promote-to-the-widest-input-type">
<h4><a class="toc-backref" href="#id20" role="doc-backlink">CPU Ops that promote to the widest input type</a><a class="headerlink" href="#cpu-ops-that-promote-to-the-widest-input-type" title="Link to this heading">#</a></h4>
<p>These ops don’t require a particular dtype for stability, but take multiple inputs
and require that the inputs’ dtypes match.  If all of the inputs are
<code class="docutils literal notranslate"><span class="pre">bfloat16</span></code>, the op runs in <code class="docutils literal notranslate"><span class="pre">bfloat16</span></code>.  If any of the inputs is <code class="docutils literal notranslate"><span class="pre">float32</span></code>,
autocast casts all inputs to <code class="docutils literal notranslate"><span class="pre">float32</span></code> and runs the op in <code class="docutils literal notranslate"><span class="pre">float32</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">cat</span></code>,
<code class="docutils literal notranslate"><span class="pre">stack</span></code>,
<code class="docutils literal notranslate"><span class="pre">index_copy</span></code></p>
<p>Some ops not listed here (e.g., binary ops like <code class="docutils literal notranslate"><span class="pre">add</span></code>) natively promote
inputs without autocasting’s intervention.  If inputs are a mixture of <code class="docutils literal notranslate"><span class="pre">bfloat16</span></code>
and <code class="docutils literal notranslate"><span class="pre">float32</span></code>, these ops run in <code class="docutils literal notranslate"><span class="pre">float32</span></code> and produce <code class="docutils literal notranslate"><span class="pre">float32</span></code> output,
regardless of whether autocast is enabled.</p>
<span class="target" id="module-torch.cuda.amp.grad_scaler"><span id="module-torch.cpu.amp.grad_scaler"></span><span id="module-torch.amp.grad_scaler"></span><span id="module-torch.cuda.amp.common"></span><span id="module-torch.cuda.amp.autocast_mode"></span><span id="module-torch.cpu.amp.autocast_mode"></span><span id="module-torch.amp.autocast_mode"></span></span></section>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc">
<div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autocasting">Autocasting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#torch.amp.autocast_mode.is_autocast_available"><code class="docutils literal notranslate"><span class="pre">is_autocast_available()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#torch.autocast"><code class="docutils literal notranslate"><span class="pre">autocast</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#torch.amp.custom_fwd"><code class="docutils literal notranslate"><span class="pre">custom_fwd()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#torch.amp.custom_bwd"><code class="docutils literal notranslate"><span class="pre">custom_bwd()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#torch.cuda.amp.autocast"><code class="docutils literal notranslate"><span class="pre">autocast</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#torch.cuda.amp.custom_fwd"><code class="docutils literal notranslate"><span class="pre">custom_fwd()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#torch.cuda.amp.custom_bwd"><code class="docutils literal notranslate"><span class="pre">custom_bwd()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#torch.cpu.amp.autocast"><code class="docutils literal notranslate"><span class="pre">autocast</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gradient-scaling">Gradient Scaling</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#torch.cuda.amp.GradScaler"><code class="docutils literal notranslate"><span class="pre">GradScaler</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#torch.cpu.amp.GradScaler"><code class="docutils literal notranslate"><span class="pre">GradScaler</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autocast-op-reference">Autocast Op Reference</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#op-eligibility">Op Eligibility</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cuda-op-specific-behavior">CUDA Op-Specific Behavior</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cuda-ops-that-can-autocast-to-float16">CUDA Ops that can autocast to <code class="docutils literal notranslate"><span class="pre">float16</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cuda-ops-that-can-autocast-to-float32">CUDA Ops that can autocast to <code class="docutils literal notranslate"><span class="pre">float32</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cuda-ops-that-promote-to-the-widest-input-type">CUDA Ops that promote to the widest input type</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#prefer-binary-cross-entropy-with-logits-over-binary-cross-entropy">Prefer <code class="docutils literal notranslate"><span class="pre">binary_cross_entropy_with_logits</span></code> over <code class="docutils literal notranslate"><span class="pre">binary_cross_entropy</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#xpu-op-specific-behavior-experimental">XPU Op-Specific Behavior (Experimental)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#xpu-ops-that-can-autocast-to-float16">XPU Ops that can autocast to <code class="docutils literal notranslate"><span class="pre">float16</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#xpu-ops-that-can-autocast-to-float32">XPU Ops that can autocast to <code class="docutils literal notranslate"><span class="pre">float32</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#xpu-ops-that-promote-to-the-widest-input-type">XPU Ops that promote to the widest input type</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cpu-op-specific-behavior">CPU Op-Specific Behavior</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cpu-ops-that-can-autocast-to-bfloat16">CPU Ops that can autocast to <code class="docutils literal notranslate"><span class="pre">bfloat16</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cpu-ops-that-can-autocast-to-float32">CPU Ops that can autocast to <code class="docutils literal notranslate"><span class="pre">float32</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cpu-ops-that-promote-to-the-widest-input-type">CPU Ops that promote to the widest input type</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/python-api/amp.rst">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div>
<div class="sidebar-secondary-item"> 
</div>
<div class="sidebar-secondary-item">
 <p>PyTorch Libraries</p>
 <ul>
 
  <li><a href="https://pytorch.org/vision">torchvision</a></li>
 
  <li><a href="https://pytorch.org/executorch">ExecuTorch</a></li>
 
  <li><a href="https://https://pytorch.org/ao">torchao</a></li>
 
  <li><a href="https://https://pytorch.org/audio">torchaudio</a></li>
 
  <li><a href="https://https://pytorch.org/torchrec">torchrec</a></li>
 
  <li><a href="https://https://pytorch.org/serve">torchserve</a></li>
 
  <li><a href="https://https://pytorch.org/data">torchdata</a></li>
 
  <li><a href="https://https://pytorch.org/xla">PyTorch on XLA devices</a></li>
 
 </ul>
</div>
</div>

</div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>



  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright PyTorch Contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>