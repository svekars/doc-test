
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>TorchScript-based ONNX Exporter &#8212; PyTorch main documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=949a1ff5" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/katex-math.css?v=91adb8b6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/jit.css?v=8de1ea5d" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=3ccf5357" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom2.css?v=3539c01c" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=a8da1a53"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=940804e7"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'python-api/onnx_torchscript';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="main (2.6.0 )" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>

          <li class="main-menu-item">
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Learn
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class=dropdown-title>Get Started</span>
                  <p>Run PyTorch locally or get started quickly with one of the supported cloud platforms</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Tutorials</span>
                  <p>Whats new in PyTorch tutorials</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Learn the Basics</span>
                  <p>Familiarize yourself with PyTorch concepts and modules</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch Recipes</span>
                  <p>Bite-size, ready-to-deploy PyTorch code examples</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Intro to PyTorch - YouTube Series</span>
                  <p>Master PyTorch basics with our engaging YouTube tutorial series</p>
                </a>
              </div>
            </div>
          </li>

          <li>
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Ecosystem
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Tools</span>
                  <p>Learn about the tools and frameworks in the PyTorch Ecosystem</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class=dropdown-title>Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="" target="_blank">
                  <span class=dropdown-title>Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class=dropdown-title>Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Contributor Awards - 2024</span>
                  <p>Award winners announced at this year's PyTorch Conference</p>
                </a>
              </div>
            </div>
          </li>

          <li>
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Edge
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">About PyTorch Edge</span>
                  <p>Build innovative and privacy-aware AI experiences for edge devices</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">ExecuTorch</span>
                  <p>End-to-end solution for enabling on-device inference capabilities across mobile and edge devices</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">ExecuTorch Docs</span>
                </a>
              </div>
            </div>  
          </li>

          <li class="main-menu-item">
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch</span>
                  <p>Explore the documentation for comprehensive guidance on how to use PyTorch</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch Domains</span>
                  <p>Read the PyTorch Domains documentation to learn more about domain-specific libraries</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Blogs & News 
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch Blog</span>
                  <p>Catch up on the latest technical news and happenings</p>
                </a>
                 <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Community Blog</span>
                  <p>Stories from the PyTorch ecosystem</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Videos</span>
                  <p>Learn about the latest PyTorch tutorials, new, and more </p>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Community Stories</span>
                  <p>Learn how our community solves real, everyday machine learning problems with PyTorch</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Events</span>
                  <p>Find events, webinars, and podcasts</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Newsletter</span>
                  <p>Stay up-to-date with the latest updates</p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                About
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch Foundation</span>
                  <p>Learn more about the PyTorch Foundation</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Governing Board</span>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Cloud Credit Program</span>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Technical Advisory Council</span>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Staff</span>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Contact Us</span>
                </a>
              </div>
            </div>
          </li>

          <li class="main-menu-item">
            <div class="no-dropdown">
              <a href="" data-cta="join">
                Become a Member
              </a>
            </div>
          </li>
          <li>
           <div class="main-menu-item">
             <a href="" class="github-icon">
             </a>
           </div>
          </li>
          <!--- TODO: This block adds the search icon to the nav bar. We will enable it later. 
          <li>
            <div class="main-menu-item">
             <a href="" class="search-icon">
             </a>
            </div>
          </li>
          --->
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Home</p>
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="index.html">
    Python API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../notes/index.html">
    Developer Notes
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../community/index.html">
    Community
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../lang-bindings/index.html">
    Language Bindings
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://x.com/PyTorch" title="X" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-x-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">X</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pytorch/pytorch" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/torch" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="index.html">
    Python API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../notes/index.html">
    Developer Notes
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../community/index.html">
    Community
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../lang-bindings/index.html">
    Language Bindings
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://x.com/PyTorch" title="X" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-x-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">X</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pytorch/pytorch" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/torch" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="generated/torch.onnx.JitScalarType.html">JitScalarType</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/torch.onnx.verification.GraphInfo.html">GraphInfo</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/torch.onnx.verification.VerificationOptions.html">VerificationOptions</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">TorchScript-based ONNX Exporter</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="torchscript-based-onnx-exporter">
<h1>TorchScript-based ONNX Exporter<a class="headerlink" href="#torchscript-based-onnx-exporter" title="Link to this heading">#</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To export an ONNX model using TorchDynamo instead of TorchScript, please see <a class="reference internal" href="onnx_dynamo.html"><span class="doc">Learn more about the TorchDynamo-based ONNX Exporter</span></a></p>
</div>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#example-alexnet-from-pytorch-to-onnx" id="id3">Example: AlexNet from PyTorch to ONNX</a></p></li>
<li><p><a class="reference internal" href="#tracing-vs-scripting" id="id4">Tracing vs Scripting</a></p></li>
<li><p><a class="reference internal" href="#avoiding-pitfalls" id="id5">Avoiding Pitfalls</a></p>
<ul>
<li><p><a class="reference internal" href="#avoid-numpy-and-built-in-python-types" id="id6">Avoid NumPy and built-in Python types</a></p></li>
<li><p><a class="reference internal" href="#avoid-tensor-data" id="id7">Avoid Tensor.data</a></p></li>
<li><p><a class="reference internal" href="#avoid-in-place-operations-when-using-tensor-shape-in-tracing-mode" id="id8">Avoid in-place operations when using tensor.shape in tracing mode</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#limitations" id="id9">Limitations</a></p>
<ul>
<li><p><a class="reference internal" href="#types" id="id10">Types</a></p></li>
<li><p><a class="reference internal" href="#differences-in-operator-implementations" id="id11">Differences in Operator Implementations</a></p></li>
<li><p><a class="reference internal" href="#unsupported-tensor-indexing-patterns" id="id12">Unsupported Tensor Indexing Patterns</a></p>
<ul>
<li><p><a class="reference internal" href="#reads-gets" id="id13">Reads / Gets</a></p></li>
<li><p><a class="reference internal" href="#writes-sets" id="id14">Writes / Sets</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#adding-support-for-operators" id="id15">Adding support for operators</a></p>
<ul>
<li><p><a class="reference internal" href="#onnx-exporter-internals" id="id16">ONNX exporter internals</a></p></li>
<li><p><a class="reference internal" href="#aten-operators" id="id17">ATen operators</a></p>
<ul>
<li><p><a class="reference internal" href="#list-of-supported-operators" id="id18">List of supported operators</a></p></li>
<li><p><a class="reference internal" href="#adding-support-for-an-aten-or-quantized-operator" id="id19">Adding support for an aten or quantized operator</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#torch-autograd-functions" id="id20">torch.autograd.Functions</a></p>
<ul>
<li><p><a class="reference internal" href="#static-symbolic-method" id="id21">Static Symbolic Method</a></p></li>
<li><p><a class="reference internal" href="#inline-autograd-function" id="id22">Inline Autograd Function</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#custom-operators" id="id23">Custom operators</a></p>
<ul>
<li><p><a class="reference internal" href="#onnx-script-functions" id="id24">ONNX-script functions</a></p></li>
<li><p><a class="reference internal" href="#c-operators" id="id25">C++ Operators</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#discovering-all-unconvertible-aten-ops-at-once" id="id26">Discovering all unconvertible ATen ops at once</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#frequently-asked-questions" id="id27">Frequently Asked Questions</a></p></li>
<li><p><a class="reference internal" href="#module-torch.onnx" id="id28">Python API</a></p>
<ul>
<li><p><a class="reference internal" href="#functions" id="id29">Functions</a></p></li>
<li><p><a class="reference internal" href="#classes" id="id30">Classes</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="example-alexnet-from-pytorch-to-onnx">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Example: AlexNet from PyTorch to ONNX</a><a class="headerlink" href="#example-alexnet-from-pytorch-to-onnx" title="Link to this heading">#</a></h2>
<p>Here is a simple script which exports a pretrained AlexNet to an ONNX file named <code class="docutils literal notranslate"><span class="pre">alexnet.onnx</span></code>.
The call to <code class="docutils literal notranslate"><span class="pre">torch.onnx.export</span></code> runs the model once to trace its execution and then exports the
traced model to the specified file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torchvision</span>

<span class="n">dummy_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">alexnet</span><span class="p">(</span><span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>

<span class="c1"># Providing input and output names sets the display names for values</span>
<span class="c1"># within the model&#39;s graph. Setting these does not change the semantics</span>
<span class="c1"># of the graph; it is only for readability.</span>
<span class="c1">#</span>
<span class="c1"># The inputs to the network consist of the flat list of inputs (i.e.</span>
<span class="c1"># the values you would pass to the forward() method) followed by the</span>
<span class="c1"># flat list of parameters. You can partially specify names, i.e. provide</span>
<span class="c1"># a list here shorter than the number of inputs to the model, and we will</span>
<span class="c1"># only set that subset of names, starting from the beginning.</span>
<span class="n">input_names</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;actual_input_1&quot;</span> <span class="p">]</span> <span class="o">+</span> <span class="p">[</span> <span class="s2">&quot;learned_</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="p">]</span>
<span class="n">output_names</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;output1&quot;</span> <span class="p">]</span>

<span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dummy_input</span><span class="p">,</span> <span class="s2">&quot;alexnet.onnx&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">input_names</span><span class="o">=</span><span class="n">input_names</span><span class="p">,</span> <span class="n">output_names</span><span class="o">=</span><span class="n">output_names</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting <code class="docutils literal notranslate"><span class="pre">alexnet.onnx</span></code> file contains a binary <a class="reference external" href="https://developers.google.com/protocol-buffers/">protocol buffer</a>
which contains both the network structure and parameters of the model you exported
(in this case, AlexNet).  The argument <code class="docutils literal notranslate"><span class="pre">verbose=True</span></code> causes the
exporter to print out a human-readable representation of the model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># These are the inputs and parameters to the network, which have taken on</span>
<span class="c1"># the names we specified earlier.</span>
<span class="n">graph</span><span class="p">(</span><span class="o">%</span><span class="n">actual_input_1</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">)</span>
      <span class="o">%</span><span class="n">learned_0</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
      <span class="o">%</span><span class="n">learned_1</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>
      <span class="o">%</span><span class="n">learned_2</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
      <span class="o">%</span><span class="n">learned_3</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">192</span><span class="p">)</span>
      <span class="c1"># ---- omitted for brevity ----</span>
      <span class="o">%</span><span class="n">learned_14</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>
      <span class="o">%</span><span class="n">learned_15</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span> <span class="p">{</span>
  <span class="c1"># Every statement consists of some output tensors (and their types),</span>
  <span class="c1"># the operator to be run (with its attributes, e.g., kernels, strides,</span>
  <span class="c1"># etc.), its input tensors (%actual_input_1, %learned_0, %learned_1)</span>
  <span class="o">%</span><span class="mi">17</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">55</span><span class="p">)</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Conv</span><span class="p">[</span><span class="n">dilations</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">group</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="o">=</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span> <span class="n">pads</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]](</span><span class="o">%</span><span class="n">actual_input_1</span><span class="p">,</span> <span class="o">%</span><span class="n">learned_0</span><span class="p">,</span> <span class="o">%</span><span class="n">learned_1</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span><span class="o">/</span><span class="n">Sequential</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">/</span><span class="n">Conv2d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="o">%</span><span class="mi">18</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">55</span><span class="p">)</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Relu</span><span class="p">(</span><span class="o">%</span><span class="mi">17</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span><span class="o">/</span><span class="n">Sequential</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">/</span><span class="n">ReLU</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="o">%</span><span class="mi">19</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">27</span><span class="p">)</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">MaxPool</span><span class="p">[</span><span class="n">kernel_shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">pads</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]](</span><span class="o">%</span><span class="mi">18</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span><span class="o">/</span><span class="n">Sequential</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">/</span><span class="n">MaxPool2d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="c1"># ---- omitted for brevity ----</span>
  <span class="o">%</span><span class="mi">29</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">MaxPool</span><span class="p">[</span><span class="n">kernel_shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">pads</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]](</span><span class="o">%</span><span class="mi">28</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span><span class="o">/</span><span class="n">Sequential</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">/</span><span class="n">MaxPool2d</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
  <span class="c1"># Dynamic means that the shape is not known. This may be because of a</span>
  <span class="c1"># limitation of our implementation (which we would like to fix in a</span>
  <span class="c1"># future release) or shapes which are truly dynamic.</span>
  <span class="o">%</span><span class="mi">30</span> <span class="p">:</span> <span class="n">Dynamic</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Shape</span><span class="p">(</span><span class="o">%</span><span class="mi">29</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span>
  <span class="o">%</span><span class="mi">31</span> <span class="p">:</span> <span class="n">Dynamic</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Slice</span><span class="p">[</span><span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ends</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">starts</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]](</span><span class="o">%</span><span class="mi">30</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span>
  <span class="o">%</span><span class="mi">32</span> <span class="p">:</span> <span class="n">Long</span><span class="p">()</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Squeeze</span><span class="p">[</span><span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]](</span><span class="o">%</span><span class="mi">31</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span>
  <span class="o">%</span><span class="mi">33</span> <span class="p">:</span> <span class="n">Long</span><span class="p">()</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="p">{</span><span class="mi">9216</span><span class="p">}](),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span>
  <span class="c1"># ---- omitted for brevity ----</span>
  <span class="o">%</span><span class="n">output1</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Gemm</span><span class="p">[</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">broadcast</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">transB</span><span class="o">=</span><span class="mi">1</span><span class="p">](</span><span class="o">%</span><span class="mi">45</span><span class="p">,</span> <span class="o">%</span><span class="n">learned_14</span><span class="p">,</span> <span class="o">%</span><span class="n">learned_15</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span><span class="o">/</span><span class="n">Sequential</span><span class="p">[</span><span class="n">classifier</span><span class="p">]</span><span class="o">/</span><span class="n">Linear</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">%</span><span class="n">output1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can also verify the output using the <a class="reference external" href="https://github.com/onnx/onnx/">ONNX</a> library,
which you can install using <code class="docutils literal notranslate"><span class="pre">pip</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">onnx</span>
</pre></div>
</div>
<p>Then, you can run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">onnx</span>

<span class="c1"># Load the ONNX model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;alexnet.onnx&quot;</span><span class="p">)</span>

<span class="c1"># Check that the model is well formed</span>
<span class="n">onnx</span><span class="o">.</span><span class="n">checker</span><span class="o">.</span><span class="n">check_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="c1"># Print a human readable representation of the graph</span>
<span class="nb">print</span><span class="p">(</span><span class="n">onnx</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">printable_graph</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">graph</span><span class="p">))</span>
</pre></div>
</div>
<p>You can also run the exported model with one of the many
<a class="reference external" href="https://onnx.ai/supported-tools.html#deployModel">runtimes that support ONNX</a>.
For example after installing <a class="reference external" href="https://www.onnxruntime.ai">ONNX Runtime</a>, you can
load and run the model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">onnxruntime</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ort</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">ort_session</span> <span class="o">=</span> <span class="n">ort</span><span class="o">.</span><span class="n">InferenceSession</span><span class="p">(</span><span class="s2">&quot;alexnet.onnx&quot;</span><span class="p">)</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">ort_session</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="kc">None</span><span class="p">,</span>
    <span class="p">{</span><span class="s2">&quot;actual_input_1&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)},</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>Here is a more involved <a class="reference external" href="https://pytorch.org/tutorials/advanced/super_resolution_with_onnxruntime.html">tutorial on exporting a model and running it with ONNX Runtime</a>.</p>
</section>
<section id="tracing-vs-scripting">
<span id="id1"></span><h2><a class="toc-backref" href="#id4" role="doc-backlink">Tracing vs Scripting</a><a class="headerlink" href="#tracing-vs-scripting" title="Link to this heading">#</a></h2>
<p>Internally, <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code></a> requires a <a class="reference internal" href="generated/torch.jit.ScriptModule.html#torch.jit.ScriptModule" title="torch.jit.ScriptModule"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.jit.ScriptModule</span></code></a> rather than
a <a class="reference internal" href="generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Module</span></code></a>. If the passed-in model is not already a <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code>,
<code class="docutils literal notranslate"><span class="pre">export()</span></code> will use <em>tracing</em> to convert it to one:</p>
<ul class="simple">
<li><p><strong>Tracing</strong>: If <code class="docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code> is called with a Module that is not already a
<code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code>, it first does the equivalent of <a class="reference internal" href="generated/torch.jit.trace.html#torch.jit.trace" title="torch.jit.trace"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.jit.trace()</span></code></a>, which executes the model
once with the given <code class="docutils literal notranslate"><span class="pre">args</span></code> and records all operations that happen during that execution. This
means that if your model is dynamic, e.g., changes behavior depending on input data, the exported
model will <em>not</em> capture this dynamic behavior.
We recommend examining the exported model and making sure the operators look
reasonable. Tracing will unroll loops and if statements, exporting a static graph that is exactly
the same as the traced run. If you want to export your model with dynamic control flow, you will
need to use <em>scripting</em>.</p></li>
<li><p><strong>Scripting</strong>: Compiling a model via scripting preserves dynamic control flow and is valid for inputs
of different sizes. To use scripting:</p>
<ul>
<li><p>Use <a class="reference internal" href="generated/torch.jit.script.html#torch.jit.script" title="torch.jit.script"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.jit.script()</span></code></a> to produce a <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code>.</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code> with the <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code> as the model. The <code class="docutils literal notranslate"><span class="pre">args</span></code> are still required,
but they will be used internally only to produce example outputs, so that the types and shapes of the
outputs can be captured. No tracing will be performed.</p></li>
</ul>
</li>
</ul>
<p>See <a class="reference external" href="https://pytorch.org/tutorials/beginner/Intro_to_TorchScript_tutorial.html">Introduction to TorchScript</a>
and <a class="reference external" href="jit.html">TorchScript</a> for more details, including how to compose tracing and scripting to suit the
particular requirements of different models.</p>
</section>
<section id="avoiding-pitfalls">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Avoiding Pitfalls</a><a class="headerlink" href="#avoiding-pitfalls" title="Link to this heading">#</a></h2>
<section id="avoid-numpy-and-built-in-python-types">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Avoid NumPy and built-in Python types</a><a class="headerlink" href="#avoid-numpy-and-built-in-python-types" title="Link to this heading">#</a></h3>
<p>PyTorch models can be written using NumPy or Python types and functions, but
during <a class="reference internal" href="#tracing-vs-scripting"><span class="std std-ref">tracing</span></a>, any variables of NumPy or Python
types (rather than torch.Tensor) are converted to constants, which will produce
the wrong result if those values should change depending on the inputs.</p>
<p>For example, rather than using numpy functions on numpy.ndarrays:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bad! Will be replaced with constants during tracing.</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Use torch operators on torch.Tensors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Good! Tensor operations will be captured during tracing.</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>And rather than use <a class="reference internal" href="generated/torch.Tensor.item.html#torch.Tensor.item" title="torch.Tensor.item"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.Tensor.item()</span></code></a> (which converts a Tensor to a Python
built-in number):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bad! y.item() will be replaced with a constant during tracing.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Use torchs support for implicit casting of single-element tensors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Good! y will be preserved as a variable during tracing.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="avoid-tensor-data">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Avoid Tensor.data</a><a class="headerlink" href="#avoid-tensor-data" title="Link to this heading">#</a></h3>
<p>Using the Tensor.data field can produce an incorrect trace and therefore an incorrect ONNX graph.
Use <a class="reference internal" href="generated/torch.Tensor.detach.html#torch.Tensor.detach" title="torch.Tensor.detach"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.Tensor.detach()</span></code></a> instead. (Work is ongoing to
<a class="reference external" href="https://github.com/pytorch/pytorch/issues/30987">remove Tensor.data entirely</a>).</p>
</section>
<section id="avoid-in-place-operations-when-using-tensor-shape-in-tracing-mode">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Avoid in-place operations when using tensor.shape in tracing mode</a><a class="headerlink" href="#avoid-in-place-operations-when-using-tensor-shape-in-tracing-mode" title="Link to this heading">#</a></h3>
<p>In tracing mode, shapes obtained from <code class="docutils literal notranslate"><span class="pre">tensor.shape</span></code> are traced as tensors,
and share the same memory. This might cause a mismatch the final output values.
As a workaround, avoid the use of inplace operations in these scenarios.
For example, in the model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
  <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">states</span><span class="p">):</span>
      <span class="n">batch_size</span><span class="p">,</span> <span class="n">seq_length</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
      <span class="n">real_seq_length</span> <span class="o">=</span> <span class="n">seq_length</span>
      <span class="n">real_seq_length</span> <span class="o">+=</span> <span class="mi">2</span>
      <span class="k">return</span> <span class="n">real_seq_length</span> <span class="o">+</span> <span class="n">seq_length</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">real_seq_length</span></code> and <code class="docutils literal notranslate"><span class="pre">seq_length</span></code> share the same memory in tracing mode.
This could be avoided by rewriting the inplace operation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">real_seq_length</span> <span class="o">=</span> <span class="n">real_seq_length</span> <span class="o">+</span> <span class="mi">2</span>
</pre></div>
</div>
</section>
</section>
<section id="limitations">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Limitations</a><a class="headerlink" href="#limitations" title="Link to this heading">#</a></h2>
<section id="types">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Types</a><a class="headerlink" href="#types" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Only <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.Tensors</span></code>, numeric types that can be trivially converted to torch.Tensors (e.g. float, int),
and tuples and lists of those types are supported as model inputs or outputs. Dict and str inputs and
outputs are accepted in <a class="reference internal" href="#tracing-vs-scripting"><span class="std std-ref">tracing</span></a> mode, but:</p>
<ul>
<li><p>Any computation that depends on the value of a dict or a str input <strong>will be replaced with the
constant value</strong> seen during the one traced execution.</p></li>
<li><p>Any output that is a dict will be silently replaced with a <strong>flattened sequence of its values
(keys will be removed)</strong>. E.g. <code class="docutils literal notranslate"><span class="pre">{&quot;foo&quot;:</span> <span class="pre">1,</span> <span class="pre">&quot;bar&quot;:</span> <span class="pre">2}</span></code> becomes <code class="docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">2)</span></code>.</p></li>
<li><p>Any output that is a str will be silently removed.</p></li>
</ul>
</li>
<li><p>Certain operations involving tuples and lists are not supported in
<a class="reference internal" href="#tracing-vs-scripting"><span class="std std-ref">scripting</span></a> mode due to limited support in ONNX for nested sequences.
In particular appending a tuple to a list is not supported. In tracing mode, the nested sequences
will be flattened automatically during the tracing.</p></li>
</ul>
</section>
<section id="differences-in-operator-implementations">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Differences in Operator Implementations</a><a class="headerlink" href="#differences-in-operator-implementations" title="Link to this heading">#</a></h3>
<p>Due to differences in implementations of operators, running the exported model on different runtimes
may produce different results from each other or from PyTorch. Normally these differences are
numerically small, so this should only be a concern if your application is sensitive to these
small differences.</p>
</section>
<section id="unsupported-tensor-indexing-patterns">
<span id="tensor-indexing"></span><h3><a class="toc-backref" href="#id12" role="doc-backlink">Unsupported Tensor Indexing Patterns</a><a class="headerlink" href="#unsupported-tensor-indexing-patterns" title="Link to this heading">#</a></h3>
<p>Tensor indexing patterns that cannot be exported are listed below.
If you are experiencing issues exporting a model that does not include any of
the unsupported patterns below, please double check that you are exporting with
the latest <code class="docutils literal notranslate"><span class="pre">opset_version</span></code>.</p>
<section id="reads-gets">
<h4><a class="toc-backref" href="#id13" role="doc-backlink">Reads / Gets</a><a class="headerlink" href="#reads-gets" title="Link to this heading">#</a></h4>
<p>When indexing into a tensor for reading, the following patterns are not supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tensor indices that includes negative values.</span>
<span class="n">data</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span>
<span class="c1"># Workarounds: use positive index values.</span>
</pre></div>
</div>
</section>
<section id="writes-sets">
<h4><a class="toc-backref" href="#id14" role="doc-backlink">Writes / Sets</a><a class="headerlink" href="#writes-sets" title="Link to this heading">#</a></h4>
<p>When indexing into a Tensor for writing, the following patterns are not supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Multiple tensor indices if any has rank &gt;= 2</span>
<span class="n">data</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span> <span class="o">=</span> <span class="n">new_data</span>
<span class="c1"># Workarounds: use single tensor index with rank &gt;= 2,</span>
<span class="c1">#              or multiple consecutive tensor indices with rank == 1.</span>

<span class="c1"># Multiple tensor indices that are not consecutive</span>
<span class="n">data</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="p">:,</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])]</span> <span class="o">=</span> <span class="n">new_data</span>
<span class="c1"># Workarounds: transpose `data` such that tensor indices are consecutive.</span>

<span class="c1"># Tensor indices that includes negative values.</span>
<span class="n">data</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span> <span class="o">=</span> <span class="n">new_data</span>
<span class="c1"># Workarounds: use positive index values.</span>

<span class="c1"># Implicit broadcasting required for new_data.</span>
<span class="n">data</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_data</span>
<span class="c1"># Workarounds: expand new_data explicitly.</span>
<span class="c1"># Example:</span>
<span class="c1">#   data shape: [3, 4, 5]</span>
<span class="c1">#   new_data shape: [5]</span>
<span class="c1">#   expected new_data shape after broadcasting: [2, 2, 2, 5]</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="adding-support-for-operators">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Adding support for operators</a><a class="headerlink" href="#adding-support-for-operators" title="Link to this heading">#</a></h2>
<p>When exporting a model that includes unsupported operators, youll see an error message like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>RuntimeError: ONNX export failed: Couldn&#39;t export operator foo
</pre></div>
</div>
<p>When that happens, there are a few things you can do:</p>
<ol class="arabic simple">
<li><p>Change the model to not use that operator.</p></li>
<li><p>Create a symbolic function to convert the operator and register it as a custom symbolic function.</p></li>
<li><p>Contribute to PyTorch to add the same symbolic function to <a class="reference internal" href="#module-torch.onnx" title="torch.onnx"><code class="xref py py-mod docutils literal notranslate"><span class="pre">torch.onnx</span></code></a> itself.</p></li>
</ol>
<p>If you decided to implement a symbolic function (we hope you will contribute it back to PyTorch!), here is how you can get started:</p>
<section id="onnx-exporter-internals">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">ONNX exporter internals</a><a class="headerlink" href="#onnx-exporter-internals" title="Link to this heading">#</a></h3>
<p>A symbolic function is a function that decomposes a PyTorch operator into a
composition of a series of ONNX operators.</p>
<p>During export, each node (which contains a PyTorch operator) in the TorchScript
graph is visited by the exporter in topological order.
Upon visiting a node, the exporter looks for a registered symbolic functions for
that operator. Symbolic functions are implemented in Python. A symbolic function for
an op named <code class="docutils literal notranslate"><span class="pre">foo</span></code> would look something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span>
  <span class="n">g</span><span class="p">,</span>
  <span class="n">input_0</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">Value</span><span class="p">,</span>
  <span class="n">input_1</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">Value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">Value</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">Value</span><span class="p">]]:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Adds the ONNX operations representing this PyTorch function by updating the</span>
<span class="sd">  graph g with `g.op()` calls.</span>

<span class="sd">  Args:</span>
<span class="sd">    g (Graph): graph to write the ONNX representation into.</span>
<span class="sd">    input_0 (Value): value representing the variables which contain</span>
<span class="sd">        the first input for this operator.</span>
<span class="sd">    input_1 (Value): value representing the variables which contain</span>
<span class="sd">        the second input for this operator.</span>

<span class="sd">  Returns:</span>
<span class="sd">    A Value or List of Values specifying the ONNX nodes that compute something</span>
<span class="sd">    equivalent to the original PyTorch operator with the given inputs.</span>

<span class="sd">    None if it cannot be converted to ONNX.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">torch._C</span></code> types are Python wrappers around the types defined in C++ in
<a class="reference external" href="https://github.com/pytorch/pytorch/blob/main/torch/csrc/jit/ir/ir.h">ir.h</a>.</p>
<p>The process for adding a symbolic function depends on the type of operator.</p>
</section>
<section id="aten-operators">
<span id="adding-support-aten"></span><h3><a class="toc-backref" href="#id17" role="doc-backlink">ATen operators</a><a class="headerlink" href="#aten-operators" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://pytorch.org/cppdocs/#aten">ATen</a> is PyTorchs built-in tensor library.
If the operator is an ATen operator (shows up in the TorchScript graph with the prefix
<code class="docutils literal notranslate"><span class="pre">aten::</span></code>), make sure it is not supported already.</p>
<section id="list-of-supported-operators">
<h4><a class="toc-backref" href="#id18" role="doc-backlink">List of supported operators</a><a class="headerlink" href="#list-of-supported-operators" title="Link to this heading">#</a></h4>
<p>Visit the auto generated <span class="xref std std-doc">list of supported TorchScript operators</span>
for details on which operator are supported in each <code class="docutils literal notranslate"><span class="pre">opset_version</span></code>.</p>
</section>
<section id="adding-support-for-an-aten-or-quantized-operator">
<h4><a class="toc-backref" href="#id19" role="doc-backlink">Adding support for an aten or quantized operator</a><a class="headerlink" href="#adding-support-for-an-aten-or-quantized-operator" title="Link to this heading">#</a></h4>
<p>If the operator is not in the list above:</p>
<ul class="simple">
<li><p>Define the symbolic function in <code class="docutils literal notranslate"><span class="pre">torch/onnx/symbolic_opset&lt;version&gt;.py</span></code>, for example
<a class="reference external" href="https://github.com/pytorch/pytorch/blob/main/torch/onnx/symbolic_opset9.py">torch/onnx/symbolic_opset9.py</a>.
Make sure the function has the same name as the ATen function, which may be declared in
<code class="docutils literal notranslate"><span class="pre">torch/_C/_VariableFunctions.pyi</span></code> or <code class="docutils literal notranslate"><span class="pre">torch/nn/functional.pyi</span></code> (these files are generated at
build time, so will not appear in your checkout until you build PyTorch).</p></li>
<li><p>By default, the first arg is the ONNX graph.
Other arg names must EXACTLY match the names in the <code class="docutils literal notranslate"><span class="pre">.pyi</span></code> file,
because dispatch is done with keyword arguments.</p></li>
<li><p>In the symbolic function, if the operator is in the
<a class="reference external" href="https://github.com/onnx/onnx/blob/master/docs/Operators.md">ONNX standard operator set</a>,
we only need to create a node to represent the ONNX operator in the graph.
If not, we can compose several standard operators that have the
equivalent semantics to the ATen operator.</p></li>
</ul>
<p>Here is an example of handling missing symbolic function for the <code class="docutils literal notranslate"><span class="pre">ELU</span></code> operator.</p>
<p>If we run the following code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ELU</span><span class="p">(),</span> <span class="c1"># module</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># example input</span>
    <span class="p">)</span><span class="o">.</span><span class="n">graph</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We see something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="p">(</span><span class="o">%</span><span class="bp">self</span> <span class="p">:</span> <span class="n">__torch__</span><span class="o">.</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">activation</span><span class="o">.</span><span class="n">___torch_mangle_0</span><span class="o">.</span><span class="n">ELU</span><span class="p">,</span>
      <span class="o">%</span><span class="nb">input</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">requires_grad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">cpu</span><span class="p">)):</span>
  <span class="o">%</span><span class="mi">4</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mf">1.</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">5</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">6</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">7</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">requires_grad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">cpu</span><span class="p">)</span> <span class="o">=</span> <span class="n">aten</span><span class="p">::</span><span class="n">elu</span><span class="p">(</span><span class="o">%</span><span class="nb">input</span><span class="p">,</span> <span class="o">%</span><span class="mi">4</span><span class="p">,</span> <span class="o">%</span><span class="mi">5</span><span class="p">,</span> <span class="o">%</span><span class="mi">6</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">%</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
<p>Since we see <code class="docutils literal notranslate"><span class="pre">aten::elu</span></code> in the graph, we know this is an ATen operator.</p>
<p>We check the <a class="reference external" href="https://github.com/onnx/onnx/blob/master/docs/Operators.md">ONNX operator list</a>,
and confirm that <code class="docutils literal notranslate"><span class="pre">Elu</span></code> is standardized in ONNX.</p>
<p>We find a signature for <code class="docutils literal notranslate"><span class="pre">elu</span></code> in <code class="docutils literal notranslate"><span class="pre">torch/nn/functional.pyi</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">elu</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
<p>We add the following lines to <code class="docutils literal notranslate"><span class="pre">symbolic_opset9.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">elu</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Value</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Value</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">&quot;Elu&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">alpha_f</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
</pre></div>
</div>
<p>Now PyTorch is able to export models containing the <code class="docutils literal notranslate"><span class="pre">aten::elu</span></code> operator!</p>
<p>See the <code class="docutils literal notranslate"><span class="pre">torch/onnx/symbolic_opset*.py</span></code> files for more examples.</p>
</section>
</section>
<section id="torch-autograd-functions">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">torch.autograd.Functions</a><a class="headerlink" href="#torch-autograd-functions" title="Link to this heading">#</a></h3>
<p>If the operator is a sub-class of <a class="reference internal" href="autograd.html#torch.autograd.Function" title="torch.autograd.Function"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.autograd.Function</span></code></a>, there are three ways
to export it.</p>
<section id="static-symbolic-method">
<h4><a class="toc-backref" href="#id21" role="doc-backlink">Static Symbolic Method</a><a class="headerlink" href="#static-symbolic-method" title="Link to this heading">#</a></h4>
<p>You can add a static method named <code class="docutils literal notranslate"><span class="pre">symbolic</span></code> to your function class. It should return
ONNX operators that represent the functions behavior in ONNX. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyRelu</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Function</span><span class="p">):</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">save_for_backward</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">input</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">symbolic</span><span class="p">(</span><span class="n">g</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Value</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">&quot;Clip&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">&quot;Constant&quot;</span><span class="p">,</span> <span class="n">value_t</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)))</span>
</pre></div>
</div>
</section>
<section id="inline-autograd-function">
<h4><a class="toc-backref" href="#id22" role="doc-backlink">Inline Autograd Function</a><a class="headerlink" href="#inline-autograd-function" title="Link to this heading">#</a></h4>
<p>In cases where a static symbolic method is not provided for its subsequent <a class="reference internal" href="autograd.html#torch.autograd.Function" title="torch.autograd.Function"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.autograd.Function</span></code></a> or
where a function to register <code class="docutils literal notranslate"><span class="pre">prim::PythonOp</span></code> as custom symbolic functions is not provided,
<a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code></a> tries to inline the graph that corresponds to that <a class="reference internal" href="autograd.html#torch.autograd.Function" title="torch.autograd.Function"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.autograd.Function</span></code></a> such that
this function is broken down into individual operators that were used within the function.
The export should be successful as long as these individual operators are supported. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyLogExp</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Function</span><span class="p">):</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">save_for_backward</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">h</span><span class="o">.</span><span class="n">log</span><span class="p">()</span><span class="o">.</span><span class="n">log</span><span class="p">()</span>
</pre></div>
</div>
<p>There is no static symbolic method present for this model, yet it is exported as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="p">(</span><span class="o">%</span><span class="nb">input</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">requires_grad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">cpu</span><span class="p">)):</span>
    <span class="o">%</span><span class="mi">1</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Exp</span><span class="p">[](</span><span class="o">%</span><span class="nb">input</span><span class="p">)</span>
    <span class="o">%</span><span class="mi">2</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Log</span><span class="p">[](</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span>
    <span class="o">%</span><span class="mi">3</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Log</span><span class="p">[](</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="o">%</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>If you need to avoid inlining of <a class="reference internal" href="autograd.html#torch.autograd.Function" title="torch.autograd.Function"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.autograd.Function</span></code></a>, you should export models with
<code class="docutils literal notranslate"><span class="pre">operator_export_type</span></code> set to <code class="docutils literal notranslate"><span class="pre">ONNX_FALLTHROUGH</span></code> or <code class="docutils literal notranslate"><span class="pre">ONNX_ATEN_FALLBACK</span></code>.</p>
</section>
</section>
<section id="custom-operators">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">Custom operators</a><a class="headerlink" href="#custom-operators" title="Link to this heading">#</a></h3>
<p>You can export your model with custom operators that includes a combination of many standard ONNX ops,
or are driven by self-defined C++ backend.</p>
<section id="onnx-script-functions">
<h4><a class="toc-backref" href="#id24" role="doc-backlink">ONNX-script functions</a><a class="headerlink" href="#onnx-script-functions" title="Link to this heading">#</a></h4>
<p>If an operator is not a standard ONNX op, but can be composed of multiple existing ONNX ops, you can utilize
<a class="reference external" href="https://github.com/microsoft/onnx-script">ONNX-script</a> to create an external ONNX function to support the operator.
You can export it by following this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">onnxscript</span>
<span class="c1"># There are three opset version needed to be aligned</span>
<span class="c1"># This is (1) the opset version in ONNX function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">onnxscript.onnx_opset</span><span class="w"> </span><span class="kn">import</span> <span class="n">opset15</span> <span class="k">as</span> <span class="n">op</span>
<span class="n">opset_version</span> <span class="o">=</span> <span class="mi">15</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">SELU</span><span class="p">()</span>

<span class="n">custom_opset</span> <span class="o">=</span> <span class="n">onnxscript</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">Opset</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="s2">&quot;onnx-script&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="nd">@onnxscript</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">custom_opset</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">Selu</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.67326</span>  <span class="c1"># auto wrapped as Constants</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.0507</span>
    <span class="n">alphaX</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">CastLike</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
    <span class="n">gammaX</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">CastLike</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
    <span class="n">neg</span> <span class="o">=</span> <span class="n">gammaX</span> <span class="o">*</span> <span class="p">(</span><span class="n">alphaX</span> <span class="o">*</span> <span class="n">op</span><span class="o">.</span><span class="n">Exp</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">-</span> <span class="n">alphaX</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">gammaX</span> <span class="o">*</span> <span class="n">X</span>
    <span class="n">zero</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">CastLike</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">op</span><span class="o">.</span><span class="n">Where</span><span class="p">(</span><span class="n">X</span> <span class="o">&lt;=</span> <span class="n">zero</span><span class="p">,</span> <span class="n">neg</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

<span class="c1"># setType API provides shape/type to ONNX shape/type inference</span>
<span class="k">def</span><span class="w"> </span><span class="nf">custom_selu</span><span class="p">(</span><span class="n">g</span><span class="p">:</span> <span class="n">jit_utils</span><span class="o">.</span><span class="n">GraphContext</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">onnxscript_op</span><span class="p">(</span><span class="n">Selu</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">type</span><span class="p">())</span>

<span class="c1"># Register custom symbolic function</span>
<span class="c1"># There are three opset version needed to be aligned</span>
<span class="c1"># This is (2) the opset version in registry</span>
<span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">register_custom_op_symbolic</span><span class="p">(</span>
    <span class="n">symbolic_name</span><span class="o">=</span><span class="s2">&quot;aten::selu&quot;</span><span class="p">,</span>
    <span class="n">symbolic_fn</span><span class="o">=</span><span class="n">custom_selu</span><span class="p">,</span>
    <span class="n">opset_version</span><span class="o">=</span><span class="n">opset_version</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># There are three opset version needed to be aligned</span>
<span class="c1"># This is (2) the opset version in exporter</span>
<span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="s2">&quot;model.onnx&quot;</span><span class="p">,</span>
    <span class="n">opset_version</span><span class="o">=</span><span class="n">opset_version</span><span class="p">,</span>
    <span class="c1"># only needed if you want to specify an opset version &gt; 1.</span>
    <span class="n">custom_opsets</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;onnx-script&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The example above exports it as a custom operator in the onnx-script opset.
When exporting a custom operator, you can specify the custom domain version using the
<code class="docutils literal notranslate"><span class="pre">custom_opsets</span></code> dictionary at export. If not specified, the custom opset version defaults to 1.</p>
<p>NOTE: Be careful to align the opset version mentioned in the above example, and make sure they are consumed in exporter step.
The example usage of how to write a onnx-script function is a beta version in terms of the active development on onnx-script.
Please follow the latest <a class="reference external" href="https://github.com/microsoft/onnx-script">ONNX-script</a></p>
</section>
<section id="c-operators">
<h4><a class="toc-backref" href="#id25" role="doc-backlink">C++ Operators</a><a class="headerlink" href="#c-operators" title="Link to this heading">#</a></h4>
<p>If a model uses a custom operator implemented in C++ as described in
<a class="reference external" href="https://pytorch.org/tutorials/advanced/torch_script_custom_ops.html">Extending TorchScript with Custom C++ Operators</a>,
you can export it by following this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">torch.onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">symbolic_helper</span>


<span class="c1"># Define custom symbolic function</span>
<span class="nd">@symbolic_helper</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">symbolic_foo_forward</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">,</span> <span class="n">attr1</span><span class="p">,</span> <span class="n">attr2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">&quot;custom_domain::Foo&quot;</span><span class="p">,</span> <span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">,</span> <span class="n">attr1_f</span><span class="o">=</span><span class="n">attr1</span><span class="p">,</span> <span class="n">attr2_i</span><span class="o">=</span><span class="n">attr2</span><span class="p">)</span>


<span class="c1"># Register custom symbolic function</span>
<span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">register_custom_op_symbolic</span><span class="p">(</span><span class="s2">&quot;custom_ops::foo_forward&quot;</span><span class="p">,</span> <span class="n">symbolic_foo_forward</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">FooModel</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr1</span><span class="p">,</span> <span class="n">attr2</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr1</span> <span class="o">=</span> <span class="n">attr1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr2</span> <span class="o">=</span> <span class="n">attr2</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">):</span>
        <span class="c1"># Calling custom op</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">custom_ops</span><span class="o">.</span><span class="n">foo_forward</span><span class="p">(</span><span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr2</span><span class="p">)</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">FooModel</span><span class="p">(</span><span class="n">attr1</span><span class="p">,</span> <span class="n">attr2</span><span class="p">)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="p">(</span><span class="n">example_input1</span><span class="p">,</span> <span class="n">example_input1</span><span class="p">),</span>
    <span class="s2">&quot;model.onnx&quot;</span><span class="p">,</span>
    <span class="c1"># only needed if you want to specify an opset version &gt; 1.</span>
    <span class="n">custom_opsets</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;custom_domain&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The example above exports it as a custom operator in the custom_domain opset.
When exporting a custom operator, you can specify the custom domain version using the
<code class="docutils literal notranslate"><span class="pre">custom_opsets</span></code> dictionary at export. If not specified, the custom opset version defaults to 1.</p>
<p>The runtime that consumes the model needs to support the custom op. See
<a class="reference external" href="https://caffe2.ai/docs/custom-operators.html">Caffe2 custom ops</a>,
<a class="reference external" href="https://onnxruntime.ai/docs/reference/operators/add-custom-op.html">ONNX Runtime custom ops</a>,
or your runtime of choices documentation.</p>
</section>
</section>
<section id="discovering-all-unconvertible-aten-ops-at-once">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">Discovering all unconvertible ATen ops at once</a><a class="headerlink" href="#discovering-all-unconvertible-aten-ops-at-once" title="Link to this heading">#</a></h3>
<p>When export fails due to an unconvertible ATen op, there may in fact be more
than one such op but the error message only mentions the first. To discover
all of the unconvertible ops in one go you can:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># prepare model, args, opset_version</span>
<span class="o">...</span>

<span class="n">torch_script_graph</span><span class="p">,</span> <span class="n">unconvertible_ops</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">unconvertible_ops</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">opset_version</span><span class="o">=</span><span class="n">opset_version</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">unconvertible_ops</span><span class="p">))</span>
</pre></div>
</div>
<p>The set is approximated because some ops may be removed during the conversion
process and dont need to be converted. Some other ops may have partial support
that will fail conversion with particular inputs, but this should give you a
general idea of what ops are not supported. Please feel free to open GitHub Issues
for op support requests.</p>
</section>
</section>
<section id="frequently-asked-questions">
<h2><a class="toc-backref" href="#id27" role="doc-backlink">Frequently Asked Questions</a><a class="headerlink" href="#frequently-asked-questions" title="Link to this heading">#</a></h2>
<p>Q: I have exported my LSTM model, but its input size seems to be fixed?</p>
<blockquote>
<div><p>The tracer records the shapes of the example inputs. If the model should accept
inputs of dynamic shapes, set <code class="docutils literal notranslate"><span class="pre">dynamic_axes</span></code> when calling <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code></a>.</p>
</div></blockquote>
<p>Q: How to export models containing loops?</p>
<blockquote>
<div><p>See <a class="reference internal" href="#id1">Tracing vs Scripting</a>.</p>
</div></blockquote>
<p>Q: How to export models with primitive type inputs (e.g. int, float)?</p>
<blockquote>
<div><p>Support for primitive numeric type inputs was added in PyTorch 1.9.
However, the exporter does not support models with str inputs.</p>
</div></blockquote>
<p>Q: Does ONNX support implicit scalar datatype casting?</p>
<blockquote>
<div><p>The ONNX standard does not, but the exporter will try to handle that part.
Scalars are exported as constant tensors.
The exporter will figure out the right data type for scalars. In rare cases when it is unable
to do so, you will need to manually specify the datatype with e.g. <cite>dtype=torch.float32</cite>.
If you see any errors, please [create a GitHub issue](<a class="github reference external" href="https://github.com/pytorch/pytorch/issues">pytorch/pytorch#issues</a>).</p>
</div></blockquote>
<p>Q: Are lists of Tensors exportable to ONNX?</p>
<blockquote>
<div><p>Yes, for <code class="docutils literal notranslate"><span class="pre">opset_version</span></code> &gt;= 11, since ONNX introduced the Sequence type in opset 11.</p>
</div></blockquote>
</section>
<section id="module-torch.onnx">
<span id="python-api"></span><h2><a class="toc-backref" href="#id28" role="doc-backlink">Python API</a><a class="headerlink" href="#module-torch.onnx" title="Link to this heading">#</a></h2>
<section id="functions">
<h3><a class="toc-backref" href="#id29" role="doc-backlink">Functions</a><a class="headerlink" href="#functions" title="Link to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="torch.onnx.export">
<span class="sig-prename descclassname"><span class="pre">torch.onnx.</span></span><span class="sig-name descname"><span class="pre">export</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">args=()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">f=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kwargs=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">export_params=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_names=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_names=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opset_version=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dynamic_axes=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_initializers_as_inputs=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dynamo=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">external_data=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dynamic_shapes=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_translation_table=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">report=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimize=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verify=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">profile=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dump_exported_program=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">artifacts_dir='.'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fallback=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">training=&lt;TrainingMode.EVAL:</span> <span class="pre">0&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">operator_export_type=&lt;OperatorExportTypes.ONNX:</span> <span class="pre">0&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_constant_folding=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_opsets=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">export_modules_as_functions=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">autograd_inlining=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**_</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/torch/onnx.html#export"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="reference external" href="https://github.com/pytorch/pytorch/blob/2236df1770800ffea5697b11b0bb0d910b2e59e1/torch/onnx/__init__.py#L129"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.onnx.export" title="Link to this definition">#</a></dt>
<dd><p>Exports a model into ONNX format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<a class="reference internal" href="generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module"><em>torch.nn.Module</em></a><em> | </em><a class="reference internal" href="export.html#torch.export.ExportedProgram" title="torch.export.ExportedProgram"><em>torch.export.ExportedProgram</em></a><em> | </em><a class="reference internal" href="generated/torch.jit.ScriptModule.html#torch.jit.ScriptModule" title="torch.jit.ScriptModule"><em>torch.jit.ScriptModule</em></a><em> | </em><a class="reference internal" href="generated/torch.jit.ScriptFunction.html#torch.jit.ScriptFunction" title="torch.jit.ScriptFunction"><em>torch.jit.ScriptFunction</em></a>)  The model to be exported.</p></li>
<li><p><strong>args</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><em>tuple</em></a><em>[</em><em>Any</em><em>, </em><em>...</em><em>]</em>)  Example positional inputs. Any non-Tensor arguments will be hard-coded into the
exported model; any Tensor arguments will become inputs of the exported model,
in the order they occur in the tuple.</p></li>
<li><p><strong>f</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em> | </em><a class="reference external" href="https://docs.python.org/3/library/os.html#os.PathLike" title="(in Python v3.13)"><em>os.PathLike</em></a><em> | </em><em>None</em>)  Path to the output ONNX model file. E.g. model.onnx.</p></li>
<li><p><strong>kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><em>dict</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>, </em><em>Any</em><em>] </em><em>| </em><em>None</em>)  Optional example keyword inputs.</p></li>
<li><p><strong>export_params</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a>)  If false, parameters (weights) will not be exported.</p></li>
<li><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a><em> | </em><em>None</em>)  Whether to enable verbose logging.</p></li>
<li><p><strong>input_names</strong> (<em>Sequence</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>] </em><em>| </em><em>None</em>)  names to assign to the input nodes of the graph, in order.</p></li>
<li><p><strong>output_names</strong> (<em>Sequence</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>] </em><em>| </em><em>None</em>)  names to assign to the output nodes of the graph, in order.</p></li>
<li><p><strong>opset_version</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em> | </em><em>None</em>)  The version of the
<a class="reference external" href="https://github.com/onnx/onnx/blob/master/docs/Operators.md">default (ai.onnx) opset</a>
to target. Must be &gt;= 7.</p></li>
<li><p><strong>dynamic_axes</strong> (<em>Mapping</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>, </em><em>Mapping</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>]</em><em>] </em><em>| </em><em>Mapping</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>, </em><em>Sequence</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em>]</em><em>] </em><em>| </em><em>None</em>)  <p>By default the exported model will have the shapes of all input and output tensors
set to exactly match those given in <code class="docutils literal notranslate"><span class="pre">args</span></code>. To specify axes of tensors as
dynamic (i.e. known only at run-time), set <code class="docutils literal notranslate"><span class="pre">dynamic_axes</span></code> to a dict with schema:</p>
<ul>
<li><dl class="simple">
<dt>KEY (str): an input or output name. Each name must also be provided in <code class="docutils literal notranslate"><span class="pre">input_names</span></code> or</dt><dd><p><code class="docutils literal notranslate"><span class="pre">output_names</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>VALUE (dict or list): If a dict, keys are axis indices and values are axis names. If a</dt><dd><p>list, each element is an axis index.</p>
</dd>
</dl>
</li>
</ul>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">SumModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
    <span class="n">SumModule</span><span class="p">(),</span>
    <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),),</span>
    <span class="s2">&quot;onnx.pb&quot;</span><span class="p">,</span>
    <span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
    <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Produces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">input</span> <span class="p">{</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;x&quot;</span>
  <span class="o">...</span>
      <span class="n">shape</span> <span class="p">{</span>
        <span class="n">dim</span> <span class="p">{</span>
          <span class="n">dim_value</span><span class="p">:</span> <span class="mi">2</span>  <span class="c1"># axis 0</span>
        <span class="p">}</span>
        <span class="n">dim</span> <span class="p">{</span>
          <span class="n">dim_value</span><span class="p">:</span> <span class="mi">2</span>  <span class="c1"># axis 1</span>
<span class="o">...</span>
<span class="n">output</span> <span class="p">{</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span>
  <span class="o">...</span>
      <span class="n">shape</span> <span class="p">{</span>
        <span class="n">dim</span> <span class="p">{</span>
          <span class="n">dim_value</span><span class="p">:</span> <span class="mi">2</span>  <span class="c1"># axis 0</span>
<span class="o">...</span>
</pre></div>
</div>
<p>While:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
    <span class="n">SumModule</span><span class="p">(),</span>
    <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),),</span>
    <span class="s2">&quot;onnx.pb&quot;</span><span class="p">,</span>
    <span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
    <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">],</span>
    <span class="n">dynamic_axes</span><span class="o">=</span><span class="p">{</span>
        <span class="c1"># dict value: manually named axes</span>
        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;my_custom_axis_name&quot;</span><span class="p">},</span>
        <span class="c1"># list value: automatic names</span>
        <span class="s2">&quot;sum&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Produces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">input</span> <span class="p">{</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;x&quot;</span>
  <span class="o">...</span>
      <span class="n">shape</span> <span class="p">{</span>
        <span class="n">dim</span> <span class="p">{</span>
          <span class="n">dim_param</span><span class="p">:</span> <span class="s2">&quot;my_custom_axis_name&quot;</span>  <span class="c1"># axis 0</span>
        <span class="p">}</span>
        <span class="n">dim</span> <span class="p">{</span>
          <span class="n">dim_value</span><span class="p">:</span> <span class="mi">2</span>  <span class="c1"># axis 1</span>
<span class="o">...</span>
<span class="n">output</span> <span class="p">{</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span>
  <span class="o">...</span>
      <span class="n">shape</span> <span class="p">{</span>
        <span class="n">dim</span> <span class="p">{</span>
          <span class="n">dim_param</span><span class="p">:</span> <span class="s2">&quot;sum_dynamic_axes_1&quot;</span>  <span class="c1"># axis 0</span>
<span class="o">...</span>
</pre></div>
</div>
</p></li>
<li><p><strong>keep_initializers_as_inputs</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a>)  <p>If True, all the
initializers (typically corresponding to model weights) in the
exported graph will also be added as inputs to the graph. If False,
then initializers are not added as inputs to the graph, and only
the user inputs are added as inputs.</p>
<p>Set this to True if you intend to supply model weights at runtime.
Set it to False if the weights are static to allow for better optimizations
(e.g. constant folding) by backends/runtimes.</p>
</p></li>
<li><p><strong>dynamo</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a>)  Whether to export the model with <code class="docutils literal notranslate"><span class="pre">torch.export</span></code> ExportedProgram instead of TorchScript.</p></li>
<li><p><strong>external_data</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a>)  Whether to save the model weights as an external data file.
This is required for models with large weights that exceed the ONNX file size limit (2GB).
When False, the weights are saved in the ONNX file with the model architecture.</p></li>
<li><p><strong>dynamic_shapes</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><em>dict</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>, </em><em>Any</em><em>] </em><em>| </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><em>tuple</em></a><em>[</em><em>Any</em><em>, </em><em>...</em><em>] </em><em>| </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><em>list</em></a><em>[</em><em>Any</em><em>] </em><em>| </em><em>None</em>)  A dictionary or a tuple of dynamic shapes for the model inputs. Refer to
<a class="reference internal" href="export.html#torch.export.export" title="torch.export.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.export.export()</span></code></a> for more details. This is only used (and preferred) when dynamo is True.
Note that dynamic_shapes is designed to be used when the model is exported with dynamo=True, while
dynamic_axes is used when dynamo=False.</p></li>
<li><p><strong>custom_translation_table</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><em>dict</em></a><em>[</em><em>Callable</em><em>, </em><em>Callable</em><em> | </em><em>Sequence</em><em>[</em><em>Callable</em><em>]</em><em>] </em><em>| </em><em>None</em>)  A dictionary of custom decompositions for operators in the model.
The dictionary should have the callable target in the fx Node as the key (e.g. <code class="docutils literal notranslate"><span class="pre">torch.ops.aten.stft.default</span></code>),
and the value should be a function that builds that graph using ONNX Script. This option
is only valid when dynamo is True.</p></li>
<li><p><strong>report</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a>)  Whether to generate a markdown report for the export process. This option
is only valid when dynamo is True.</p></li>
<li><p><strong>optimize</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a>)  Whether to optimize the exported model. This option
is only valid when dynamo is True.</p></li>
<li><p><strong>verify</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a>)  Whether to verify the exported model using ONNX Runtime. This option
is only valid when dynamo is True.</p></li>
<li><p><strong>profile</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a>)  Whether to profile the export process. This option
is only valid when dynamo is True.</p></li>
<li><p><strong>dump_exported_program</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a>)  Whether to dump the <a class="reference internal" href="export.html#torch.export.ExportedProgram" title="torch.export.ExportedProgram"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.export.ExportedProgram</span></code></a> to a file.
This is useful for debugging the exporter. This option is only valid when dynamo is True.</p></li>
<li><p><strong>artifacts_dir</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em> | </em><a class="reference external" href="https://docs.python.org/3/library/os.html#os.PathLike" title="(in Python v3.13)"><em>os.PathLike</em></a>)  The directory to save the debugging artifacts like the report and the serialized
exported program. This option is only valid when dynamo is True.</p></li>
<li><p><strong>fallback</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a>)  Whether to fallback to the TorchScript exporter if the dynamo exporter fails.
This option is only valid when dynamo is True. When fallback is enabled, It is
recommended to set dynamic_axes even when dynamic_shapes is provided.</p></li>
<li><p><strong>training</strong> (<em>_C_onnx.TrainingMode</em>)  Deprecated option. Instead, set the training mode of the model before exporting.</p></li>
<li><p><strong>operator_export_type</strong> (<em>_C_onnx.OperatorExportTypes</em>)  Deprecated option. Only ONNX is supported.</p></li>
<li><p><strong>do_constant_folding</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a>)  Deprecated option.</p></li>
<li><p><strong>custom_opsets</strong> (<em>Mapping</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em>] </em><em>| </em><em>None</em>)  <p>Deprecated.
A dictionary:</p>
<ul>
<li><p>KEY (str): opset domain name</p></li>
<li><p>VALUE (int): opset version</p></li>
</ul>
<p>If a custom opset is referenced by <code class="docutils literal notranslate"><span class="pre">model</span></code> but not mentioned in this dictionary,
the opset version is set to 1. Only custom opset domain name and version should be
indicated through this argument.</p>
</p></li>
<li><p><strong>export_modules_as_functions</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a><em> | </em><em>Collection</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#type" title="(in Python v3.13)"><em>type</em></a><em>[</em><a class="reference internal" href="generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module"><em>torch.nn.Module</em></a><em>]</em><em>]</em>)  <p>Deprecated option.</p>
<p>Flag to enable
exporting all <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> forward calls as local functions in ONNX. Or a set to indicate the
particular types of modules to export as local functions in ONNX.
This feature requires <code class="docutils literal notranslate"><span class="pre">opset_version</span></code> &gt;= 15, otherwise the export will fail. This is because
<code class="docutils literal notranslate"><span class="pre">opset_version</span></code> &lt; 15 implies IR version &lt; 8, which means no local function support.
Module variables will be exported as function attributes. There are two categories of function
attributes.</p>
<p>1. Annotated attributes: class variables that have type annotations via
<a class="reference external" href="https://www.python.org/dev/peps/pep-0526/#class-and-instance-variable-annotations">PEP 526-style</a>
will be exported as attributes.
Annotated attributes are not used inside the subgraph of ONNX local function because
they are not created by PyTorch JIT tracing, but they may be used by consumers
to determine whether or not to replace the function with a particular fused kernel.</p>
<p>2. Inferred attributes: variables that are used by operators inside the module. Attribute names
will have prefix inferred::. This is to differentiate from predefined attributes retrieved from
python module annotations. Inferred attributes are used inside the subgraph of ONNX local function.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">False</span></code> (default): export <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> forward calls as fine grained nodes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">True</span></code>: export all <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> forward calls as local function nodes.</p></li>
<li><dl class="simple">
<dt>Set of type of nn.Module: export <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> forward calls as local function nodes,</dt><dd><p>only if the type of the <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> is found in the set.</p>
</dd>
</dl>
</li>
</ul>
</p></li>
<li><p><strong>autograd_inlining</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a>)  Deprecated.
Flag used to control whether to inline autograd functions.
Refer to <a class="github reference external" href="https://github.com/pytorch/pytorch/pull/74765">pytorch/pytorch#74765</a> for more details.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="onnx_dynamo.html#torch.onnx.ONNXProgram" title="torch.onnx.ONNXProgram">ONNXProgram</a> | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="torch.onnx.register_custom_op_symbolic">
<span class="sig-prename descclassname"><span class="pre">torch.onnx.</span></span><span class="sig-name descname"><span class="pre">register_custom_op_symbolic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbolic_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">symbolic_fn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opset_version</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/torch/onnx/utils.html#register_custom_op_symbolic"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="reference external" href="https://github.com/pytorch/pytorch/blob/2236df1770800ffea5697b11b0bb0d910b2e59e1/torch/onnx/utils.py#L1756"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.onnx.register_custom_op_symbolic" title="Link to this definition">#</a></dt>
<dd><p>Registers a symbolic function for a custom operator.</p>
<p>When the user registers symbolic for custom/contrib ops,
it is highly recommended to add shape inference for that operator via setType API,
otherwise the exported graph may have incorrect shape inference in some extreme cases.
An example of setType is <cite>test_aten_embedding_2</cite> in <cite>test_operators.py</cite>.</p>
<p>See Custom Operators in the module documentation for an example usage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>symbolic_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>)  The name of the custom operator in &lt;domain&gt;::&lt;op&gt;
format.</p></li>
<li><p><strong>symbolic_fn</strong> (<em>Callable</em>)  A function that takes in the ONNX graph and
the input arguments to the current operator, and returns new
operator nodes to add to the graph.</p></li>
<li><p><strong>opset_version</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a>)  The ONNX opset version in which to register.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="torch.onnx.unregister_custom_op_symbolic">
<span class="sig-prename descclassname"><span class="pre">torch.onnx.</span></span><span class="sig-name descname"><span class="pre">unregister_custom_op_symbolic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbolic_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opset_version</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/torch/onnx/utils.html#unregister_custom_op_symbolic"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="reference external" href="https://github.com/pytorch/pytorch/blob/2236df1770800ffea5697b11b0bb0d910b2e59e1/torch/onnx/utils.py#L1786"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.onnx.unregister_custom_op_symbolic" title="Link to this definition">#</a></dt>
<dd><p>Unregisters <code class="docutils literal notranslate"><span class="pre">symbolic_name</span></code>.</p>
<p>See Custom Operators in the module documentation for an example usage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>symbolic_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>)  The name of the custom operator in &lt;domain&gt;::&lt;op&gt;
format.</p></li>
<li><p><strong>opset_version</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a>)  The ONNX opset version in which to unregister.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="torch.onnx.select_model_mode_for_export">
<span class="sig-prename descclassname"><span class="pre">torch.onnx.</span></span><span class="sig-name descname"><span class="pre">select_model_mode_for_export</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/torch/onnx/utils.html#select_model_mode_for_export"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="reference external" href="https://github.com/pytorch/pytorch/blob/2236df1770800ffea5697b11b0bb0d910b2e59e1/torch/onnx/utils.py#L54"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.onnx.select_model_mode_for_export" title="Link to this definition">#</a></dt>
<dd><p>A context manager to temporarily set the training mode of <code class="docutils literal notranslate"><span class="pre">model</span></code>
to <code class="docutils literal notranslate"><span class="pre">mode</span></code>, resetting it when we exit the with-block.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong>  Same type and meaning as <code class="docutils literal notranslate"><span class="pre">model</span></code> arg to <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">export()</span></code></a>.</p></li>
<li><p><strong>mode</strong> (<em>TrainingMode</em>)  Same type and meaning as <code class="docutils literal notranslate"><span class="pre">training</span></code> arg to <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">export()</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="torch.onnx.is_in_onnx_export">
<span class="sig-prename descclassname"><span class="pre">torch.onnx.</span></span><span class="sig-name descname"><span class="pre">is_in_onnx_export</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/torch/onnx/utils.html#is_in_onnx_export"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="reference external" href="https://github.com/pytorch/pytorch/blob/2236df1770800ffea5697b11b0bb0d910b2e59e1/torch/onnx/utils.py#L44"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.onnx.is_in_onnx_export" title="Link to this definition">#</a></dt>
<dd><p>Returns whether it is in the middle of ONNX export.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)">bool</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="torch.onnx.verification.find_mismatch">
<span class="sig-prename descclassname"><span class="pre">torch.onnx.verification.</span></span><span class="sig-name descname"><span class="pre">find_mismatch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_constant_folding=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">training=&lt;TrainingMode.EVAL:</span> <span class="pre">0&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opset_version=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_initializers_as_inputs=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">options=None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/torch/onnx/verification.html#find_mismatch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="reference external" href="https://github.com/pytorch/pytorch/blob/2236df1770800ffea5697b11b0bb0d910b2e59e1/torch/onnx/verification.py#L1677"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.onnx.verification.find_mismatch" title="Link to this definition">#</a></dt>
<dd><p>Find all mismatches between the original model and the exported model.</p>
<p>Experimental. The API is subject to change.</p>
<p>This tool helps debug the mismatch between the original PyTorch model and exported
ONNX model. It binary searches the model graph to find the minimal subgraph that
exhibits the mismatch.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<a class="reference internal" href="generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.modules.module.Module"><em>Module</em></a><em> | </em><a class="reference internal" href="generated/torch.jit.ScriptModule.html#torch.jit.ScriptModule" title="torch.jit._script.ScriptModule"><em>ScriptModule</em></a>)  The model to be exported.</p></li>
<li><p><strong>input_args</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><em>tuple</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><em>Any</em></a><em>, </em><em>...</em><em>]</em>)  The input arguments to the model.</p></li>
<li><p><strong>do_constant_folding</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a>)  Same as <cite>do_constant_folding</cite> in <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code></a>.</p></li>
<li><p><strong>training</strong> (<em>TrainingMode</em>)  Same as <cite>training</cite> in <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code></a>.</p></li>
<li><p><strong>opset_version</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em> | </em><em>None</em>)  Same as <cite>opset_version</cite> in <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code></a>.</p></li>
<li><p><strong>keep_initializers_as_inputs</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a>)  Same as <cite>keep_initializers_as_inputs</cite> in <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code></a>.</p></li>
<li><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a>)  Same as <cite>verbose</cite> in <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code></a>.</p></li>
<li><p><strong>options</strong> (<a class="reference internal" href="generated/torch.onnx.verification.VerificationOptions.html#torch.onnx.verification.VerificationOptions" title="torch.onnx.verification.VerificationOptions"><em>VerificationOptions</em></a><em> | </em><em>None</em>)  The options for the mismatch verification.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A GraphInfo object that contains the mismatch information.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><p id="torch.onnx.verification.GraphInfo"/><p id="torch.onnx.verification.GraphInfo"/><a class="reference internal" href="generated/torch.onnx.verification.GraphInfo.html#torch.onnx.verification.GraphInfo" title="torch.onnx.verification.GraphInfo"><em>GraphInfo</em></a></p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">torch.onnx.verification</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">opset_version</span> <span class="o">=</span> <span class="mi">15</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define a custom symbolic function for aten::relu.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># The custom symbolic function is incorrect, which will result in mismatches.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span><span class="w"> </span><span class="nf">incorrect_relu_symbolic_function</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="bp">self</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">register_custom_op_symbolic</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s2">&quot;aten::relu&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">incorrect_relu_symbolic_function</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">opset_version</span><span class="o">=</span><span class="n">opset_version</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
<span class="gp">... </span>            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
<span class="gp">... </span>            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">graph_info</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">verification</span><span class="o">.</span><span class="n">find_mismatch</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">Model</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),),</span>
<span class="gp">... </span>    <span class="n">opset_version</span><span class="o">=</span><span class="n">opset_version</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">===================== Mismatch info for graph partition : ======================</span>
<span class="go">================================ Mismatch error ================================</span>
<span class="go">Tensor-likes are not close!</span>
<span class="go">Mismatched elements: 12 / 12 (100.0%)</span>
<span class="go">Greatest absolute difference: 0.2328854203224182 at index (1, 2) (up to 1e-07 allowed)</span>
<span class="go">Greatest relative difference: 0.699536174352349 at index (1, 3) (up to 0.001 allowed)</span>
<span class="go">==================================== Tree: =====================================</span>
<span class="go">5 X   __2 X    __1 \u2713</span>
<span class="go">id:  |  id: 0 |  id: 00</span>
<span class="go">     |        |</span>
<span class="go">     |        |__1 X (aten::relu)</span>
<span class="go">     |           id: 01</span>
<span class="go">     |</span>
<span class="go">     |__3 X    __1 \u2713</span>
<span class="go">        id: 1 |  id: 10</span>
<span class="go">              |</span>
<span class="go">              |__2 X     __1 X (aten::relu)</span>
<span class="go">                 id: 11 |  id: 110</span>
<span class="go">                        |</span>
<span class="go">                        |__1 \u2713</span>
<span class="go">                           id: 111</span>
<span class="go">=========================== Mismatch leaf subgraphs: ===========================</span>
<span class="go">[&#39;01&#39;, &#39;110&#39;]</span>
<span class="go">============================= Mismatch node kinds: =============================</span>
<span class="go">{&#39;aten::relu&#39;: 2}</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="classes">
<h3><a class="toc-backref" href="#id30" role="doc-backlink">Classes</a><a class="headerlink" href="#classes" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="autosummary longtable table autosummary">
<tbody>
<tr class="row-odd"><td><p><p id="torch.onnx.JitScalarType"/><p id="torch.onnx.JitScalarType"/><a class="reference internal" href="generated/torch.onnx.JitScalarType.html#torch.onnx.JitScalarType" title="torch.onnx.JitScalarType"><code class="xref py py-obj docutils literal notranslate"><span class="pre">JitScalarType</span></code></a></p></td>
<td><p>Scalar types defined in torch.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="generated/torch.onnx.verification.GraphInfo.html#torch.onnx.verification.GraphInfo" title="torch.onnx.verification.GraphInfo"><code class="xref py py-obj docutils literal notranslate"><span class="pre">verification.GraphInfo</span></code></a></p></td>
<td><p>GraphInfo contains validation information of a TorchScript graph and its converted ONNX graph.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/torch.onnx.verification.VerificationOptions.html#torch.onnx.verification.VerificationOptions" title="torch.onnx.verification.VerificationOptions"><code class="xref py py-obj docutils literal notranslate"><span class="pre">verification.VerificationOptions</span></code></a></p></td>
<td><p>Options for ONNX export verification.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-alexnet-from-pytorch-to-onnx">Example: AlexNet from PyTorch to ONNX</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tracing-vs-scripting">Tracing vs Scripting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#avoiding-pitfalls">Avoiding Pitfalls</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#avoid-numpy-and-built-in-python-types">Avoid NumPy and built-in Python types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#avoid-tensor-data">Avoid Tensor.data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#avoid-in-place-operations-when-using-tensor-shape-in-tracing-mode">Avoid in-place operations when using tensor.shape in tracing mode</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#limitations">Limitations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#types">Types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#differences-in-operator-implementations">Differences in Operator Implementations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unsupported-tensor-indexing-patterns">Unsupported Tensor Indexing Patterns</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#reads-gets">Reads / Gets</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#writes-sets">Writes / Sets</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-support-for-operators">Adding support for operators</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#onnx-exporter-internals">ONNX exporter internals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aten-operators">ATen operators</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#list-of-supported-operators">List of supported operators</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-support-for-an-aten-or-quantized-operator">Adding support for an aten or quantized operator</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#torch-autograd-functions">torch.autograd.Functions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#static-symbolic-method">Static Symbolic Method</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#inline-autograd-function">Inline Autograd Function</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-operators">Custom operators</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#onnx-script-functions">ONNX-script functions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#c-operators">C++ Operators</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#discovering-all-unconvertible-aten-ops-at-once">Discovering all unconvertible ATen ops at once</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#frequently-asked-questions">Frequently Asked Questions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-torch.onnx">Python API</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">Functions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#torch.onnx.export"><code class="docutils literal notranslate"><span class="pre">export()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#torch.onnx.register_custom_op_symbolic"><code class="docutils literal notranslate"><span class="pre">register_custom_op_symbolic()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#torch.onnx.unregister_custom_op_symbolic"><code class="docutils literal notranslate"><span class="pre">unregister_custom_op_symbolic()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#torch.onnx.select_model_mode_for_export"><code class="docutils literal notranslate"><span class="pre">select_model_mode_for_export()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#torch.onnx.is_in_onnx_export"><code class="docutils literal notranslate"><span class="pre">is_in_onnx_export()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#torch.onnx.verification.find_mismatch"><code class="docutils literal notranslate"><span class="pre">find_mismatch()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#classes">Classes</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/pytorch/pytorch/edit/main/docs/source/python-api/onnx_torchscript.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">
    <div class="tocsection sourcelink">
      <a href="../_sources/python-api/onnx_torchscript.rst.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
      </a>
    </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>


  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
       Copyright PyTorch Contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>