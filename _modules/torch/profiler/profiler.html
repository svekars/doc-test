
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>torch.profiler.profiler &#8212; PyTorch main documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=949a1ff5" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/katex-math.css?v=91adb8b6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/jit.css?v=8de1ea5d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=3ccf5357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom2.css?v=189c4a6a" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/documentation_options.js?v=53c08c8d"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=940804e7"></script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
    <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
    <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/torch/profiler/profiler';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="main (2.7.0a0+git74cfb4f )" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>

          <li class="main-menu-item">
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Learn
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class=dropdown-title>Get Started</span>
                  <p>Run PyTorch locally or get started quickly with one of the supported cloud platforms</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Tutorials</span>
                  <p>Whats new in PyTorch tutorials</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Learn the Basics</span>
                  <p>Familiarize yourself with PyTorch concepts and modules</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch Recipes</span>
                  <p>Bite-size, ready-to-deploy PyTorch code examples</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Intro to PyTorch - YouTube Series</span>
                  <p>Master PyTorch basics with our engaging YouTube tutorial series</p>
                </a>
              </div>
            </div>
          </li>

          <li>
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Ecosystem
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Tools</span>
                  <p>Learn about the tools and frameworks in the PyTorch Ecosystem</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class=dropdown-title>Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="" target="_blank">
                  <span class=dropdown-title>Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class=dropdown-title>Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Contributor Awards - 2024</span>
                  <p>Award winners announced at this year's PyTorch Conference</p>
                </a>
              </div>
            </div>
          </li>

          <li>
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Edge
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">About PyTorch Edge</span>
                  <p>Build innovative and privacy-aware AI experiences for edge devices</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">ExecuTorch</span>
                  <p>End-to-end solution for enabling on-device inference capabilities across mobile and edge devices</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">ExecuTorch Docs</span>
                </a>
              </div>
            </div>
          </li>

          <li class="main-menu-item">
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch</span>
                  <p>Explore the documentation for comprehensive guidance on how to use PyTorch</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch Domains</span>
                  <p>Read the PyTorch Domains documentation to learn more about domain-specific libraries</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Blogs & News
              lnhetrlnle</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch Blog</span>
                  <p>Catch up on the latest technical news and happenings</p>
                </a>
                 <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Community Blog</span>
                  <p>Stories from the PyTorch ecosystem</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Videos</span>
                  <p>Learn about the latest PyTorch tutorials, new, and more </p>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Community Stories</span>
                  <p>Learn how our community solves real, everyday machine learning problems with PyTorch</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Events</span>
                  <p>Find events, webinars, and podcasts</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Newsletter</span>
                  <p>Stay up-to-date with the latest updates</p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                About
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">PyTorch Foundation</span>
                  <p>Learn more about the PyTorch Foundation</p>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Governing Board</span>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Cloud Credit Program</span>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Technical Advisory Council</span>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Staff</span>
                </a>
                <a class="nav-dropdown-item" href="">
                  <span class="dropdown-title">Contact Us</span>
                </a>
              </div>
            </div>
          </li>

          <li class="main-menu-item">
            <div class="no-dropdown">
              <a href="" data-cta="join">
                Become a Member
              </a>
            </div>
          </li>
          <li>
           <div class="main-menu-item">
             <a href="" class="github-icon">
             </a>
           </div>
          </li>
          <!--- TODO: This block adds the search icon to the nav bar. We will enable it later.
          <li>
            <div class="main-menu-item">
             <a href="" class="search-icon">
             </a>
            </div>
          </li>
          --->
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>


  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
    <div class="navbar-header-items__start" style="display: flex; align-items: center; justify-content: flex-start;">
    <div class="navbar-item">
      <a class="nav-link nav-internal" href="/index.html">Home</a></div>
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/pytorch-logo-dark-unstable.png" class="logo__image only-light" alt="PyTorch main documentation - Home"/>
    <img src="../../../_static/pytorch-logo-dark-unstable.png" class="logo__image only-dark pst-js-only" alt="PyTorch main documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../python-api/index.html">
    Python API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../notes/index.html">
    Developer Notes
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../community/index.html">
    Community
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../lang-bindings/index.html">
    Language Bindings
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../python-api/index.html">
    Python API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../notes/index.html">
    Developer Notes
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../community/index.html">
    Community
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../lang-bindings/index.html">
    Language Bindings
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    
    <li class="breadcrumb-item"><a href="../../torch.html" class="nav-link">torch</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">torch.profiler.profiler</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for torch.profiler.profiler</h1><div class="highlight"><pre>
<span></span><span class="c1"># mypy: allow-untyped-defs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gzip</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Self</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">warnings</span><span class="w"> </span><span class="kn">import</span> <span class="n">warn</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.autograd.profiler</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">prof</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch._C</span><span class="w"> </span><span class="kn">import</span> <span class="n">_get_privateuse1_backend_name</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch._C._profiler</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">_add_execution_trace_observer</span><span class="p">,</span>
    <span class="n">_disable_execution_trace_observer</span><span class="p">,</span>
    <span class="n">_enable_execution_trace_observer</span><span class="p">,</span>
    <span class="n">_ExperimentalConfig</span><span class="p">,</span>
    <span class="n">_remove_execution_trace_observer</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch._environment</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_fbcode</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch.autograd</span><span class="w"> </span><span class="kn">import</span> <span class="n">kineto_available</span><span class="p">,</span> <span class="n">ProfilerActivity</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch.profiler._memory_profiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">MemoryProfile</span><span class="p">,</span> <span class="n">MemoryProfileTimeline</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;supported_activities&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ProfilerAction&quot;</span><span class="p">,</span>
    <span class="s2">&quot;schedule&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tensorboard_trace_handler&quot;</span><span class="p">,</span>
    <span class="s2">&quot;profile&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ExecutionTraceObserver&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">PROFILER_STEP_NAME</span> <span class="o">=</span> <span class="s2">&quot;ProfilerStep&quot;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_NumpyEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Json encoder for numpy types (np.int, np.float, np.array etc.)</span>
<span class="sd">    Returns default encoder if numpy is not available</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Encode NumPy types to JSON&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">supported_activities</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a set of supported profiler tracing activities.</span>

<span class="sd">    Note: profiler uses CUPTI library to trace on-device CUDA kernels.</span>
<span class="sd">    In case when CUDA is enabled but CUPTI is not available, passing</span>
<span class="sd">    ``ProfilerActivity.CUDA`` to profiler results in using the legacy CUDA</span>
<span class="sd">    profiling code (same as in the legacy ``torch.autograd.profiler``).</span>
<span class="sd">    This, in turn, results in including CUDA time in the profiler table output,</span>
<span class="sd">    but not in the JSON trace.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">_supported_activities</span><span class="p">()</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_ITraceObserver</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract interface for a Trace observer.</span>
<span class="sd">    This satisfies 3 methods: start, stop and cleanup&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>


<div class="viewcode-block" id="_KinetoProfile">
<a class="viewcode-back" href="../../../python-api/profiler.html#torch.profiler._KinetoProfile">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">_KinetoProfile</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Low-level profiler wrap the autograd profile</span>

<span class="sd">    Args:</span>
<span class="sd">        activities (iterable): list of activity groups (CPU, CUDA) to use in profiling, supported values:</span>
<span class="sd">            ``torch.profiler.ProfilerActivity.CPU``, ``torch.profiler.ProfilerActivity.CUDA``,</span>
<span class="sd">            ``torch.profiler.ProfilerActivity.XPU``.</span>
<span class="sd">            Default value: ProfilerActivity.CPU and (when available) ProfilerActivity.CUDA</span>
<span class="sd">            or (when available) ProfilerActivity.XPU.</span>
<span class="sd">        record_shapes (bool): save information about operator&#39;s input shapes.</span>
<span class="sd">        profile_memory (bool): track tensor memory allocation/deallocation (see ``export_memory_timeline``</span>
<span class="sd">            for more details).</span>
<span class="sd">        with_stack (bool): record source information (file and line number) for the ops.</span>
<span class="sd">        with_flops (bool): use formula to estimate the FLOPS of specific operators</span>
<span class="sd">            (matrix multiplication and 2D convolution).</span>
<span class="sd">        with_modules (bool): record module hierarchy (including function names)</span>
<span class="sd">            corresponding to the callstack of the op. e.g. If module A&#39;s forward call&#39;s</span>
<span class="sd">            module B&#39;s forward which contains an aten::add op,</span>
<span class="sd">            then aten::add&#39;s module hierarchy is A.B</span>
<span class="sd">            Note that this support exist, at the moment, only for TorchScript models</span>
<span class="sd">            and not eager mode models.</span>
<span class="sd">        experimental_config (_ExperimentalConfig) : A set of experimental options</span>
<span class="sd">            used by profiler libraries like Kineto. Note, backward compatibility is not guaranteed.</span>
<span class="sd">        execution_trace_observer (ExecutionTraceObserver) : A PyTorch Execution Trace Observer object.</span>
<span class="sd">            `PyTorch Execution Traces &lt;https://arxiv.org/pdf/2305.14516.pdf&gt;`__ offer a graph based</span>
<span class="sd">            representation of AI/ML workloads and enable replay benchmarks, simulators, and emulators.</span>
<span class="sd">            When this argument is included the observer start() and stop() will be called for the</span>
<span class="sd">            same time window as PyTorch profiler.</span>
<span class="sd">        acc_events (bool): Enable the accumulation of FunctionEvents across multiple profiling cycles</span>


<span class="sd">    .. note::</span>
<span class="sd">        This API is experimental and subject to change in the future.</span>

<span class="sd">        Enabling shape and stack tracing results in additional overhead.</span>
<span class="sd">        When record_shapes=True is specified, profiler will temporarily hold references to the tensors;</span>
<span class="sd">        that may further prevent certain optimizations that depend on the reference count and introduce</span>
<span class="sd">        extra tensor copies.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">activities</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="n">ProfilerActivity</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">record_shapes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">profile_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_stack</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_flops</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_modules</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">experimental_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ExperimentalConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">execution_trace_observer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ITraceObserver</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">acc_events</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">custom_trace_id_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activities</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">activities</span><span class="p">)</span> <span class="k">if</span> <span class="n">activities</span> <span class="k">else</span> <span class="n">supported_activities</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">record_shapes</span> <span class="o">=</span> <span class="n">record_shapes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">with_flops</span> <span class="o">=</span> <span class="n">with_flops</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_memory</span> <span class="o">=</span> <span class="n">profile_memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">with_stack</span> <span class="o">=</span> <span class="n">with_stack</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">with_modules</span> <span class="o">=</span> <span class="n">with_modules</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experimental_config</span> <span class="o">=</span> <span class="n">experimental_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execution_trace_observer</span> <span class="o">=</span> <span class="n">execution_trace_observer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acc_events</span> <span class="o">=</span> <span class="n">acc_events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_trace_id_callback</span> <span class="o">=</span> <span class="n">custom_trace_id_callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">prof</span><span class="o">.</span><span class="n">profile</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mem_tl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MemoryProfileTimeline</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_device</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">ProfilerActivity</span><span class="o">.</span><span class="n">CUDA</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">activities</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_device</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span>
        <span class="k">elif</span> <span class="n">ProfilerActivity</span><span class="o">.</span><span class="n">XPU</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">activities</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_device</span> <span class="o">=</span> <span class="s2">&quot;xpu&quot;</span>
        <span class="k">elif</span> <span class="n">ProfilerActivity</span><span class="o">.</span><span class="n">MTIA</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">activities</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_device</span> <span class="o">=</span> <span class="s2">&quot;mtia&quot;</span>
        <span class="k">elif</span> <span class="n">ProfilerActivity</span><span class="o">.</span><span class="n">PrivateUse1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">activities</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_device</span> <span class="o">=</span> <span class="n">_get_privateuse1_backend_name</span><span class="p">()</span>

        <span class="c1"># user-defined metadata to be amended to the trace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preset_metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_trace</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_trace</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_trace</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">prepare_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc_events</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span>
                <span class="n">use_cpu</span><span class="o">=</span><span class="p">(</span><span class="n">ProfilerActivity</span><span class="o">.</span><span class="n">CPU</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">activities</span><span class="p">),</span>
                <span class="n">use_device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_device</span><span class="p">,</span>
                <span class="n">record_shapes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">record_shapes</span><span class="p">,</span>
                <span class="n">with_flops</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">with_flops</span><span class="p">,</span>
                <span class="n">profile_memory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_memory</span><span class="p">,</span>
                <span class="n">with_stack</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">with_stack</span><span class="p">,</span>
                <span class="n">with_modules</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">with_modules</span><span class="p">,</span>
                <span class="n">use_kineto</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">experimental_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">experimental_config</span><span class="p">,</span>
                <span class="n">acc_events</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">acc_events</span><span class="p">,</span>
                <span class="n">custom_trace_id_callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_trace_id_callback</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">_prepare_trace</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_trace_observer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execution_trace_observer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">_start_trace</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_memory</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_metadata_json</span><span class="p">(</span><span class="s2">&quot;profile_memory&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_stack</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_metadata_json</span><span class="p">(</span><span class="s2">&quot;with_stack&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">record_shapes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_metadata_json</span><span class="p">(</span><span class="s2">&quot;record_shapes&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_modules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_metadata_json</span><span class="p">(</span><span class="s2">&quot;with_modules&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_flops</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_metadata_json</span><span class="p">(</span><span class="s2">&quot;with_flops&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kineto_available</span><span class="p">():</span>
            <span class="n">dist_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_distributed_info</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dist_info</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_metadata_json</span><span class="p">(</span>
                    <span class="s2">&quot;distributedInfo&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dist_info</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">_NumpyEncoder</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">torch</span><span class="p">,</span> <span class="s2">&quot;_inductor&quot;</span><span class="p">):</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">torch._inductor.config</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">inductor_config</span>

                <span class="k">if</span> <span class="n">inductor_config</span><span class="o">.</span><span class="n">triton</span><span class="o">.</span><span class="n">cudagraphs</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DISABLE_CUPTI_LAZY_REINIT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_metadata_json</span><span class="p">(</span><span class="s2">&quot;DISABLE_CUPTI_LAZY_REINIT&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
                    <span class="c1"># FIXME: CUDA Graph does not work well with CUPTI teardown.</span>
                    <span class="c1">#   1) crashes on 1st lazy CUPTI re-init after teardown (CUDA 11)</span>
                    <span class="c1">#   2) crashes on 2nd non-lazy CUPTI re-init after teardown (CUDA 12)</span>
                    <span class="c1"># Workaround: turn off CUPTI teardown when using CUDA Graphs.</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;TEARDOWN_CUPTI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>

            <span class="c1"># Insert the preset user metadata to the trace</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">preset_metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_metadata_json</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stop_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_trace_observer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execution_trace_observer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<div class="viewcode-block" id="_KinetoProfile.export_chrome_trace">
<a class="viewcode-back" href="../../../python-api/profiler.html#torch.profiler._KinetoProfile.export_chrome_trace">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">export_chrome_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exports the collected trace in Chrome JSON format. If kineto is enabled, only</span>
<span class="sd">        last cycle in schedule is exported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">):</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="s2">&quot;w+b&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.json&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">retvalue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">export_chrome_trace</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
                    <span class="n">fout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">fin</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">retvalue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">export_chrome_trace</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>


<div class="viewcode-block" id="_KinetoProfile.export_stacks">
<a class="viewcode-back" href="../../../python-api/profiler.html#torch.profiler._KinetoProfile.export_stacks">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">export_stacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;self_cpu_time_total&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save stack traces to a file</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): save stacks file to this location;</span>
<span class="sd">            metric (str): metric to use: &quot;self_cpu_time_total&quot; or &quot;self_cuda_time_total&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">export_stacks</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span></div>


<div class="viewcode-block" id="_KinetoProfile.toggle_collection_dynamic">
<a class="viewcode-back" href="../../../python-api/profiler.html#torch.profiler._KinetoProfile.toggle_collection_dynamic">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">toggle_collection_dynamic</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">activities</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">ProfilerActivity</span><span class="p">]</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Toggle collection of activities on/off at any point of collection. Currently supports toggling Torch Ops</span>
<span class="sd">        (CPU) and CUDA activity supported in Kineto</span>

<span class="sd">        Args:</span>
<span class="sd">            activities (iterable): list of activity groups to use in profiling, supported values:</span>
<span class="sd">                ``torch.profiler.ProfilerActivity.CPU``, ``torch.profiler.ProfilerActivity.CUDA``</span>
<span class="sd">        Examples:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            with torch.profiler.profile(</span>
<span class="sd">                activities=[</span>
<span class="sd">                    torch.profiler.ProfilerActivity.CPU,</span>
<span class="sd">                    torch.profiler.ProfilerActivity.CUDA,</span>
<span class="sd">                ]</span>
<span class="sd">            ) as p:</span>
<span class="sd">                code_to_profile_0()</span>
<span class="sd">                // turn off collection of all CUDA activity</span>
<span class="sd">                p.toggle_collection_dynamic(False, [torch.profiler.ProfilerActivity.CUDA])</span>
<span class="sd">                code_to_profile_1()</span>
<span class="sd">                // turn on collection of all CUDA activity</span>
<span class="sd">                p.toggle_collection_dynamic(True, [torch.profiler.ProfilerActivity.CUDA])</span>
<span class="sd">                code_to_profile_2()</span>
<span class="sd">            print(p.key_averages().table(</span>
<span class="sd">                sort_by=&quot;self_cuda_time_total&quot;, row_limit=-1))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">toggle_collection_dynamic</span><span class="p">(</span><span class="n">enable</span><span class="p">,</span> <span class="n">activities</span><span class="p">)</span></div>


<div class="viewcode-block" id="_KinetoProfile.key_averages">
<a class="viewcode-back" href="../../../python-api/profiler.html#torch.profiler._KinetoProfile.key_averages">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">key_averages</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">group_by_input_shape</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">group_by_stack_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Averages events, grouping them by operator name and (optionally) input shapes and</span>
<span class="sd">        stack.</span>

<span class="sd">        .. note::</span>
<span class="sd">            To use shape/stack functionality make sure to set record_shapes/with_stack</span>
<span class="sd">            when creating profiler context manager.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">key_averages</span><span class="p">(</span><span class="n">group_by_input_shape</span><span class="p">,</span> <span class="n">group_by_stack_n</span><span class="p">)</span></div>


<div class="viewcode-block" id="_KinetoProfile.events">
<a class="viewcode-back" href="../../../python-api/profiler.html#torch.profiler._KinetoProfile.events">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the list of unaggregated profiler events,</span>
<span class="sd">        to be used in the trace callback or after the profiling is finished</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">function_events</span></div>


<div class="viewcode-block" id="_KinetoProfile.add_metadata">
<a class="viewcode-back" href="../../../python-api/profiler.html#torch.profiler._KinetoProfile.add_metadata">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a user defined metadata with a string key and a string value</span>
<span class="sd">        into the trace file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wrapped_value</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&quot;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">_add_metadata_json</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">wrapped_value</span><span class="p">)</span></div>


<div class="viewcode-block" id="_KinetoProfile.add_metadata_json">
<a class="viewcode-back" href="../../../python-api/profiler.html#torch.profiler._KinetoProfile.add_metadata_json">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_metadata_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a user defined metadata with a string key and a valid json value</span>
<span class="sd">        into the trace file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">_add_metadata_json</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="_KinetoProfile.preset_metadata_json">
<a class="viewcode-back" href="../../../python-api/profiler.html#torch.profiler._KinetoProfile.preset_metadata_json">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">preset_metadata_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Preset a user defined metadata when the profiler is not started</span>
<span class="sd">        and added into the trace file later.</span>
<span class="sd">        Metadata is in the format of a string key and a valid json value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preset_metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_get_distributed_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">torch.distributed</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dist</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">dist</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">dist</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">backend</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">get_backend</span><span class="p">()</span>
        <span class="n">dist_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;backend&quot;</span><span class="p">:</span> <span class="n">backend</span><span class="p">,</span>
            <span class="s2">&quot;rank&quot;</span><span class="p">:</span> <span class="n">dist</span><span class="o">.</span><span class="n">get_rank</span><span class="p">(),</span>
            <span class="s2">&quot;world_size&quot;</span><span class="p">:</span> <span class="n">dist</span><span class="o">.</span><span class="n">get_world_size</span><span class="p">(),</span>
            <span class="s2">&quot;pg_count&quot;</span><span class="p">:</span> <span class="n">dist</span><span class="o">.</span><span class="n">get_pg_count</span><span class="p">(),</span>
            <span class="s2">&quot;pg_config&quot;</span><span class="p">:</span> <span class="n">dist</span><span class="o">.</span><span class="n">distributed_c10d</span><span class="o">.</span><span class="n">_get_all_pg_configs</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;nccl&quot;</span><span class="p">:</span>
            <span class="n">nccl_version</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">nccl</span><span class="o">.</span><span class="n">version</span><span class="p">()</span>
            <span class="n">dist_info</span><span class="p">[</span><span class="s2">&quot;nccl_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">nccl_version</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dist_info</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_memory_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MemoryProfile</span><span class="p">:</span>
        <span class="n">required</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;record_shapes&quot;</span><span class="p">,</span> <span class="s2">&quot;profile_memory&quot;</span><span class="p">,</span> <span class="s2">&quot;with_stack&quot;</span><span class="p">)</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">=True&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">required</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2"> required for memory profiling.&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">kineto_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">MemoryProfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">kineto_results</span><span class="p">)</span>

<div class="viewcode-block" id="_KinetoProfile.export_memory_timeline">
<a class="viewcode-back" href="../../../python-api/profiler.html#torch.profiler._KinetoProfile.export_memory_timeline">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">export_memory_timeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export memory event information from the profiler collected</span>
<span class="sd">        tree for a given device, and export a timeline plot. There are 3</span>
<span class="sd">        exportable files using ``export_memory_timeline``, each controlled by the</span>
<span class="sd">        ``path``&#39;s suffix.</span>

<span class="sd">        - For an HTML compatible plot, use the suffix ``.html``, and a memory timeline</span>
<span class="sd">          plot will be embedded as a PNG file in the HTML file.</span>

<span class="sd">        - For plot points consisting of ``[times, [sizes by category]]``, where</span>
<span class="sd">          ``times`` are timestamps and ``sizes`` are memory usage for each category.</span>
<span class="sd">          The memory timeline plot will be saved a JSON (``.json``) or gzipped JSON</span>
<span class="sd">          (``.json.gz``) depending on the suffix.</span>

<span class="sd">        - For raw memory points, use the suffix ``.raw.json.gz``. Each raw memory</span>
<span class="sd">          event will consist of ``(timestamp, action, numbytes, category)``, where</span>
<span class="sd">          ``action`` is one of ``[PREEXISTING, CREATE, INCREMENT_VERSION, DESTROY]``,</span>
<span class="sd">          and ``category`` is one of the enums from</span>
<span class="sd">          ``torch.profiler._memory_profiler.Category``.</span>

<span class="sd">        Output: Memory timeline written as gzipped JSON, JSON, or HTML.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Default to device 0, if unset. Fallback on cpu.</span>
        <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_device</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_device</span> <span class="o">!=</span> <span class="s2">&quot;cuda&quot;</span><span class="p">:</span>
                <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_device</span> <span class="o">+</span> <span class="s2">&quot;:0&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;cuda:0&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>

        <span class="c1"># Construct the memory timeline plot data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mem_tl</span> <span class="o">=</span> <span class="n">MemoryProfileTimeline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory_profile</span><span class="p">())</span>

        <span class="c1"># Depending on the file suffix, save the data as json.gz or json.</span>
        <span class="c1"># For html, we can embed the image into an HTML file.</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.html&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mem_tl</span><span class="o">.</span><span class="n">export_memory_timeline_html</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">):</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="s2">&quot;w+t&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.json&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;raw.json.gz&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mem_tl</span><span class="o">.</span><span class="n">export_memory_timeline_raw</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mem_tl</span><span class="o">.</span><span class="n">export_memory_timeline</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
                    <span class="n">fout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">fin</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mem_tl</span><span class="o">.</span><span class="n">export_memory_timeline</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ProfilerAction">
<a class="viewcode-back" href="../../../python-api/profiler.html#torch.profiler.ProfilerAction">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ProfilerAction</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Profiler actions that can be taken at the specified intervals</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">NONE</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">WARMUP</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">RECORD</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">RECORD_AND_SAVE</span> <span class="o">=</span> <span class="mi">3</span></div>



<div class="viewcode-block" id="schedule">
<a class="viewcode-back" href="../../../python-api/profiler.html#torch.profiler.schedule">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">schedule</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">wait</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">warmup</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">active</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">repeat</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">skip_first</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">skip_first_wait</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a callable that can be used as profiler ``schedule`` argument. The profiler will skip</span>
<span class="sd">    the first ``skip_first`` steps, then wait for ``wait`` steps, then do the warmup for the next ``warmup`` steps,</span>
<span class="sd">    then do the active recording for the next ``active`` steps and then repeat the cycle starting with ``wait`` steps.</span>
<span class="sd">    The optional number of cycles is specified with the ``repeat`` parameter, the zero value means that</span>
<span class="sd">    the cycles will continue until the profiling is finished.</span>

<span class="sd">    The ``skip_first_wait`` parameter controls whether the first ``wait`` stage should be skipped.</span>
<span class="sd">    This can be useful if a user wants to wait longer than ``skip_first`` between cycles, but not</span>
<span class="sd">    for the first profile. For example, if ``skip_first`` is 10 and ``wait`` is 20, the first cycle will</span>
<span class="sd">    wait 10 + 20 = 30 steps before warmup if ``skip_first_wait`` is zero, but will wait only 10</span>
<span class="sd">    steps if ``skip_first_wait`` is non-zero. All subsequent cycles will then wait 20 steps between the</span>
<span class="sd">    last active and warmup.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">schedule_fn</span><span class="p">(</span><span class="n">step</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProfilerAction</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">step</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="n">skip_first</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">NONE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">-=</span> <span class="n">skip_first</span>
        <span class="c1"># If wait &gt;&gt; skip_first and we want to grab profiling early, shift left by wait if skip_first_wait is True</span>
        <span class="k">if</span> <span class="n">skip_first_wait</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">+=</span> <span class="n">wait</span>
        <span class="n">num_steps</span> <span class="o">=</span> <span class="n">wait</span> <span class="o">+</span> <span class="n">warmup</span> <span class="o">+</span> <span class="n">active</span>
        <span class="k">if</span> <span class="n">repeat</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">step</span> <span class="o">/</span> <span class="n">num_steps</span> <span class="o">&gt;=</span> <span class="n">repeat</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">NONE</span>
        <span class="n">mod_step</span> <span class="o">=</span> <span class="n">step</span> <span class="o">%</span> <span class="n">num_steps</span>
        <span class="k">if</span> <span class="n">mod_step</span> <span class="o">&lt;</span> <span class="n">wait</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">NONE</span>
        <span class="k">elif</span> <span class="n">mod_step</span> <span class="o">&lt;</span> <span class="n">wait</span> <span class="o">+</span> <span class="n">warmup</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">WARMUP</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD</span>
                <span class="k">if</span> <span class="n">mod_step</span> <span class="o">&lt;</span> <span class="n">num_steps</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">else</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD_AND_SAVE</span>
            <span class="p">)</span>

    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">wait</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">warmup</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">active</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">repeat</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">skip_first</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="p">),</span> <span class="s2">&quot;Invalid profiler schedule arguments&quot;</span>
    <span class="k">if</span> <span class="n">warmup</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Profiler won&#39;t be using warmup, this can skew profiler results&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">schedule_fn</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_default_schedule_fn</span><span class="p">(</span><span class="n">_</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProfilerAction</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Default profiler behavior - immediately starts recording the events,</span>
<span class="sd">    keeps doing it on every profiler step.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD</span>


<div class="viewcode-block" id="tensorboard_trace_handler">
<a class="viewcode-back" href="../../../python-api/profiler.html#torch.profiler.tensorboard_trace_handler">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">tensorboard_trace_handler</span><span class="p">(</span>
    <span class="n">dir_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">worker_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">use_gzip</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Outputs tracing files to directory of ``dir_name``, then that directory can be</span>
<span class="sd">    directly delivered to tensorboard as logdir.</span>
<span class="sd">    ``worker_name`` should be unique for each worker in distributed scenario,</span>
<span class="sd">    it will be set to &#39;[hostname]_[pid]&#39; by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handler_fn</span><span class="p">(</span><span class="n">prof</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">nonlocal</span> <span class="n">worker_name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dir_name</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t create directory: &quot;</span> <span class="o">+</span> <span class="n">dir_name</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">worker_name</span><span class="p">:</span>
            <span class="n">worker_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># Use nanosecond here to avoid naming clash when exporting the trace</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">worker_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span><span class="si">}</span><span class="s2">.pt.trace.json&quot;</span>
        <span class="k">if</span> <span class="n">use_gzip</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot;.gz&quot;</span>
        <span class="n">prof</span><span class="o">.</span><span class="n">export_chrome_trace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">file_name</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">handler_fn</span></div>



<div class="viewcode-block" id="profile">
<a class="viewcode-back" href="../../../python-api/profiler.html#torch.profiler.profile">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">profile</span><span class="p">(</span><span class="n">_KinetoProfile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Profiler context manager.</span>

<span class="sd">    Args:</span>
<span class="sd">        activities (iterable): list of activity groups (CPU, CUDA) to use in profiling, supported values:</span>
<span class="sd">            ``torch.profiler.ProfilerActivity.CPU``, ``torch.profiler.ProfilerActivity.CUDA``,</span>
<span class="sd">            ``torch.profiler.ProfilerActivity.XPU``.</span>
<span class="sd">            Default value: ProfilerActivity.CPU and (when available) ProfilerActivity.CUDA</span>
<span class="sd">            or (when available) ProfilerActivity.XPU.</span>
<span class="sd">        schedule (Callable): callable that takes step (int) as a single parameter and returns</span>
<span class="sd">            ``ProfilerAction`` value that specifies the profiler action to perform at each step.</span>
<span class="sd">        on_trace_ready (Callable): callable that is called at each step when ``schedule``</span>
<span class="sd">            returns ``ProfilerAction.RECORD_AND_SAVE`` during the profiling.</span>
<span class="sd">        record_shapes (bool): save information about operator&#39;s input shapes.</span>
<span class="sd">        profile_memory (bool): track tensor memory allocation/deallocation.</span>
<span class="sd">        with_stack (bool): record source information (file and line number) for the ops.</span>
<span class="sd">        with_flops (bool): use formula to estimate the FLOPs (floating point operations) of specific operators</span>
<span class="sd">            (matrix multiplication and 2D convolution).</span>
<span class="sd">        with_modules (bool): record module hierarchy (including function names)</span>
<span class="sd">            corresponding to the callstack of the op. e.g. If module A&#39;s forward call&#39;s</span>
<span class="sd">            module B&#39;s forward which contains an aten::add op,</span>
<span class="sd">            then aten::add&#39;s module hierarchy is A.B</span>
<span class="sd">            Note that this support exist, at the moment, only for TorchScript models</span>
<span class="sd">            and not eager mode models.</span>
<span class="sd">        experimental_config (_ExperimentalConfig) : A set of experimental options</span>
<span class="sd">            used for Kineto library features. Note, backward compatibility is not guaranteed.</span>
<span class="sd">        execution_trace_observer (ExecutionTraceObserver) : A PyTorch Execution Trace Observer object.</span>
<span class="sd">            `PyTorch Execution Traces &lt;https://arxiv.org/pdf/2305.14516.pdf&gt;`__ offer a graph based</span>
<span class="sd">            representation of AI/ML workloads and enable replay benchmarks, simulators, and emulators.</span>
<span class="sd">            When this argument is included the observer start() and stop() will be called for the</span>
<span class="sd">            same time window as PyTorch profiler. See the examples section below for a code sample.</span>
<span class="sd">        acc_events (bool): Enable the accumulation of FunctionEvents across multiple profiling cycles</span>
<span class="sd">        use_cuda (bool):</span>
<span class="sd">            .. deprecated:: 1.8.1</span>
<span class="sd">                use ``activities`` instead.</span>

<span class="sd">    .. note::</span>
<span class="sd">        Use :func:`~torch.profiler.schedule` to generate the callable schedule.</span>
<span class="sd">        Non-default schedules are useful when profiling long training jobs</span>
<span class="sd">        and allow the user to obtain multiple traces at the different iterations</span>
<span class="sd">        of the training process.</span>
<span class="sd">        The default schedule simply records all the events continuously for the</span>
<span class="sd">        duration of the context manager.</span>

<span class="sd">    .. note::</span>
<span class="sd">        Use :func:`~torch.profiler.tensorboard_trace_handler` to generate result files for TensorBoard:</span>

<span class="sd">        ``on_trace_ready=torch.profiler.tensorboard_trace_handler(dir_name)``</span>

<span class="sd">        After profiling, result files can be found in the specified directory. Use the command:</span>

<span class="sd">        ``tensorboard --logdir dir_name``</span>

<span class="sd">        to see the results in TensorBoard.</span>
<span class="sd">        For more information, see</span>
<span class="sd">        `PyTorch Profiler TensorBoard Plugin &lt;https://github.com/pytorch/kineto/tree/master/tb_plugin&gt;`__</span>

<span class="sd">    .. note::</span>
<span class="sd">        Enabling shape and stack tracing results in additional overhead.</span>
<span class="sd">        When record_shapes=True is specified, profiler will temporarily hold references to the tensors;</span>
<span class="sd">        that may further prevent certain optimizations that depend on the reference count and introduce</span>
<span class="sd">        extra tensor copies.</span>


<span class="sd">    Examples:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        with torch.profiler.profile(</span>
<span class="sd">            activities=[</span>
<span class="sd">                torch.profiler.ProfilerActivity.CPU,</span>
<span class="sd">                torch.profiler.ProfilerActivity.CUDA,</span>
<span class="sd">            ]</span>
<span class="sd">        ) as p:</span>
<span class="sd">            code_to_profile()</span>
<span class="sd">        print(p.key_averages().table(</span>
<span class="sd">            sort_by=&quot;self_cuda_time_total&quot;, row_limit=-1))</span>

<span class="sd">    Using the profiler&#39;s ``schedule``, ``on_trace_ready`` and ``step`` functions:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        # Non-default profiler schedule allows user to turn profiler on and off</span>
<span class="sd">        # on different iterations of the training loop;</span>
<span class="sd">        # trace_handler is called every time a new trace becomes available</span>
<span class="sd">        def trace_handler(prof):</span>
<span class="sd">            print(prof.key_averages().table(</span>
<span class="sd">                sort_by=&quot;self_cuda_time_total&quot;, row_limit=-1))</span>
<span class="sd">            # prof.export_chrome_trace(&quot;/tmp/test_trace_&quot; + str(prof.step_num) + &quot;.json&quot;)</span>

<span class="sd">        with torch.profiler.profile(</span>
<span class="sd">            activities=[</span>
<span class="sd">                torch.profiler.ProfilerActivity.CPU,</span>
<span class="sd">                torch.profiler.ProfilerActivity.CUDA,</span>
<span class="sd">            ],</span>

<span class="sd">            # In this example with wait=1, warmup=1, active=2, repeat=1,</span>
<span class="sd">            # profiler will skip the first step/iteration,</span>
<span class="sd">            # start warming up on the second, record</span>
<span class="sd">            # the third and the forth iterations,</span>
<span class="sd">            # after which the trace will become available</span>
<span class="sd">            # and on_trace_ready (when set) is called;</span>
<span class="sd">            # the cycle repeats starting with the next step</span>

<span class="sd">            schedule=torch.profiler.schedule(</span>
<span class="sd">                wait=1,</span>
<span class="sd">                warmup=1,</span>
<span class="sd">                active=2,</span>
<span class="sd">                repeat=1),</span>
<span class="sd">            on_trace_ready=trace_handler</span>
<span class="sd">            # on_trace_ready=torch.profiler.tensorboard_trace_handler(&#39;./log&#39;)</span>
<span class="sd">            # used when outputting for tensorboard</span>
<span class="sd">            ) as p:</span>
<span class="sd">                for iter in range(N):</span>
<span class="sd">                    code_iteration_to_profile(iter)</span>
<span class="sd">                    # send a signal to the profiler that the next iteration has started</span>
<span class="sd">                    p.step()</span>

<span class="sd">    The following sample shows how to setup up an Execution Trace Observer (`execution_trace_observer`)</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        with torch.profiler.profile(</span>
<span class="sd">            ...</span>
<span class="sd">            execution_trace_observer=(</span>
<span class="sd">                ExecutionTraceObserver().register_callback(&quot;./execution_trace.json&quot;)</span>
<span class="sd">            ),</span>
<span class="sd">        ) as p:</span>
<span class="sd">            for iter in range(N):</span>
<span class="sd">                code_iteration_to_profile(iter)</span>
<span class="sd">                p.step()</span>

<span class="sd">    You can also refer to test_execution_trace_with_kineto() in tests/profiler/test_profiler.py.</span>
<span class="sd">    Note: One can also pass any object satisfying the _ITraceObserver interface.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">activities</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="n">ProfilerActivity</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">schedule</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">],</span> <span class="n">ProfilerAction</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">on_trace_ready</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">record_shapes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">profile_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_stack</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_flops</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_modules</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">experimental_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ExperimentalConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">execution_trace_observer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ITraceObserver</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">acc_events</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="c1"># deprecated:</span>
        <span class="n">use_cuda</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">custom_trace_id_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">activities_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">activities</span><span class="p">)</span> <span class="k">if</span> <span class="n">activities</span> <span class="k">else</span> <span class="n">supported_activities</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">use_cuda</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;`use_cuda` is deprecated, use `activities` argument instead&quot;</span><span class="p">,</span>
                <span class="ne">FutureWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">use_cuda</span><span class="p">:</span>
                <span class="n">activities_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ProfilerActivity</span><span class="o">.</span><span class="n">CUDA</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ProfilerActivity</span><span class="o">.</span><span class="n">CUDA</span> <span class="ow">in</span> <span class="n">activities_set</span><span class="p">:</span>
                <span class="n">activities_set</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ProfilerActivity</span><span class="o">.</span><span class="n">CUDA</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">activities_set</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;No valid profiler activities found&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">activities</span><span class="o">=</span><span class="n">activities</span><span class="p">,</span>
            <span class="n">record_shapes</span><span class="o">=</span><span class="n">record_shapes</span><span class="p">,</span>
            <span class="n">profile_memory</span><span class="o">=</span><span class="n">profile_memory</span><span class="p">,</span>
            <span class="n">with_stack</span><span class="o">=</span><span class="n">with_stack</span><span class="p">,</span>
            <span class="n">with_flops</span><span class="o">=</span><span class="n">with_flops</span><span class="p">,</span>
            <span class="n">with_modules</span><span class="o">=</span><span class="n">with_modules</span><span class="p">,</span>
            <span class="n">experimental_config</span><span class="o">=</span><span class="n">experimental_config</span><span class="p">,</span>
            <span class="n">execution_trace_observer</span><span class="o">=</span><span class="n">execution_trace_observer</span>
            <span class="k">if</span> <span class="n">execution_trace_observer</span>
            <span class="k">else</span> <span class="n">ExecutionTraceObserver</span><span class="o">.</span><span class="n">build_execution_trace_obs_from_env</span><span class="p">(),</span>
            <span class="n">acc_events</span><span class="o">=</span><span class="n">acc_events</span><span class="p">,</span>
            <span class="n">custom_trace_id_callback</span><span class="o">=</span><span class="n">custom_trace_id_callback</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">schedule</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">schedule</span>
            <span class="c1"># add step markers into the trace and table view</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">record_steps</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">_default_schedule_fn</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">record_steps</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_trace_ready</span> <span class="o">=</span> <span class="n">on_trace_ready</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step_rec_fn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">prof</span><span class="o">.</span><span class="n">record_function</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">action_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span>
            <span class="nb">tuple</span><span class="p">[</span><span class="n">ProfilerAction</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProfilerAction</span><span class="p">]],</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># key is (prev_action, current_action), value is action list corresponding to the state pair.</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">NONE</span><span class="p">):</span> <span class="p">[],</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">WARMUP</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prepare_trace</span><span class="p">],</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD</span><span class="p">):</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prepare_trace</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_trace</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD_AND_SAVE</span><span class="p">):</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prepare_trace</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_trace</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">WARMUP</span><span class="p">,</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">NONE</span><span class="p">):</span> <span class="p">[</span>
                <span class="n">partial</span><span class="p">(</span><span class="n">warn</span><span class="p">,</span> <span class="s2">&quot;Incorrect schedule: WARMUP followed by NONE&quot;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_trace</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop_trace</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">WARMUP</span><span class="p">,</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">WARMUP</span><span class="p">):</span> <span class="p">[],</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">WARMUP</span><span class="p">,</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_trace</span><span class="p">],</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">WARMUP</span><span class="p">,</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD_AND_SAVE</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_trace</span><span class="p">],</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD</span><span class="p">,</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">NONE</span><span class="p">):</span> <span class="p">[</span>
                <span class="n">partial</span><span class="p">(</span><span class="n">warn</span><span class="p">,</span> <span class="s2">&quot;Incorrect schedule: RECORD followed by NONE&quot;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop_trace</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD</span><span class="p">,</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">WARMUP</span><span class="p">):</span> <span class="p">[</span>
                <span class="n">partial</span><span class="p">(</span><span class="n">warn</span><span class="p">,</span> <span class="s2">&quot;Incorrect schedule: RECORD followed by WARMUP&quot;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop_trace</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD</span><span class="p">,</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD</span><span class="p">):</span> <span class="p">[],</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD</span><span class="p">,</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD_AND_SAVE</span><span class="p">):</span> <span class="p">[],</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD_AND_SAVE</span><span class="p">,</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">NONE</span><span class="p">):</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop_trace</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_trace_ready</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD_AND_SAVE</span><span class="p">,</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">WARMUP</span><span class="p">):</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop_trace</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_trace_ready</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prepare_trace</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD_AND_SAVE</span><span class="p">,</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD</span><span class="p">):</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop_trace</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_trace_ready</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prepare_trace</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_trace</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD_AND_SAVE</span><span class="p">,</span> <span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD_AND_SAVE</span><span class="p">):</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop_trace</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_trace_ready</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prepare_trace</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_trace</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="c1"># used for exit action</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">WARMUP</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_trace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_trace</span><span class="p">],</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stop_trace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace_ready</span><span class="p">],</span>
            <span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">RECORD_AND_SAVE</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop_trace</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_trace_ready</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">}</span>
        <span class="c1"># Start tracking increments to profiler step, this will be used</span>
        <span class="c1"># by Kineto</span>
        <span class="n">prof</span><span class="o">.</span><span class="n">KinetoStepTracker</span><span class="o">.</span><span class="n">init_step_count</span><span class="p">(</span><span class="n">PROFILER_STEP_NAME</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="n">prof</span><span class="o">.</span><span class="n">KinetoStepTracker</span><span class="o">.</span><span class="n">erase_step_count</span><span class="p">(</span><span class="n">PROFILER_STEP_NAME</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_trace_observer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execution_trace_observer</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transit_action</span><span class="p">(</span><span class="n">ProfilerAction</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_action</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">record_steps</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_rec_fn</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">record_function</span><span class="p">(</span>
                <span class="s2">&quot;ProfilerStep#&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step_num</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_rec_fn</span><span class="o">.</span><span class="fm">__enter__</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">record_steps</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_rec_fn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_rec_fn</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transit_action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_action</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<div class="viewcode-block" id="profile.step">
<a class="viewcode-back" href="../../../python-api/profiler.html#torch.profiler.profile.step">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Signals the profiler that the next profiling step has started.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">record_steps</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_rec_fn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_rec_fn</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">prev_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step_num</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_transit_action</span><span class="p">(</span><span class="n">prev_action</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_action</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;KINETO_USE_DAEMON&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">is_fbcode</span><span class="p">()</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;KINETO_FORCE_STEP_HOOK&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">prof</span><span class="o">.</span><span class="n">KinetoStepTracker</span><span class="o">.</span><span class="n">increment_step</span><span class="p">(</span><span class="n">PROFILER_STEP_NAME</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">record_steps</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_rec_fn</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">record_function</span><span class="p">(</span>
                <span class="s2">&quot;ProfilerStep#&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step_num</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_rec_fn</span><span class="o">.</span><span class="fm">__enter__</span><span class="p">()</span></div>


<div class="viewcode-block" id="profile.set_custom_trace_id_callback">
<a class="viewcode-back" href="../../../python-api/profiler.html#torch.profiler.profile.set_custom_trace_id_callback">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_custom_trace_id_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets a callback to be called when a new trace ID is generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_trace_id_callback</span> <span class="o">=</span> <span class="n">callback</span></div>


<div class="viewcode-block" id="profile.get_trace_id">
<a class="viewcode-back" href="../../../python-api/profiler.html#torch.profiler.profile.get_trace_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_trace_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current trace ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">trace_id</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_trace_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_trace_ready</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_trace_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_transit_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prev_action</span><span class="p">,</span> <span class="n">current_action</span><span class="p">):</span>
        <span class="n">action_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_map</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">prev_action</span><span class="p">,</span> <span class="n">current_action</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">action_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">action_list</span><span class="p">:</span>
                <span class="n">action</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">prof</span><span class="o">.</span><span class="n">_ProfilerStats</span><span class="p">]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">_stats</span></div>



<span class="k">class</span><span class="w"> </span><span class="nc">ExecutionTraceObserver</span><span class="p">(</span><span class="n">_ITraceObserver</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execution Trace Observer</span>

<span class="sd">    Each process can have a single ExecutionTraceObserver instance. The observer</span>
<span class="sd">    can be added to record function callbacks via calling register_callback()</span>
<span class="sd">    explicitly. Without calling unregister_callback(), repeated calls to</span>
<span class="sd">    register_callback() will not add additional observers to record function</span>
<span class="sd">    callbacks. Once an ExecutionTraceObserver is created, the start() and stop()</span>
<span class="sd">    methods control when the event data is recorded.</span>

<span class="sd">    Deleting or calling unregister_callback() will remove the observer from the</span>
<span class="sd">    record function callbacks, finalize the output file, and will stop</span>
<span class="sd">    incurring any overheads.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the default states.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_registered</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execution_trace_running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extra_resources_collection</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resources_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls unregister_callback() to make sure to finalize outputs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unregister_callback</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">build_execution_trace_obs_from_env</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;ExecutionTraceObserver&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an ExecutionTraceObserver instance if the environment variable</span>
<span class="sd">        ENABLE_PYTORCH_EXECUTION_TRACE is set to 1, otherwise returns None.</span>

<span class="sd">        Configures the observer to also collect extra resources if the environment variable</span>
<span class="sd">        ``ENABLE_PYTORCH_EXECUTION_TRACE_EXTRAS=1``. These are resources such as generated kernels,</span>
<span class="sd">        index tensor data etc. that are required to make the Execution Trace replayable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ENABLE_PYTORCH_EXECUTION_TRACE&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="s2">&quot;w+t&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.et.json&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Execution trace will not be recorded. Exception on creating default temporary file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">et</span> <span class="o">=</span> <span class="n">ExecutionTraceObserver</span><span class="p">()</span>
            <span class="n">et</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="c1"># additionally, check if the env requires us to collect extra resources</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ENABLE_PYTORCH_EXECUTION_TRACE_EXTRAS&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
                <span class="n">et</span><span class="o">.</span><span class="n">set_extra_resource_collection</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">et</span><span class="o">.</span><span class="n">set_extra_resource_collection</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">et</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_extra_resource_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collects extra resources such as generated kernels, index tensor data, and any other</span>
<span class="sd">        metadata that is required to complete the Execution Trace content.</span>

<span class="sd">        The caller should call this method with val=True after calling register_callback() if they want</span>
<span class="sd">        to collect the extra resources.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extra_resources_collection</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">extra_resources_collection</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_resources_dir</span><span class="p">(</span><span class="n">can_create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">register_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds ET observer to record function callbacks. The data will be</span>
<span class="sd">        written to output_file_path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registered</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_file_path</span> <span class="o">=</span> <span class="n">output_file_path</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_registered</span> <span class="o">=</span> <span class="n">_add_execution_trace_observer</span><span class="p">(</span><span class="n">output_file_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_resources_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">can_create</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the resources directory for the generated kernels,</span>
<span class="sd">        or index tensor data or any other metadata that is required</span>
<span class="sd">        to complete the Execution Trace content.</span>

<span class="sd">        The directory is created right where the ET file is being output.</span>

<span class="sd">        Only works if the observer has called set_extra_resource_collection(val=True).</span>

<span class="sd">        Returns None if the observer is not configured with extra resource collection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">extra_resources_collection</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources_dir</span><span class="p">:</span>
            <span class="c1"># already created</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources_dir</span>
        <span class="n">generated_path</span> <span class="o">=</span> <span class="n">ExecutionTraceObserver</span><span class="o">.</span><span class="n">get_resources_dir_for_et_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_file_path</span><span class="p">,</span> <span class="n">create_dir</span><span class="o">=</span><span class="n">can_create</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">generated_path</span><span class="p">:</span>
            <span class="c1"># could not find of create the resources dir</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resources_dir</span> <span class="o">=</span> <span class="n">generated_path</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources_dir</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_resources_dir_for_et_path</span><span class="p">(</span>
        <span class="n">trace_path</span><span class="p">,</span> <span class="n">create_dir</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">work_dir</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">trace_path</span><span class="p">)</span>
        <span class="n">resource_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">work_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_resources&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">resource_dir</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">create_dir</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">resource_dir</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Execution trace exception when creating </span><span class="si">{</span><span class="n">resource_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">resource_dir</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">unregister_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes ET observer from record function callbacks.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_save_triton_kernels</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">resource_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resources_dir</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Execution trace exception when generating resource directory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">resource_dir</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="c1"># Save the kernel paths for the generated kernels</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">torch._inductor.codecache</span><span class="w"> </span><span class="kn">import</span> <span class="n">PyCodeCache</span> <span class="k">as</span> <span class="n">PyCodeCache</span>

            <span class="n">kernel_files</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">v</span><span class="o">.</span><span class="vm">__file__</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">PyCodeCache</span><span class="o">.</span><span class="n">modules</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&quot;__file__&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">]</span>

            <span class="k">for</span> <span class="n">kernel_file</span> <span class="ow">in</span> <span class="n">kernel_files</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kernel_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">kernel_file</span><span class="p">)</span>
                <span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">resource_dir</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">kernel_file</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registered</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_save_triton_kernels</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Execution trace failed to save kernels: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">_remove_execution_trace_observer</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_registered</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_registered</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if the execution trace observer is registered, otherwise False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registered</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_running</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if the observer is running, otherwise False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_trace_running</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts to capture.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registered</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_trace_running</span><span class="p">:</span>
            <span class="n">_enable_execution_trace_observer</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_execution_trace_running</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_record_pg_config</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stops to capture.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_trace_running</span><span class="p">:</span>
            <span class="n">_disable_execution_trace_observer</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_execution_trace_running</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls unregister_callback() to make sure to finalize outputs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unregister_callback</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_output_file_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the output file name or None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_file_path</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_file_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_record_pg_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Records the PG config info to the trace as node:</span>
        <span class="c1">#  ## process_group:init ##</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_registered</span>
            <span class="ow">and</span> <span class="n">torch</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span>
            <span class="ow">and</span> <span class="n">torch</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">pg_config_info</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">distributed_c10d</span><span class="o">.</span><span class="n">_world</span><span class="o">.</span><span class="n">pg_config_info</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">_record_function_with_args_enter</span><span class="p">(</span>
                <span class="s2">&quot;## process_group:init ##&quot;</span><span class="p">,</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">pg_config_info</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">_NumpyEncoder</span><span class="p">),</span>
            <span class="p">)</span>
</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>



  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
       Copyright PyTorch Contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>